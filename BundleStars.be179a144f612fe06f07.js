"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["BundleStars"],{

/***/ "./src/assets/icons/StarLogo.svg":
/*!***************************************!*\
  !*** ./src/assets/icons/StarLogo.svg ***!
  \***************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "StarLogo.600328787c79d99dfd66.svg";

/***/ }),

/***/ "./src/assets/stars-bg.png":
/*!*********************************!*\
  !*** ./src/assets/stars-bg.png ***!
  \*********************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

module.exports = __webpack_require__.p + "stars-bg.dee4c4b73c7d21c2ec73.png";

/***/ }),

/***/ "./src/bundles/stars.ts":
/*!******************************!*\
  !*** ./src/bundles/stars.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ChatRefundModal: () => (/* reexport safe */ _components_modals_stars_chatRefund_ChatRefundModal__WEBPACK_IMPORTED_MODULE_15__["default"]),
/* harmony export */   GiftInfoModal: () => (/* reexport safe */ _components_modals_gift_info_GiftInfoModal__WEBPACK_IMPORTED_MODULE_9__["default"]),
/* harmony export */   GiftModal: () => (/* reexport safe */ _components_modals_gift_GiftModal__WEBPACK_IMPORTED_MODULE_7__["default"]),
/* harmony export */   GiftRecipientPicker: () => (/* reexport safe */ _components_modals_gift_recipient_GiftRecipientPicker__WEBPACK_IMPORTED_MODULE_8__["default"]),
/* harmony export */   GiftResalePriceComposerModal: () => (/* reexport safe */ _components_modals_gift_resale_GiftResalePriceComposerModal__WEBPACK_IMPORTED_MODULE_10__["default"]),
/* harmony export */   GiftStatusInfoModal: () => (/* reexport safe */ _components_modals_gift_status_GiftStatusInfoModal__WEBPACK_IMPORTED_MODULE_12__["default"]),
/* harmony export */   GiftTransferModal: () => (/* reexport safe */ _components_modals_gift_transfer_GiftTransferModal__WEBPACK_IMPORTED_MODULE_14__["default"]),
/* harmony export */   GiftUpgradeModal: () => (/* reexport safe */ _components_modals_gift_upgrade_GiftUpgradeModal__WEBPACK_IMPORTED_MODULE_11__["default"]),
/* harmony export */   GiftWithdrawModal: () => (/* reexport safe */ _components_modals_gift_withdraw_GiftWithdrawModal__WEBPACK_IMPORTED_MODULE_13__["default"]),
/* harmony export */   PaidReactionModal: () => (/* reexport safe */ _components_modals_paidReaction_PaidReactionModal__WEBPACK_IMPORTED_MODULE_6__["default"]),
/* harmony export */   StarPaymentModal: () => (/* reexport safe */ _components_modals_stars_StarsPaymentModal__WEBPACK_IMPORTED_MODULE_3__["default"]),
/* harmony export */   StarsBalanceModal: () => (/* reexport safe */ _components_modals_stars_StarsBalanceModal__WEBPACK_IMPORTED_MODULE_2__["default"]),
/* harmony export */   StarsGiftModal: () => (/* reexport safe */ _components_modals_stars_gift_StarsGiftModal__WEBPACK_IMPORTED_MODULE_0__["default"]),
/* harmony export */   StarsGiftingPickerModal: () => (/* reexport safe */ _components_main_premium_StarsGiftingPickerModal__WEBPACK_IMPORTED_MODULE_1__["default"]),
/* harmony export */   StarsSubscriptionModal: () => (/* reexport safe */ _components_modals_stars_subscription_StarsSubscriptionModal__WEBPACK_IMPORTED_MODULE_5__["default"]),
/* harmony export */   StarsTransactionInfoModal: () => (/* reexport safe */ _components_modals_stars_transaction_StarsTransactionModal__WEBPACK_IMPORTED_MODULE_4__["default"])
/* harmony export */ });
/* harmony import */ var _components_modals_stars_gift_StarsGiftModal__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../components/modals/stars/gift/StarsGiftModal */ "./src/components/modals/stars/gift/StarsGiftModal.tsx");
/* harmony import */ var _components_main_premium_StarsGiftingPickerModal__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../components/main/premium/StarsGiftingPickerModal */ "./src/components/main/premium/StarsGiftingPickerModal.tsx");
/* harmony import */ var _components_modals_stars_StarsBalanceModal__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../components/modals/stars/StarsBalanceModal */ "./src/components/modals/stars/StarsBalanceModal.tsx");
/* harmony import */ var _components_modals_stars_StarsPaymentModal__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../components/modals/stars/StarsPaymentModal */ "./src/components/modals/stars/StarsPaymentModal.tsx");
/* harmony import */ var _components_modals_stars_transaction_StarsTransactionModal__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../components/modals/stars/transaction/StarsTransactionModal */ "./src/components/modals/stars/transaction/StarsTransactionModal.tsx");
/* harmony import */ var _components_modals_stars_subscription_StarsSubscriptionModal__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../components/modals/stars/subscription/StarsSubscriptionModal */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx");
/* harmony import */ var _components_modals_paidReaction_PaidReactionModal__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../components/modals/paidReaction/PaidReactionModal */ "./src/components/modals/paidReaction/PaidReactionModal.tsx");
/* harmony import */ var _components_modals_gift_GiftModal__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../components/modals/gift/GiftModal */ "./src/components/modals/gift/GiftModal.tsx");
/* harmony import */ var _components_modals_gift_recipient_GiftRecipientPicker__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../components/modals/gift/recipient/GiftRecipientPicker */ "./src/components/modals/gift/recipient/GiftRecipientPicker.tsx");
/* harmony import */ var _components_modals_gift_info_GiftInfoModal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../components/modals/gift/info/GiftInfoModal */ "./src/components/modals/gift/info/GiftInfoModal.tsx");
/* harmony import */ var _components_modals_gift_resale_GiftResalePriceComposerModal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../components/modals/gift/resale/GiftResalePriceComposerModal */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx");
/* harmony import */ var _components_modals_gift_upgrade_GiftUpgradeModal__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../components/modals/gift/upgrade/GiftUpgradeModal */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx");
/* harmony import */ var _components_modals_gift_status_GiftStatusInfoModal__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../components/modals/gift/status/GiftStatusInfoModal */ "./src/components/modals/gift/status/GiftStatusInfoModal.tsx");
/* harmony import */ var _components_modals_gift_withdraw_GiftWithdrawModal__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../components/modals/gift/withdraw/GiftWithdrawModal */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx");
/* harmony import */ var _components_modals_gift_transfer_GiftTransferModal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../components/modals/gift/transfer/GiftTransferModal */ "./src/components/modals/gift/transfer/GiftTransferModal.tsx");
/* harmony import */ var _components_modals_stars_chatRefund_ChatRefundModal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../components/modals/stars/chatRefund/ChatRefundModal */ "./src/components/modals/stars/chatRefund/ChatRefundModal.tsx");

















/***/ }),

/***/ "./src/components/common/gift/GiftTransferPreview.module.scss":
/*!********************************************************************!*\
  !*** ./src/components/common/gift/GiftTransferPreview.module.scss ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GiftTransferPreview-module__root","giftPreview":"GiftTransferPreview-module__giftPreview","backdrop":"GiftTransferPreview-module__backdrop","arrow":"GiftTransferPreview-module__arrow"});

/***/ }),

/***/ "./src/components/common/gift/GiftTransferPreview.tsx":
/*!************************************************************!*\
  !*** ./src/components/common/gift/GiftTransferPreview.tsx ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _helpers_gifts__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _Avatar__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _icons_Icon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./GiftTransferPreview.module.scss */ "./src/components/common/gift/GiftTransferPreview.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const AVATAR_SIZE = 4 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
const GIFT_STICKER_SIZE = 3 * _helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_2__.REM;
const GiftTransferPreview = ({
  peer,
  gift
}) => {
  const giftAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_helpers_gifts__WEBPACK_IMPORTED_MODULE_1__.getGiftAttributes)(gift);
  }, [gift]);
  if (!giftAttributes) return undefined;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
    className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsxs)("div", {
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].giftPreview,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_6__["default"], {
        className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].backdrop,
        backgroundColors: [giftAttributes.backdrop.centerColor, giftAttributes.backdrop.edgeColor],
        patternColor: giftAttributes.backdrop?.patternColor,
        patternIcon: giftAttributes.pattern?.sticker
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_3__["default"], {
        className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].sticker,
        size: GIFT_STICKER_SIZE,
        sticker: giftAttributes.model?.sticker
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_icons_Icon__WEBPACK_IMPORTED_MODULE_5__["default"], {
      name: "next",
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].arrow
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_Avatar__WEBPACK_IMPORTED_MODULE_4__["default"], {
      peer: peer,
      size: AVATAR_SIZE,
      className: _GiftTransferPreview_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].avatar
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftTransferPreview));

/***/ }),

/***/ "./src/components/main/premium/StarsGiftingPickerModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"StarsGiftingPickerModal-module__root","transition":"StarsGiftingPickerModal-module__transition","main":"StarsGiftingPickerModal-module__main","filter":"StarsGiftingPickerModal-module__filter","title":"StarsGiftingPickerModal-module__title","buttons":"StarsGiftingPickerModal-module__buttons","picker":"StarsGiftingPickerModal-module__picker","avatars":"StarsGiftingPickerModal-module__avatars","center":"StarsGiftingPickerModal-module__center","description":"StarsGiftingPickerModal-module__description","premiumFeatures":"StarsGiftingPickerModal-module__premiumFeatures","options":"StarsGiftingPickerModal-module__options","button":"StarsGiftingPickerModal-module__button"});

/***/ }),

/***/ "./src/components/main/premium/StarsGiftingPickerModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/main/premium/StarsGiftingPickerModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./StarsGiftingPickerModal.module.scss */ "./src/components/main/premium/StarsGiftingPickerModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");













const StarsGiftingPickerModal = ({
  isOpen,
  currentUserId,
  activeListIds,
  archivedListIds,
  userIds
}) => {
  const {
    closeStarsGiftingPickerModal,
    openStarsGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const displayedUserIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const usersById = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)().users.byId;
    const combinedIds = (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...(userIds || []), ...(activeListIds || []), ...(archivedListIds || [])]);
    const filteredUserIds = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.filterPeersByQuery)({
      ids: combinedIds,
      query: searchQuery,
      type: 'user'
    });
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_6__["default"])(filteredUserIds.filter(id => {
      const user = usersById[id];
      if (!user) {
        return false;
      }
      return !user.isSupport && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isUserBot)(user) && !(0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.isDeletedUser)(user) && id !== currentUserId && id !== _config__WEBPACK_IMPORTED_MODULE_2__.SERVICE_NOTIFICATIONS_USER_ID;
    }));
  }, [currentUserId, searchQuery, userIds, activeListIds, archivedListIds]);
  const handleSelectedUserIdsChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(newSelectedId => {
    if (newSelectedId?.length) {
      openStarsGiftModal({
        forUserId: newSelectedId
      });
      closeStarsGiftingPickerModal();
    }
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_10__["default"], {
    className: _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].root,
    isOpen: isOpen,
    onClose: closeStarsGiftingPickerModal,
    title: oldLang('GiftStarsTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    confirmButtonText: oldLang('Continue'),
    onEnter: closeStarsGiftingPickerModal,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _StarsGiftingPickerModal_module_scss__WEBPACK_IMPORTED_MODULE_11__["default"].picker,
      itemIds: displayedUserIds,
      filterValue: searchQuery,
      filterPlaceholder: oldLang('Search'),
      onFilterChange: setSearchQuery,
      isSearchable: true,
      withDefaultPadding: true,
      withStatus: true,
      onSelectedIdChange: handleSelectedUserIdsChange
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    chats: {
      listIds
    },
    currentUserId
  } = global;
  return {
    userIds: global.contactList?.userIds,
    activeListIds: listIds.active,
    archivedListIds: listIds.archived,
    currentUserId
  };
})(StarsGiftingPickerModal)));

/***/ }),

/***/ "./src/components/modals/gift/GiftComposer.module.scss":
/*!*************************************************************!*\
  !*** ./src/components/modals/gift/GiftComposer.module.scss ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GiftComposer-module__root","header":"GiftComposer-module__header","spacer":"GiftComposer-module__spacer","title":"GiftComposer-module__title","balance-container":"GiftComposer-module__balance-container","balanceContainer":"GiftComposer-module__balance-container","balance-caption":"GiftComposer-module__balance-caption","balanceCaption":"GiftComposer-module__balance-caption","star-balance":"GiftComposer-module__star-balance","starBalance":"GiftComposer-module__star-balance","balance":"GiftComposer-module__balance","optionsSection":"GiftComposer-module__optionsSection","checkboxTitle":"GiftComposer-module__checkboxTitle","actionMessageView":"GiftComposer-module__actionMessageView","messageInput":"GiftComposer-module__messageInput","limited":"GiftComposer-module__limited","footer":"GiftComposer-module__footer","switcher":"GiftComposer-module__switcher","switcherStarIcon":"GiftComposer-module__switcherStarIcon","description":"GiftComposer-module__description","main-button":"GiftComposer-module__main-button","mainButton":"GiftComposer-module__main-button","star":"GiftComposer-module__star","background":"GiftComposer-module__background","customBgImage":"GiftComposer-module__customBgImage","customBgColor":"GiftComposer-module__customBgColor","withTransition":"GiftComposer-module__withTransition","blurred":"GiftComposer-module__blurred","withRightColumn":"GiftComposer-module__withRightColumn"});

/***/ }),

/***/ "./src/components/modals/gift/GiftComposer.tsx":
/*!*****************************************************!*\
  !*** ./src/components/modals/gift/GiftComposer.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useCustomBackground */ "./src/hooks/useCustomBackground.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_PremiumProgress__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/PremiumProgress */ "./src/components/common/PremiumProgress.tsx");
/* harmony import */ var _middle_message_ActionMessage__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../middle/message/ActionMessage */ "./src/components/middle/message/ActionMessage.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_ListItem__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/ListItem */ "./src/components/ui/ListItem.tsx");
/* harmony import */ var _ui_Switcher__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Switcher */ "./src/components/ui/Switcher.tsx");
/* harmony import */ var _ui_TextArea__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/TextArea */ "./src/components/ui/TextArea.tsx");
/* harmony import */ var _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./GiftComposer.module.scss */ "./src/components/modals/gift/GiftComposer.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





















const LIMIT_DISPLAY_THRESHOLD = 50;
function GiftComposer({
  gift,
  giftByStars,
  peerId,
  peer,
  captionLimit,
  theme,
  isBackgroundBlurred,
  patternColor,
  backgroundColor,
  customBackground,
  currentUserId,
  isPaymentFormLoading,
  starBalance,
  paidMessagesStars,
  areUniqueStarGiftsDisallowed,
  shouldDisallowLimitedStarGifts
}) {
  const {
    sendStarGift,
    sendPremiumGiftByStars,
    openInvoice,
    openGiftUpgradeModal,
    openStarsBalanceModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const [giftMessage, setGiftMessage] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [shouldHideName, setShouldHideName] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPayForUpgrade, setShouldPayForUpgrade] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [shouldPayByStars, setShouldPayByStars] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const customBackgroundValue = (0,_hooks_useCustomBackground__WEBPACK_IMPORTED_MODULE_9__["default"])(theme, customBackground);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldDisallowLimitedStarGifts) {
      setShouldPayForUpgrade(true);
    }
  }, [shouldDisallowLimitedStarGifts, shouldPayForUpgrade]);
  const isStarGift = 'id' in gift && gift.type === 'starGift';
  const isPremiumGift = 'months' in gift;
  const hasPremiumByStars = giftByStars && 'amount' in giftByStars;
  const isPeerUser = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer);
  const isSelf = peerId === currentUserId;
  const localMessage = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isPremiumGift) {
      const currentGift = shouldPayByStars && hasPremiumByStars ? giftByStars : gift;
      return {
        id: -1,
        chatId: '0',
        isOutgoing: false,
        senderId: currentUserId,
        date: Math.floor(Date.now() / 1000),
        content: {
          action: {
            mediaType: 'action',
            type: 'giftPremium',
            amount: currentGift.amount,
            currency: currentGift.currency,
            months: gift.months,
            message: giftMessage ? {
              text: giftMessage
            } : undefined
          }
        }
      };
    }
    if (isStarGift) {
      return {
        id: -1,
        chatId: '0',
        isOutgoing: false,
        senderId: currentUserId,
        date: Math.floor(Date.now() / 1000),
        content: {
          action: {
            mediaType: 'action',
            type: 'starGift',
            message: giftMessage?.length ? {
              text: giftMessage
            } : undefined,
            isNameHidden: shouldHideName || undefined,
            starsToConvert: gift.starsToConvert,
            canUpgrade: shouldPayForUpgrade || undefined,
            alreadyPaidUpgradeStars: shouldPayForUpgrade ? gift.upgradeStars : undefined,
            gift,
            peerId,
            fromId: currentUserId
          }
        }
      };
    }
    return undefined;
  }, [currentUserId, gift, giftMessage, isStarGift, shouldHideName, shouldPayForUpgrade, peerId, shouldPayByStars, hasPremiumByStars, giftByStars, isPremiumGift]);
  const handleGiftMessageChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    setGiftMessage(e.target.value);
  });
  const handleShouldHideNameChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setShouldHideName(!shouldHideName);
  });
  const handleShouldPayForUpgradeChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setShouldPayForUpgrade(!shouldPayForUpgrade);
  });
  const toggleShouldPayByStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (hasPremiumByStars) setShouldPayByStars(!shouldPayByStars);
  });
  const handleOpenUpgradePreview = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!isStarGift) return;
    openGiftUpgradeModal({
      giftId: gift.id,
      peerId
    });
  });
  const handleGetMoreStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    openStarsBalanceModal({});
  });
  const handleMainButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isStarGift) {
      sendStarGift({
        peerId,
        shouldHideName,
        gift,
        message: giftMessage ? {
          text: giftMessage
        } : undefined,
        shouldUpgrade: shouldPayForUpgrade
      });
      return;
    }
    if (shouldPayByStars && hasPremiumByStars) {
      sendPremiumGiftByStars({
        userId: peerId,
        months: giftByStars.months,
        amount: giftByStars.amount,
        message: giftMessage ? {
          text: giftMessage
        } : undefined
      });
      return;
    }
    if (isPremiumGift) {
      openInvoice({
        type: 'giftcode',
        userIds: [peerId],
        currency: gift.currency,
        amount: gift.amount,
        option: gift,
        message: giftMessage ? {
          text: giftMessage
        } : undefined
      });
    }
  });
  const canUseStarsPayment = hasPremiumByStars && starBalance && starBalance.amount > giftByStars.amount;
  function renderOptionsSection() {
    const symbolsLeft = captionLimit ? captionLimit - giftMessage.length : undefined;
    const title = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, peer);
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].optionsSection,
      children: [!paidMessagesStars && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_TextArea__WEBPACK_IMPORTED_MODULE_18__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].messageInput,
        onChange: handleGiftMessageChange,
        value: giftMessage,
        label: lang('GiftMessagePlaceholder'),
        maxLength: captionLimit,
        maxLengthIndicator: symbolsLeft && symbolsLeft < LIMIT_DISPLAY_THRESHOLD ? symbolsLeft.toString() : undefined
      }), canUseStarsPayment && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: toggleShouldPayByStars,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
          children: lang('GiftPremiumPayWithStars', {
            stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, giftByStars.amount, {
              className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcherStarIcon
            })
          }, {
            withNodes: true
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_17__["default"], {
          checked: shouldPayByStars,
          onChange: toggleShouldPayByStars,
          label: lang('GiftPremiumPayWithStarsAcc')
        })]
      }), hasPremiumByStars && starBalance && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description,
        children: lang('GiftPremiumDescriptionYourBalance', {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, starBalance.amount, {
            className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcherStarIcon
          }),
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_15__["default"], {
            isPrimary: true,
            onClick: handleGetMoreStars,
            children: lang('GetMoreStarsLinkText')
          })
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), isStarGift && Boolean(gift.upgradeStars) && !areUniqueStarGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: handleShouldPayForUpgradeChange,
        disabled: shouldDisallowLimitedStarGifts,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
          children: lang('GiftMakeUnique', {
            stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, gift.upgradeStars, {
              className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcherStarIcon
            })
          }, {
            withNodes: true
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_17__["default"], {
          checked: shouldPayForUpgrade,
          onChange: handleShouldPayForUpgradeChange,
          label: lang('GiftMakeUniqueAcc')
        })]
      }), isStarGift && Boolean(gift.upgradeStars) && !areUniqueStarGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description,
        children: isPeerUser ? lang('GiftMakeUniqueDescription', {
          user: title,
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_15__["default"], {
            isPrimary: true,
            onClick: handleOpenUpgradePreview,
            children: lang('GiftMakeUniqueLink')
          })
        }, {
          withNodes: true
        }) : lang('GiftMakeUniqueDescriptionChannel', {
          peer: title,
          link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_15__["default"], {
            isPrimary: true,
            onClick: handleOpenUpgradePreview,
            children: lang('GiftMakeUniqueLink')
          })
        }, {
          withNodes: true
        })
      }), isStarGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)(_ui_ListItem__WEBPACK_IMPORTED_MODULE_16__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].switcher,
        narrow: true,
        ripple: true,
        onClick: handleShouldHideNameChange,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("span", {
          children: lang('GiftHideMyName')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Switcher__WEBPACK_IMPORTED_MODULE_17__["default"], {
          checked: shouldHideName,
          onChange: handleShouldHideNameChange,
          label: lang('GiftHideMyName')
        })]
      }), isStarGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].description,
        children: isSelf ? lang('GiftHideNameDescriptionSelf') : isPeerUser ? lang('GiftHideNameDescription', {
          receiver: title
        }) : lang('GiftHideNameDescriptionChannel')
      })]
    });
  }
  function renderFooter() {
    const amount = shouldPayByStars && hasPremiumByStars ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, giftByStars.amount, {
      asFont: true
    }) : isStarGift ? (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, gift.stars + (shouldPayForUpgrade ? gift.upgradeStars : 0), {
      asFont: true
    }) : isPremiumGift ? (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_7__.formatCurrency)(lang, gift.amount, gift.currency) : undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].footer,
      children: [isStarGift && Boolean(gift.availabilityRemains) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_common_PremiumProgress__WEBPACK_IMPORTED_MODULE_12__["default"], {
        isPrimary: true,
        progress: gift.availabilityRemains / gift.availabilityTotal,
        rightText: lang('GiftSoldCount', {
          count: gift.availabilityTotal - gift.availabilityRemains
        }),
        leftText: lang('GiftLeftCount', {
          count: gift.availabilityRemains
        }),
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].limited
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
        className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].mainButton,
        size: "smaller",
        onClick: handleMainButtonClick,
        isLoading: isPaymentFormLoading,
        children: lang('GiftSend', {
          amount
        }, {
          withNodes: true
        })
      })]
    });
  }
  const bgClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].background, _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].withTransition, customBackground && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].customBgImage, backgroundColor && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].customBgColor, customBackground && isBackgroundBlurred && _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].blurred);
  if (!isStarGift && !isPremiumGift || !localMessage) return;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].root, 'custom-scroll'),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].actionMessageView, 'MessageList')
      // @ts-ignore -- FIXME: Find a way to disable interactions but keep a11y
      ,
      inert: true,
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_6__["default"])(`--pattern-color: ${patternColor}`, backgroundColor && `--theme-background-color: ${backgroundColor}`),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
        className: bgClassName,
        style: customBackgroundValue ? `--custom-background: ${customBackgroundValue}` : undefined
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)(_middle_message_ActionMessage__WEBPACK_IMPORTED_MODULE_13__["default"], {
        message: localMessage,
        threadId: _api_types__WEBPACK_IMPORTED_MODULE_2__.MAIN_THREAD_ID,
        appearanceOrder: 0
      }, isStarGift ? gift.id : isPremiumGift ? gift.months : undefined)]
    }), renderOptionsSection(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_20__.jsx)("div", {
      className: _GiftComposer_module_scss__WEBPACK_IMPORTED_MODULE_19__["default"].spacer
    }), renderFooter()]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  peerId
}) => {
  const theme = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTheme)(global);
  const {
    stars
  } = global;
  const {
    isBlurred: isBackgroundBlurred,
    patternColor,
    background: customBackground,
    backgroundColor
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectThemeValues)(global, theme) || {};
  const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId);
  const paidMessagesStars = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeerPaidMessagesStars)(global, peerId);
  const userFullInfo = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUserFullInfo)(global, peerId);
  const currentUserId = global.currentUserId;
  const isGiftForSelf = currentUserId === peerId;
  const areUniqueStarGiftsDisallowed = !isGiftForSelf && userFullInfo?.disallowedGifts?.shouldDisallowUniqueStarGifts;
  const shouldDisallowLimitedStarGifts = !isGiftForSelf && userFullInfo?.disallowedGifts?.shouldDisallowLimitedStarGifts;
  const tabState = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectTabState)(global);
  return {
    starBalance: stars?.balance,
    peer,
    theme,
    isBackgroundBlurred,
    patternColor,
    customBackground,
    backgroundColor,
    captionLimit: global.appConfig?.starGiftMaxMessageLength,
    currentUserId: global.currentUserId,
    isPaymentFormLoading: tabState.isPaymentFormLoading,
    paidMessagesStars,
    areUniqueStarGiftsDisallowed,
    shouldDisallowLimitedStarGifts
  };
})(GiftComposer)));

/***/ }),

/***/ "./src/components/modals/gift/GiftItem.module.scss":
/*!*********************************************************!*\
  !*** ./src/components/modals/gift/GiftItem.module.scss ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"container":"GiftItem-module__container","starGift":"GiftItem-module__starGift","monthsDescription":"GiftItem-module__monthsDescription","description":"GiftItem-module__description","buy":"GiftItem-module__buy","star":"GiftItem-module__star","amount":"GiftItem-module__amount","starsPriceBlock":"GiftItem-module__starsPriceBlock","starsPriceIcon":"GiftItem-module__starsPriceIcon","radialPattern":"GiftItem-module__radialPattern","stickerWrapper":"GiftItem-module__stickerWrapper"});

/***/ }),

/***/ "./src/components/modals/gift/GiftItemPremium.tsx":
/*!********************************************************!*\
  !*** ./src/components/modals/gift/GiftItemPremium.tsx ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/gift/GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GiftItem.module.scss */ "./src/components/modals/gift/GiftItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GIFT_STICKER_SIZE = 86;
function GiftItemPremium({
  sticker,
  canPlayAnimatedEmojis,
  baseMonthAmount,
  option,
  optionByStars,
  onClick
}) {
  const {
    months,
    amount,
    currency
  } = option;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    onClick(option);
  });
  const perMonth = Math.floor(amount / months);
  const discount = baseMonthAmount && baseMonthAmount > perMonth ? Math.ceil(100 - perMonth / (baseMonthAmount / 100)) : undefined;
  function renderMonths() {
    const caption = months === 12 ? lang('Years', {
      count: 1
    }, {
      pluralValue: 1
    }) : lang('Months', {
      count: months
    }, {
      pluralValue: months
    });
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].monthsDescription,
      children: caption
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].container,
    tabIndex: 0,
    role: "button",
    onClick: handleGiftClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_7__["default"], {
      sticker: sticker,
      play: canPlayAnimatedEmojis,
      noLoop: true,
      nonInteractive: true,
      size: GIFT_STICKER_SIZE
    }), renderMonths(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].description,
      children: lang('PremiumGiftDescription')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].buy,
      nonInteractive: true,
      size: "tiny",
      pill: true,
      fluid: true,
      children: (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_3__.formatCurrencyAsString)(amount, currency)
    }), optionByStars && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].starsPriceBlock,
      children: lang('GiftPremiumStarsPrice', {
        stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsIcon)(lang, optionByStars.amount, {
          className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].starsPriceIcon
        })
      }, {
        withNodes: true,
        withMarkdown: true
      })
    }), Boolean(discount) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
      color: "purple",
      text: lang('GiftDiscount', {
        percent: discount
      })
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  option
}) => {
  const sticker = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectGiftStickerForDuration)(global, option.months);
  const canPlayAnimatedEmojis = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectCanPlayAnimatedEmojis)(global);
  return {
    sticker,
    canPlayAnimatedEmojis
  };
})(GiftItemPremium)));

/***/ }),

/***/ "./src/components/modals/gift/GiftItemStar.tsx":
/*!*****************************************************!*\
  !*** ./src/components/modals/gift/GiftItemStar.tsx ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/gift/GiftRibbon */ "./src/components/common/gift/GiftRibbon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./GiftItem.module.scss */ "./src/components/modals/gift/GiftItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");















const GIFT_STICKER_SIZE = 90;
function GiftItemStar({
  gift,
  observeIntersection,
  onClick,
  isResale
}) {
  const {
    openGiftInfoModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const stickerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const [isVisible, setIsVisible] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const sticker = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__.getStickerFromGift)(gift);
  const isGiftUnique = gift.type === 'starGiftUnique';
  const uniqueGift = isGiftUnique ? gift : undefined;
  const regularGift = !isGiftUnique ? gift : undefined;
  const stars = !isGiftUnique ? regularGift?.stars : uniqueGift?.resellPriceInStars;
  const resellMinStars = regularGift?.resellMinStars;
  const priceInStarsAsString = !isGiftUnique && isResale && resellMinStars ? lang.number(resellMinStars) + '+' : stars;
  const isLimited = !isGiftUnique && Boolean(regularGift?.isLimited);
  const isSoldOut = !isGiftUnique && Boolean(regularGift?.isSoldOut);
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (isSoldOut && !isResale) {
      openGiftInfoModal({
        gift
      });
      return;
    }
    onClick(gift, isResale ? 'resell' : 'original');
  });
  const radialPatternBackdrop = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const {
      backdrop,
      pattern
    } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__.getGiftAttributes)(gift) || {};
    if (!backdrop || !pattern) {
      return undefined;
    }
    const backdropColors = [backdrop.centerColor, backdrop.edgeColor];
    const patternColor = backdrop.patternColor;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternColor: patternColor,
      patternIcon: pattern.sticker
    });
  }, [gift]);
  const giftNumber = isGiftUnique ? gift.number : 0;
  const giftRibbon = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isGiftUnique) {
      const {
        backdrop
      } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_4__.getGiftAttributes)(gift) || {};
      if (!backdrop) {
        return undefined;
      }
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        color: [backdrop.centerColor, backdrop.edgeColor],
        text: lang('GiftSavedNumber', {
          number: giftNumber
        })
      });
    }
    if (isResale) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        color: "green",
        text: lang('GiftRibbonResale')
      });
    }
    if (isSoldOut) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        color: "red",
        text: lang('GiftSoldOut')
      });
    }
    if (isLimited) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_gift_GiftRibbon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        color: "blue",
        text: lang('GiftLimited')
      });
    }
    return undefined;
  }, [isGiftUnique, isResale, gift, isSoldOut, isLimited, lang, giftNumber]);
  (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__.useOnIntersect)(ref, observeIntersection, entry => {
    const visible = entry.isIntersecting;
    setIsVisible(visible);
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].container, _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].starGift, 'starGiftItem'),
    tabIndex: 0,
    role: "button",
    onClick: handleGiftClick,
    children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
      ref: stickerRef,
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].stickerWrapper,
      style: `width: ${GIFT_STICKER_SIZE}px; height: ${GIFT_STICKER_SIZE}px`,
      children: sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_StickerView__WEBPACK_IMPORTED_MODULE_10__["default"], {
        observeIntersectionForPlaying: observeIntersection,
        observeIntersectionForLoading: observeIntersection,
        containerRef: stickerRef,
        sticker: sticker,
        size: GIFT_STICKER_SIZE,
        shouldPreloadPreview: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_11__["default"], {
      className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].buy,
      nonInteractive: true,
      size: "tiny",
      color: isGiftUnique ? 'bluredStarsBadge' : 'stars',
      withSparkleEffect: isVisible,
      pill: true,
      fluid: true,
      children: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsIcon)(lang, priceInStarsAsString || 0, {
        asFont: true,
        className: _GiftItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].star
      })
    }), giftRibbon]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(GiftItemStar));

/***/ }),

/***/ "./src/components/modals/gift/GiftModal.module.scss":
/*!**********************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.module.scss ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GiftModal-module__root","transition":"GiftModal-module__transition","content":"GiftModal-module__content","resaleScreenRoot":"GiftModal-module__resaleScreenRoot","main":"GiftModal-module__main","giftSection":"GiftModal-module__giftSection","section":"GiftModal-module__section","resaleStarGiftsContainer":"GiftModal-module__resaleStarGiftsContainer","starGiftsContainer":"GiftModal-module__starGiftsContainer","premiumGiftsGallery":"GiftModal-module__premiumGiftsGallery","header":"GiftModal-module__header","resaleHeader":"GiftModal-module__resaleHeader","resaleHeaderContentContainer":"GiftModal-module__resaleHeaderContentContainer","headerSlide":"GiftModal-module__headerSlide","headerText":"GiftModal-module__headerText","hiddenHeader":"GiftModal-module__hiddenHeader","resaleHeaderText":"GiftModal-module__resaleHeaderText","commonHeaderText":"GiftModal-module__commonHeaderText","resaleHeaderDescription":"GiftModal-module__resaleHeaderDescription","closeButton":"GiftModal-module__closeButton","balance":"GiftModal-module__balance","avatars":"GiftModal-module__avatars","logoBackground":"GiftModal-module__logoBackground","center":"GiftModal-module__center","description":"GiftModal-module__description","starGiftsDescription":"GiftModal-module__starGiftsDescription","boostIcon":"GiftModal-module__boostIcon","optionBottom":"GiftModal-module__optionBottom","secondaryInfo":"GiftModal-module__secondaryInfo","footer":"GiftModal-module__footer","starGiftsTransition":"GiftModal-module__starGiftsTransition","notFoundGiftsRoot":"GiftModal-module__notFoundGiftsRoot","notFoundGiftsDescription":"GiftModal-module__notFoundGiftsDescription","notFoundGiftsLink":"GiftModal-module__notFoundGiftsLink"});

/***/ }),

/***/ "./src/components/modals/gift/GiftModal.tsx":
/*!**************************************************!*\
  !*** ./src/components/modals/gift/GiftModal.tsx ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_schedulers__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../util/schedulers */ "./src/util/schedulers.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../stars/BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _GiftComposer__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./GiftComposer */ "./src/components/modals/gift/GiftComposer.tsx");
/* harmony import */ var _GiftItemPremium__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./GiftItemPremium */ "./src/components/modals/gift/GiftItemPremium.tsx");
/* harmony import */ var _GiftItemStar__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./GiftItemStar */ "./src/components/modals/gift/GiftItemStar.tsx");
/* harmony import */ var _GiftModalResaleScreen__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./GiftModalResaleScreen */ "./src/components/modals/gift/GiftModalResaleScreen.tsx");
/* harmony import */ var _GiftResaleFilters__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./GiftResaleFilters */ "./src/components/modals/gift/GiftResaleFilters.tsx");
/* harmony import */ var _StarGiftCategoryList__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./StarGiftCategoryList */ "./src/components/modals/gift/StarGiftCategoryList.tsx");
/* harmony import */ var _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./GiftModal.module.scss */ "./src/components/modals/gift/GiftModal.module.scss");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");





























const AVATAR_SIZE = 100;
const INTERSECTION_THROTTLE = 200;
const SCROLL_THROTTLE = 200;
const runThrottledForScroll = (0,_util_schedulers__WEBPACK_IMPORTED_MODULE_7__.throttle)(cb => cb(), SCROLL_THROTTLE, true);
const GiftModal = ({
  modal,
  starGiftsById,
  starGiftIdsByCategory,
  starBalance,
  peer,
  isSelf,
  disallowedGifts,
  resaleGiftsCount,
  areResaleGiftsLoading
}) => {
  const {
    closeGiftModal,
    openGiftInfoModal,
    resetResaleGifts,
    loadResaleGifts
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const dialogRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const transitionRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const giftHeaderRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const scrollerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_8__["default"])(modal);
  const user = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerUser)(peer) ? peer : undefined;
  const chat = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.isApiPeerChat)(peer) ? peer : undefined;
  const [selectedGift, setSelectedGift] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [selectedResellGift, setSelectedResellGift] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [shouldShowMainScreenHeader, setShouldShowMainScreenHeader] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isMainScreenHeaderForStarGifts, setIsMainScreenHeaderForStarGifts] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [isGiftScreenHeaderForStarGifts, setIsGiftScreenHeaderForStarGifts] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [selectedCategory, setSelectedCategory] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('all');
  const areAllGiftsDisallowed = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!disallowedGifts) {
      return undefined;
    }
    const {
      shouldDisallowPremiumGifts,
      ...disallowedGiftTypes
    } = disallowedGifts;
    return !isSelf && Object.values(disallowedGiftTypes).every(Boolean);
  }, [isSelf, disallowedGifts]);
  const areUnlimitedStarGiftsDisallowed = !isSelf && disallowedGifts?.shouldDisallowUnlimitedStarGifts;
  const areLimitedStarGiftsDisallowed = !isSelf && disallowedGifts?.shouldDisallowLimitedStarGifts;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const allGifts = renderingModal?.gifts;
  const filteredGifts = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return allGifts?.sort((prevGift, gift) => prevGift.months - gift.months).filter(gift => gift.users === 1 && gift.currency !== 'XTR');
  }, [allGifts]);
  const giftsByStars = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const mapGifts = new Map();
    if (!filteredGifts) return mapGifts;
    filteredGifts.forEach(gift => {
      const giftByStars = allGifts?.find(starsGift => starsGift.currency === _config__WEBPACK_IMPORTED_MODULE_2__.STARS_CURRENCY_CODE && starsGift.months === gift.months);
      if (giftByStars) {
        mapGifts.set(gift, giftByStars);
      }
    });
    return mapGifts;
  }, [allGifts, filteredGifts]);
  const baseGift = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return filteredGifts?.reduce((prev, gift) => prev.amount < gift.amount ? prev : gift);
  }, [filteredGifts]);
  const {
    observe: observeIntersection
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_9__.useIntersectionObserver)({
    rootRef: scrollerRef,
    throttleMs: INTERSECTION_THROTTLE,
    isDisabled: !isOpen
  });
  const isResaleScreen = Boolean(selectedResellGift) && !selectedGift;
  const isGiftScreen = Boolean(selectedGift);
  const shouldShowHeader = isResaleScreen || isGiftScreen || shouldShowMainScreenHeader;
  const isHeaderForStarGifts = isGiftScreen ? isGiftScreenHeaderForStarGifts : isMainScreenHeaderForStarGifts;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (selectedResellGift) {
      loadResaleGifts({
        giftId: selectedResellGift.id
      });
    }
  }, [selectedResellGift]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setShouldShowMainScreenHeader(false);
      setSelectedGift(undefined);
      setSelectedResellGift(undefined);
      setSelectedCategory('all');
    }
  }, [isOpen]);
  const handleScroll = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    if (isGiftScreen) return;
    const currentTarget = e.currentTarget;
    runThrottledForScroll(() => {
      const {
        scrollTop
      } = currentTarget;
      setShouldShowMainScreenHeader(scrollTop > 150);
      if (transitionRef.current && giftHeaderRef.current) {
        const {
          top: headerTop
        } = giftHeaderRef.current.getBoundingClientRect();
        const {
          top: transitionTop
        } = transitionRef.current.getBoundingClientRect();
        setIsMainScreenHeaderForStarGifts(headerTop - transitionTop <= 0);
      }
    });
  });
  const giftPremiumDescription = lang('GiftPremiumDescription', {
    user: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(user),
    link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_14__["default"], {
      text: lang('GiftPremiumDescriptionLinkCaption'),
      url: lang('GiftPremiumDescriptionLink')
    })
  }, {
    withNodes: true
  });
  const starGiftDescription = chat ? lang('StarGiftDescriptionChannel', {
    peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, chat)
  }, {
    withNodes: true,
    withMarkdown: true
  }) : isSelf ? lang('StarGiftDescriptionSelf', undefined, {
    withNodes: true,
    renderTextFilters: ['br']
  }) : lang('StarGiftDescription', {
    user: (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(user)
  }, {
    withNodes: true,
    withMarkdown: true
  });
  function renderGiftPremiumHeader() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h2", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].headerText, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].center),
      children: lang('GiftPremiumHeader')
    });
  }
  function renderGiftPremiumDescription() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].description, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].center),
      children: giftPremiumDescription
    });
  }
  function renderStarGiftsHeader() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h2", {
      ref: giftHeaderRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].headerText, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].center),
      children: lang(isSelf ? 'StarsGiftHeaderSelf' : 'StarsGiftHeader')
    });
  }
  function renderStarGiftsDescription() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].description, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].starGiftsDescription, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].center),
      children: starGiftDescription
    });
  }
  const handleGiftClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])((gift, target) => {
    if (target === 'resell') {
      if (!('id' in gift)) {
        return;
      }
      if (isResaleScreen) {
        openGiftInfoModal({
          gift,
          recipientId: renderingModal?.forPeerId
        });
        return;
      }
      setSelectedResellGift(gift);
      return;
    }
    setSelectedGift(gift);
    setIsGiftScreenHeaderForStarGifts('id' in gift);
  });
  function renderStarGifts() {
    const filteredGiftIds = starGiftIdsByCategory?.[selectedCategory]?.filter(giftId => {
      const gift = starGiftsById?.[giftId];
      if (!gift) return false;
      const {
        isLimited,
        isSoldOut,
        upgradeStars
      } = gift;
      if (areUnlimitedStarGiftsDisallowed && !areLimitedStarGiftsDisallowed) {
        return isLimited;
      }
      if (areLimitedStarGiftsDisallowed && !areUnlimitedStarGiftsDisallowed) {
        return !isLimited && !isSoldOut;
      }
      if (areUnlimitedStarGiftsDisallowed && areLimitedStarGiftsDisallowed) {
        return Boolean(isLimited && Boolean(upgradeStars));
      }
      return true;
    });
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].starGiftsContainer,
      children: starGiftsById && filteredGiftIds?.flatMap(giftId => {
        const gift = starGiftsById[giftId];
        const shouldShowResale = selectedCategory !== 'stock' && Boolean(gift.availabilityResale);
        const shouldDuplicateAsResale = selectedCategory !== 'resale' && shouldShowResale && !gift.isSoldOut;
        const elements = [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_21__["default"], {
          gift: gift,
          observeIntersection: observeIntersection,
          isResale: shouldShowResale && !shouldDuplicateAsResale,
          onClick: handleGiftClick
        }, giftId)];
        if (shouldDuplicateAsResale) {
          elements.push((0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_21__["default"], {
            isResale: true,
            gift: gift,
            observeIntersection: observeIntersection,
            onClick: handleGiftClick
          }, `resale_${giftId}`));
        }
        return elements;
      })
    });
  }
  function renderPremiumGifts() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].premiumGiftsGallery,
      children: filteredGifts?.map(gift => {
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftItemPremium__WEBPACK_IMPORTED_MODULE_20__["default"], {
          option: gift,
          optionByStars: giftsByStars.get(gift),
          baseMonthAmount: baseGift ? Math.floor(baseGift.amount / baseGift.months) : undefined,
          onClick: handleGiftClick
        });
      })
    });
  }
  const onCategoryChanged = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(category => {
    setSelectedCategory(category);
  });
  const handleCloseModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    setSelectedGift(undefined);
    setSelectedResellGift(undefined);
    resetResaleGifts();
    closeGiftModal();
  });
  const handleCloseButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (isResaleScreen) {
      setSelectedResellGift(undefined);
      resetResaleGifts();
      return;
    }
    if (isGiftScreen) {
      setSelectedGift(undefined);
      return;
    }
    handleCloseModal();
  });
  function renderMainScreen() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
      ref: scrollerRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].avatars,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
          size: AVATAR_SIZE,
          peer: peer
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("img", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].logoBackground,
          src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_26__,
          alt: "",
          draggable: false
        })]
      }), !isSelf && !chat && !disallowedGifts?.shouldDisallowPremiumGifts && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
        children: [renderGiftPremiumHeader(), renderGiftPremiumDescription(), renderPremiumGifts()]
      }), !areAllGiftsDisallowed && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
        children: [renderStarGiftsHeader(), renderStarGiftsDescription(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_StarGiftCategoryList__WEBPACK_IMPORTED_MODULE_24__["default"], {
          areLimitedStarGiftsDisallowed: areLimitedStarGiftsDisallowed,
          onCategoryChanged: onCategoryChanged
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
          name: "zoomFade",
          activeKey: getCategoryKey(selectedCategory),
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].starGiftsTransition,
          children: renderStarGifts()
        })]
      })]
    });
  }
  const isBackButton = isGiftScreen || isResaleScreen;
  const buttonClassName = (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])('animated-close-icon', isBackButton && 'state-back');
  function renderHeader() {
    if (!shouldShowHeader) return undefined;
    if (isResaleScreen) {
      const isFirstLoading = areResaleGiftsLoading && !resaleGiftsCount;
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].resaleHeaderContentContainer,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h2", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].resaleHeaderText,
          children: selectedResellGift.title
        }), isFirstLoading && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].resaleHeaderDescription,
          children: lang('Loading')
        }), !isFirstLoading && resaleGiftsCount !== undefined && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
          className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].resaleHeaderDescription,
          children: lang('HeaderDescriptionResaleGifts', {
            count: resaleGiftsCount
          }, {
            withNodes: true,
            withMarkdown: true,
            pluralValue: resaleGiftsCount
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftResaleFilters__WEBPACK_IMPORTED_MODULE_23__["default"], {
          dialogRef: dialogRef
        })]
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h2", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].commonHeaderText,
      children: lang(isHeaderForStarGifts ? isSelf ? 'StarsGiftHeaderSelf' : 'StarsGiftHeader' : 'GiftPremiumHeader')
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    dialogRef: dialogRef,
    onClose: handleCloseModal,
    isOpen: isOpen,
    isSlim: true,
    contentClassName: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].content,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].modalDialog, _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].root),
    isLowStackPriority: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].closeButton,
      round: true,
      color: "translucent",
      size: "smaller",
      onClick: handleCloseButtonClick,
      ariaLabel: isBackButton ? oldLang('Common.Back') : oldLang('Common.Close'),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
        className: buttonClassName
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_18__["default"], {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].balance,
      balance: starBalance,
      withAddButton: true
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].header, isResaleScreen && _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].resaleHeader, !shouldShowHeader && _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].hiddenHeader),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
        name: "slideVerticalFade",
        activeKey: !shouldShowHeader ? 0 : isResaleScreen ? 1 : isHeaderForStarGifts ? 2 : 3,
        slideClassName: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].headerSlide,
        children: renderHeader()
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_17__["default"], {
      ref: transitionRef,
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].transition,
      name: "pushSlide",
      activeKey: isGiftScreen ? 1 : isResaleScreen ? 2 : 0,
      children: [!isGiftScreen && !isResaleScreen && renderMainScreen(), isResaleScreen && selectedResellGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftModalResaleScreen__WEBPACK_IMPORTED_MODULE_22__["default"], {
        onGiftClick: handleGiftClick
      }), isGiftScreen && renderingModal?.forPeerId && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_GiftComposer__WEBPACK_IMPORTED_MODULE_19__["default"], {
        gift: selectedGift,
        giftByStars: giftsByStars.get(selectedGift),
        peerId: renderingModal.forPeerId
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const {
    starGifts,
    stars,
    currentUserId
  } = global;
  const peer = modal?.forPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, modal.forPeerId) : undefined;
  const isSelf = Boolean(currentUserId && modal?.forPeerId === currentUserId);
  const userFullInfo = peer ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUserFullInfo)(global, peer?.id) : undefined;
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectTabState)(global);
  const resaleGiftsCount = resaleGifts.count;
  const areResaleGiftsLoading = resaleGifts.isLoading !== false;
  return {
    boostPerSentGift: global.appConfig?.boostsPerSentGift,
    starGiftsById: starGifts?.byId,
    starGiftIdsByCategory: starGifts?.idsByCategory,
    starBalance: stars?.balance,
    peer,
    isSelf,
    disallowedGifts: userFullInfo?.disallowedGifts,
    resaleGiftsCount,
    areResaleGiftsLoading
  };
})(GiftModal)));
function getCategoryKey(category) {
  if (category === 'all') return 0;
  if (category === 'limited') return 1;
  if (category === 'resale') return 2;
  if (category === 'stock') return 3;
  return category + 3;
}

/***/ }),

/***/ "./src/components/modals/gift/GiftModalResaleScreen.tsx":
/*!**************************************************************!*\
  !*** ./src/components/modals/gift/GiftModalResaleScreen.tsx ***!
  \**************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/helpers/animatedAssets */ "./src/components/common/helpers/animatedAssets.ts");
/* harmony import */ var _hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useInfiniteScroll */ "./src/hooks/useInfiniteScroll.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../common/AnimatedIconWithPreview */ "./src/components/common/AnimatedIconWithPreview.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _GiftItemStar__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./GiftItemStar */ "./src/components/modals/gift/GiftItemStar.tsx");
/* harmony import */ var _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./GiftModal.module.scss */ "./src/components/modals/gift/GiftModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

















const INTERSECTION_THROTTLE = 200;
const GiftModalResaleScreen = ({
  resellGifts,
  gift,
  filter,
  areGiftsAllLoaded,
  areGiftsLoading,
  updateIteration,
  onGiftClick
}) => {
  const {
    loadResaleGifts,
    updateResaleGiftsFilter
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const scrollerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const resellGiftsIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return resellGifts?.map(g => g.id);
  }, [resellGifts]);
  const hasFilter = Boolean(filter?.modelAttributes?.length || filter?.patternAttributes?.length || filter?.backdropAttributes?.length);
  const handleLoadMoreResellGifts = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    if (gift) {
      loadResaleGifts({
        giftId: gift.id
      });
    }
  });
  const isGiftsEmpty = Boolean(!resellGifts || resellGifts.length === 0);
  const [viewportIds, onLoadMore] = (0,_hooks_useInfiniteScroll__WEBPACK_IMPORTED_MODULE_6__["default"])(handleLoadMoreResellGifts, resellGiftsIds, !gift, _config__WEBPACK_IMPORTED_MODULE_2__.RESALE_GIFTS_LIMIT);
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_7__.useIntersectionObserver)({
    rootRef: scrollerRef,
    throttleMs: INTERSECTION_THROTTLE
  });
  const handleResetGiftsFilter = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: [],
        backdropAttributes: [],
        patternAttributes: []
      }
    });
  });
  function renderNothingFoundGiftsWithFilter() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
      className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsRoot,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_AnimatedIconWithPreview__WEBPACK_IMPORTED_MODULE_10__["default"], {
        size: 160,
        tgsUrl: _common_helpers_animatedAssets__WEBPACK_IMPORTED_MODULE_5__.LOCAL_TGS_URLS.SearchingDuck,
        nonInteractive: true,
        noLoop: true
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsDescription,
        children: lang('ResellGiftsNoFound')
      }), hasFilter && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: _GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].notFoundGiftsLink,
        onClick: handleResetGiftsFilter,
        children: lang('ResellGiftsClearFilters')
      })]
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
    ref: scrollerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleScreenRoot, 'custom-scroll'),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_13__["default"], {
      name: "zoomFade",
      activeKey: updateIteration,
      children: [isGiftsEmpty && areGiftsAllLoaded && renderNothingFoundGiftsWithFilter(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleStarGiftsContainer),
        items: viewportIds,
        onLoadMore: onLoadMore,
        itemSelector: ".starGiftItem",
        noFastList: true,
        preloadBackwards: _config__WEBPACK_IMPORTED_MODULE_2__.RESALE_GIFTS_LIMIT,
        scrollContainerClosest: `.${_GiftModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].resaleScreenRoot}`,
        children: resellGifts?.map(gift => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_GiftItemStar__WEBPACK_IMPORTED_MODULE_14__["default"], {
          gift: gift,
          observeIntersection: observe,
          isResale: true,
          onClick: onGiftClick
        }, gift.id))
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    starGifts
  } = global;
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectTabState)(global);
  const gift = resaleGifts?.giftId ? starGifts?.byId[resaleGifts.giftId] : undefined;
  const filter = resaleGifts.filter;
  const areGiftsAllLoaded = resaleGifts.isAllLoaded;
  const areGiftsLoading = resaleGifts.isLoading;
  const updateIteration = resaleGifts.updateIteration;
  return {
    resellGifts: resaleGifts.gifts,
    gift,
    filter,
    areGiftsAllLoaded,
    areGiftsLoading,
    updateIteration
  };
})(GiftModalResaleScreen)));

/***/ }),

/***/ "./src/components/modals/gift/GiftResaleFilters.module.scss":
/*!******************************************************************!*\
  !*** ./src/components/modals/gift/GiftResaleFilters.module.scss ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GiftResaleFilters-module__root","buttonsContainer":"GiftResaleFilters-module__buttonsContainer","itemIcon":"GiftResaleFilters-module__itemIcon","sticker":"GiftResaleFilters-module__sticker","backdropAttributeMenuItemText":"GiftResaleFilters-module__backdropAttributeMenuItemText","menuItemStickerText":"GiftResaleFilters-module__menuItemStickerText","menuItemText":"GiftResaleFilters-module__menuItemText","backdrop":"GiftResaleFilters-module__backdrop","menuItemIcon":"GiftResaleFilters-module__menuItemIcon","item":"GiftResaleFilters-module__item","menuContentContainer":"GiftResaleFilters-module__menuContentContainer","menu":"GiftResaleFilters-module__menu","left":"GiftResaleFilters-module__left","right":"GiftResaleFilters-module__right"});

/***/ }),

/***/ "./src/components/modals/gift/GiftResaleFilters.tsx":
/*!**********************************************************!*\
  !*** ./src/components/modals/gift/GiftResaleFilters.tsx ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useContextMenuHandlers */ "./src/hooks/useContextMenuHandlers.ts");
/* harmony import */ var _hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useIntersectionObserver */ "./src/hooks/useIntersectionObserver.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Menu__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../ui/Menu */ "./src/components/ui/Menu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../ui/SearchInput */ "./src/components/ui/SearchInput.tsx");
/* harmony import */ var _ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ResaleGiftMenuAttributeSticker */ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx");
/* harmony import */ var _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./GiftResaleFilters.module.scss */ "./src/components/modals/gift/GiftResaleFilters.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");
















const GiftResaleFilters = ({
  attributes,
  counters,
  filter,
  dialogRef
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const {
    updateResaleGiftsFilter
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [searchModelQuery, setSearchModelQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [searchBackdropQuery, setSearchBackdropQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const [searchPatternQuery, setSearchPatternQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const filteredAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const map = {
      model: [],
      pattern: [],
      backdrop: []
    };
    for (const counter of counters ?? []) {
      const {
        attribute
      } = counter;
      if (!counter.count) {
        continue;
      }
      const found = attributes?.find(attr => {
        if (attr.type === 'backdrop' && attribute.type === 'backdrop') {
          return attr.backdropId === attribute.backdropId;
        }
        if (attr.type === 'model' && attribute.type === 'model') {
          return attr.sticker.id === attribute.documentId;
        }
        if (attr.type === 'pattern' && attribute.type === 'pattern') {
          return attr.sticker.id === attribute.documentId;
        }
        return false;
      });
      if (found?.type === 'backdrop') {
        map.backdrop.push(found);
      }
      if (found?.type === 'model') {
        map.model.push(found);
      }
      if (found?.type === 'pattern') {
        map.pattern.push(found);
      }
    }
    return map;
  }, [attributes, counters]);
  const filteredAndSearchedAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const filterBySearch = (items, query) => {
      if (!query.trim()) return items;
      return items.filter(item => Boolean(item.name?.toLowerCase().includes(query.toLowerCase())));
    };
    return {
      model: filterBySearch(filteredAttributes.model, searchModelQuery),
      pattern: filterBySearch(filteredAttributes.pattern, searchPatternQuery),
      backdrop: filterBySearch(filteredAttributes.backdrop, searchBackdropQuery)
    };
  }, [filteredAttributes, searchModelQuery, searchBackdropQuery, searchPatternQuery]);

  // Sort Menu
  const sortMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isSortContextMenuOpen,
    contextMenuAnchor: sortContextMenuAnchor,
    handleContextMenu: handleSortContextMenu,
    handleContextMenuClose: handleSortContextMenuClose,
    handleContextMenuHide: handleSortContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getSortMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => sortMenuRef.current);

  // Model Menu
  const modelMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isModelContextMenuOpen,
    contextMenuAnchor: modelContextMenuAnchor,
    handleContextMenu: handleModelContextMenu,
    handleContextMenuClose: handleModelContextMenuClose,
    handleContextMenuHide: handleModelContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getModelMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => modelMenuRef.current);

  // Backdrop Menu
  const backdropMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isBackdropContextMenuOpen,
    contextMenuAnchor: backdropContextMenuAnchor,
    handleContextMenu: handleBackdropContextMenu,
    handleContextMenuClose: handleBackdropContextMenuClose,
    handleContextMenuHide: handleBackdropContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getBackdropMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => backdropMenuRef.current);

  // Pattern Menu
  const patternMenuRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    isContextMenuOpen: isPatternContextMenuOpen,
    contextMenuAnchor: patternContextMenuAnchor,
    handleContextMenu: handlePatternContextMenu,
    handleContextMenuClose: handlePatternContextMenuClose,
    handleContextMenuHide: handlePatternContextMenuHide
  } = (0,_hooks_useContextMenuHandlers__WEBPACK_IMPORTED_MODULE_4__["default"])(dialogRef);
  const getPatternMenuElement = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => patternMenuRef.current);
  const SortMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const sortType = filter.sortType;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [sortType === 'byDate' && lang('ValueGiftSortByDate'), sortType === 'byNumber' && lang('ValueGiftSortByNumber'), sortType === 'byPrice' && lang('ValueGiftSortByPrice'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const ModelMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.modelAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeModel'), attributesCount > 0 && lang('GiftAttributeModelPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const BackdropMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.backdropAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeBackdrop'), attributesCount > 0 && lang('GiftAttributeBackdropPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const PatternMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const attributesCount = filter?.patternAttributes?.length || 0;
    return ({
      onTrigger,
      isOpen: isMenuOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].item,
      onClick: onTrigger,
      children: [attributesCount === 0 && lang('GiftAttributeSymbol'), attributesCount > 0 && lang('GiftAttributeSymbolPlural', {
        count: attributesCount
      }, {
        pluralValue: attributesCount
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
        name: "dropdown-arrows",
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].itemIcon
      })]
    });
  }, [lang, filter]);
  const handleSortMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(type => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        sortType: type
      }
    });
  });
  const handleSelectedAllModelsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: []
      }
    });
  });
  const handleSelectedAllPatternsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        patternAttributes: []
      }
    });
  });
  const handleSelectedAllBackdropsClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        backdropAttributes: []
      }
    });
  });
  const handleModelMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const attributes = filter.modelAttributes || [];
    const modelAttribute = counters.find(counter => counter.attribute.type === 'model' && counter.attribute.documentId === attribute.sticker.id)?.attribute;
    if (!modelAttribute) return;
    const isActive = attributes.some(item => item.documentId === modelAttribute.documentId);
    const updatedAttributes = isActive ? attributes.filter(item => item.documentId !== modelAttribute.documentId) : [...attributes, modelAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        modelAttributes: updatedAttributes
      }
    });
  });
  const handlePatternMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const attributes = filter.patternAttributes || [];
    const patternAttribute = counters.find(counter => counter.attribute.type === 'pattern' && counter.attribute.documentId === attribute.sticker.id)?.attribute;
    if (!patternAttribute) return;
    const isActive = attributes.some(item => item.documentId === patternAttribute.documentId);
    const updatedAttributes = isActive ? attributes.filter(item => item.documentId !== patternAttribute.documentId) : [...attributes, patternAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        patternAttributes: updatedAttributes
      }
    });
  });
  const handleBackdropMenuItemClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(attribute => {
    if (!counters) return;
    const attributes = filter.backdropAttributes || [];
    const backdropAttribute = counters.find(counter => counter.attribute.type === 'backdrop' && counter.attribute.backdropId === attribute.backdropId)?.attribute;
    if (!backdropAttribute) return;
    const isActive = attributes.some(item => item.backdropId === backdropAttribute.backdropId);
    const updatedAttributes = isActive ? attributes.filter(item => item.backdropId !== backdropAttribute.backdropId) : [...attributes, backdropAttribute];
    updateResaleGiftsFilter({
      filter: {
        ...filter,
        backdropAttributes: updatedAttributes
      }
    });
  });
  function renderSortMenuItems() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-price",
        onClick: () => {
          handleSortMenuItemClick('byPrice');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByPrice')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byPrice' ? 'check' : 'placeholder'
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-date",
        onClick: () => {
          handleSortMenuItemClick('byDate');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByDate')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byDate' ? 'check' : 'placeholder'
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "sort-by-number",
        onClick: () => {
          handleSortMenuItemClick('byNumber');
        },
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemText,
          children: lang('GiftSortByNumber')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
          className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
          name: filter?.sortType === 'byNumber' ? 'check' : 'placeholder'
        })]
      })]
    });
  }
  function renderSortMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isSortContextMenuOpen,
      anchor: sortContextMenuAnchor,
      ref: sortMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].left, 'with-menu-transitions'),
      getMenuElement: getSortMenuElement,
      autoClose: true,
      onClose: handleSortContextMenuClose,
      onCloseAnimationEnd: handleSortContextMenuHide,
      positionX: "left",
      children: renderSortMenuItems()
    });
  }
  const handleSearchModelInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchModelQuery('');
  }, []);
  const handleSearchBackdropInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchBackdropQuery('');
  }, []);
  const handleSearchPatternInputReset = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    setSearchPatternQuery('');
  }, []);
  const handleSearchInputClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(e => {
    e.stopPropagation();
    e.preventDefault();
  });
  const modelMenuItemsContainerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const {
    observe
  } = (0,_hooks_useIntersectionObserver__WEBPACK_IMPORTED_MODULE_5__.useIntersectionObserver)({
    rootRef: modelMenuItemsContainerRef,
    isDisabled: !modelContextMenuAnchor
  });
  function renderModelMenuItems() {
    const models = filteredAndSearchedAttributes.model;
    const selectedAttributes = filter.modelAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      ref: modelMenuItemsContainerRef,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchModelQuery,
        onChange: setSearchModelQuery,
        onReset: handleSearchModelInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllModelsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), models.map(model => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.documentId === model.sticker.id);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handleModelMenuItemClick(model);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].sticker,
            sticker: model.sticker,
            type: "model",
            observeIntersectionForLoading: observe,
            observeIntersectionForPlaying: observe
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemStickerText,
            children: model.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, model.name);
      })]
    });
  }
  function renderModelMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isModelContextMenuOpen,
      anchor: modelContextMenuAnchor,
      ref: modelMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].left, 'with-menu-transitions'),
      getMenuElement: getModelMenuElement,
      autoClose: true,
      onClose: handleModelContextMenuClose,
      onCloseAnimationEnd: handleModelContextMenuHide,
      children: renderModelMenuItems()
    });
  }
  function renderBackdropMenuItems() {
    const backdrops = filteredAndSearchedAttributes.backdrop;
    const selectedAttributes = filter.backdropAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchBackdropQuery,
        onChange: setSearchBackdropQuery,
        onReset: handleSearchBackdropInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllBackdropsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), backdrops.map(backdrop => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.backdropId === backdrop.backdropId);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handleBackdropMenuItemClick(backdrop);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_9__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].backdrop,
            backgroundColors: [backdrop.centerColor, backdrop.edgeColor],
            patternColor: backdrop.patternColor
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].backdropAttributeMenuItemText,
            children: backdrop.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, backdrop.name);
      })]
    });
  }
  function renderBackdropMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isBackdropContextMenuOpen,
      anchor: backdropContextMenuAnchor,
      ref: backdropMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].right, 'with-menu-transitions'),
      getMenuElement: getBackdropMenuElement,
      autoClose: true,
      onClose: handleBackdropContextMenuClose,
      onCloseAnimationEnd: handleBackdropContextMenuHide,
      positionX: "right",
      children: renderBackdropMenuItems()
    });
  }
  function renderPatternMenuItems() {
    const patterns = filteredAndSearchedAttributes.pattern;
    const selectedAttributes = filter.patternAttributes ?? [];
    const isSelectedAll = selectedAttributes.length === 0;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuContentContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_SearchInput__WEBPACK_IMPORTED_MODULE_12__["default"], {
        onClick: handleSearchInputClick,
        className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].search,
        value: searchPatternQuery,
        onChange: setSearchPatternQuery,
        onReset: handleSearchPatternInputReset,
        placeholder: lang('Search')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
        icon: "select",
        onClick: handleSelectedAllPatternsClick,
        disabled: isSelectedAll,
        children: lang('ContextMenuItemSelectAll')
      }), patterns.map(pattern => {
        const isSelected = isSelectedAll || selectedAttributes.some(attr => attr.documentId === pattern.sticker.id);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_11__["default"], {
          onClick: () => {
            handlePatternMenuItemClick(pattern);
          },
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ResaleGiftMenuAttributeSticker__WEBPACK_IMPORTED_MODULE_13__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].sticker,
            sticker: pattern.sticker,
            type: "pattern"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)("div", {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemStickerText,
            children: pattern.name
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menuItemIcon,
            name: isSelected ? 'check' : 'placeholder'
          })]
        }, pattern.name);
      })]
    });
  }
  function renderPatternMenu() {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(_ui_Menu__WEBPACK_IMPORTED_MODULE_10__["default"], {
      isOpen: isPatternContextMenuOpen,
      anchor: patternContextMenuAnchor,
      ref: patternMenuRef,
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].menu, _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].right, 'with-menu-transitions'),
      getMenuElement: getPatternMenuElement,
      autoClose: true,
      onClose: handlePatternContextMenuClose,
      onCloseAnimationEnd: handlePatternContextMenuHide,
      children: renderPatternMenuItems()
    });
  }
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
    className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].root,
    children: [Boolean(sortContextMenuAnchor) && renderSortMenu(), Boolean(modelContextMenuAnchor) && renderModelMenu(), Boolean(backdropContextMenuAnchor) && renderBackdropMenu(), Boolean(patternContextMenuAnchor) && renderPatternMenu(), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsxs)("div", {
      className: _GiftResaleFilters_module_scss__WEBPACK_IMPORTED_MODULE_14__["default"].buttonsContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(SortMenuButton, {
        onTrigger: handleSortContextMenu,
        isOpen: isSortContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(ModelMenuButton, {
        onTrigger: handleModelContextMenu,
        isOpen: isModelContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(BackdropMenuButton, {
        onTrigger: handleBackdropContextMenu,
        isOpen: isBackdropContextMenuOpen
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_15__.jsx)(PatternMenuButton, {
        onTrigger: handlePatternContextMenu,
        isOpen: isPatternContextMenuOpen
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    resaleGifts
  } = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTabState)(global);
  const attributes = resaleGifts.attributes;
  const counters = resaleGifts.counters;
  const filter = resaleGifts.filter;
  return {
    attributes,
    counters,
    filter
  };
})(GiftResaleFilters)));

/***/ }),

/***/ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss":
/*!*******************************************************************************!*\
  !*** ./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss ***!
  \*******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"ResaleGiftMenuAttributeSticker-module__root","thumb":"ResaleGiftMenuAttributeSticker-module__thumb"});

/***/ }),

/***/ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx":
/*!***********************************************************************!*\
  !*** ./src/components/modals/gift/ResaleGiftMenuAttributeSticker.tsx ***!
  \***********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/stickers/useDynamicColorListener */ "./src/hooks/stickers/useDynamicColorListener.ts");
/* harmony import */ var _common_StickerView__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/StickerView */ "./src/components/common/StickerView.tsx");
/* harmony import */ var _ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ResaleGiftMenuAttributeSticker.module.scss */ "./src/components/modals/gift/ResaleGiftMenuAttributeSticker.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");









const ATTRIBUTE_STICKER_SIZE = 1.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_4__.REM;
const ResaleGiftMenuAttributeSticker = ({
  className,
  type,
  sticker,
  observeIntersectionForLoading,
  observeIntersectionForPlaying,
  theme
}) => {
  const stickerRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const customColor = (0,_hooks_stickers_useDynamicColorListener__WEBPACK_IMPORTED_MODULE_5__["default"])(stickerRef, undefined, type !== 'pattern');
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)("div", {
    ref: stickerRef,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].root, className),
    style: `width: ${ATTRIBUTE_STICKER_SIZE}px; height: ${ATTRIBUTE_STICKER_SIZE}px`,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_8__.jsx)(_common_StickerView__WEBPACK_IMPORTED_MODULE_6__["default"], {
      containerRef: stickerRef,
      sticker: sticker,
      size: ATTRIBUTE_STICKER_SIZE,
      shouldPreloadPreview: true,
      observeIntersectionForLoading: observeIntersectionForLoading,
      observeIntersectionForPlaying: observeIntersectionForPlaying,
      thumbClassName: _ResaleGiftMenuAttributeSticker_module_scss__WEBPACK_IMPORTED_MODULE_7__["default"].thumb,
      customColor: customColor
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  return {
    theme: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectTheme)(global)
  };
})(ResaleGiftMenuAttributeSticker)));

/***/ }),

/***/ "./src/components/modals/gift/StarGiftCategoryList.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftCategoryList.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"list":"StarGiftCategoryList-module__list","item-selected":"StarGiftCategoryList-module__item-selected","itemSelected":"StarGiftCategoryList-module__item-selected","item":"StarGiftCategoryList-module__item","selected-item":"StarGiftCategoryList-module__selected-item","selectedItem":"StarGiftCategoryList-module__selected-item","star":"StarGiftCategoryList-module__star"});

/***/ }),

/***/ "./src/components/modals/gift/StarGiftCategoryList.tsx":
/*!*************************************************************!*\
  !*** ./src/components/modals/gift/StarGiftCategoryList.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../hooks/useHorizontalScroll */ "./src/hooks/useHorizontalScroll.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./StarGiftCategoryList.module.scss */ "./src/components/modals/gift/StarGiftCategoryList.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








const StarGiftCategoryList = ({
  idsByCategory,
  onCategoryChanged,
  areLimitedStarGiftsDisallowed
}) => {
  const ref = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const starCategories = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => idsByCategory && Object.keys(idsByCategory).filter(category => category !== 'all' && category !== 'limited').map(Number).sort((a, b) => a - b), [idsByCategory]);
  const hasResale = idsByCategory && idsByCategory['resale'].length > 0;
  const [selectedCategory, setSelectedCategory] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('all');
  function handleItemClick(category) {
    setSelectedCategory(category);
    onCategoryChanged(category);
  }
  function renderCategoryName(category) {
    if (category === 'all') return lang('AllGiftsCategory');
    if (category === 'stock') return lang('StockGiftsCategory');
    if (category === 'limited') return lang('LimitedGiftsCategory');
    if (category === 'resale') return lang('GiftCategoryResale');
    return category;
  }
  function renderCategoryItem(category) {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].item, selectedCategory === category && _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].selectedItem),
      onClick: () => handleItemClick(category),
      children: [Number.isInteger(category) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_5__["default"], {
        className: _StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].star,
        type: "gold",
        size: "middle"
      }), renderCategoryName(category)]
    });
  }
  (0,_hooks_useHorizontalScroll__WEBPACK_IMPORTED_MODULE_3__["default"])(ref, undefined, true);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    ref: ref,
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarGiftCategoryList_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].list, 'no-scrollbar'),
    children: [renderCategoryItem('all'), !areLimitedStarGiftsDisallowed && renderCategoryItem('limited'), !areLimitedStarGiftsDisallowed && hasResale && renderCategoryItem('resale'), renderCategoryItem('stock'), starCategories?.map(renderCategoryItem)]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    starGifts
  } = global;
  return {
    idsByCategory: starGifts?.idsByCategory
  };
})(StarGiftCategoryList)));

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftHeader.module.scss":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftHeader.module.scss ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"UniqueGiftHeader-module__root","radialPattern":"UniqueGiftHeader-module__radialPattern","amount":"UniqueGiftHeader-module__amount","sticker":"UniqueGiftHeader-module__sticker","transition":"UniqueGiftHeader-module__transition","transitionSlide":"UniqueGiftHeader-module__transitionSlide","title":"UniqueGiftHeader-module__title","subtitle":"UniqueGiftHeader-module__subtitle"});

/***/ }),

/***/ "./src/components/modals/gift/UniqueGiftHeader.tsx":
/*!*********************************************************!*\
  !*** ./src/components/modals/gift/UniqueGiftHeader.tsx ***!
  \*********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/animations/useTransitionActiveKey */ "./src/hooks/animations/useTransitionActiveKey.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./UniqueGiftHeader.module.scss */ "./src/components/modals/gift/UniqueGiftHeader.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const STICKER_SIZE = 120;
const UniqueGiftHeader = ({
  modelAttribute,
  backdropAttribute,
  patternAttribute,
  title,
  subtitle,
  className,
  resellPrice
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const activeKey = (0,_hooks_animations_useTransitionActiveKey__WEBPACK_IMPORTED_MODULE_4__.useTransitionActiveKey)([modelAttribute, backdropAttribute, patternAttribute]);
  const subtitleColor = backdropAttribute?.textColor;
  const radialPatternBackdrop = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const backdropColors = [backdropAttribute.centerColor, backdropAttribute.edgeColor];
    const patternColor = backdropAttribute.patternColor;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternColor: patternColor,
      patternIcon: patternAttribute.sticker
    });
  }, [backdropAttribute, patternAttribute]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, className),
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_ui_Transition__WEBPACK_IMPORTED_MODULE_9__["default"], {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].transition,
      slideClassName: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].transitionSlide,
      activeKey: activeKey,
      direction: 1,
      name: "zoomBounceSemiFade",
      children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_6__["default"], {
        className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].sticker,
        sticker: modelAttribute.sticker,
        size: STICKER_SIZE
      })]
    }), title && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("h1", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].title,
      children: title
    }), subtitle && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("p", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].subtitle,
      style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_3__["default"])(subtitleColor && `color: ${subtitleColor}`),
      children: subtitle
    }), resellPrice && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("p", {
      className: _UniqueGiftHeader_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].amount,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_1__.formatStarsTransactionAmount)(lang, resellPrice)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_7__["default"], {
        type: "gold",
        size: "middle"
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(UniqueGiftHeader));

/***/ }),

/***/ "./src/components/modals/gift/info/GiftInfoModal.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"GiftInfoModal-module__modal","header":"GiftInfoModal-module__header","title":"GiftInfoModal-module__title","description":"GiftInfoModal-module__description","soldOut":"GiftInfoModal-module__soldOut","headerSplitButton":"GiftInfoModal-module__headerSplitButton","headerButton":"GiftInfoModal-module__headerButton","giftResalePriceContainer":"GiftInfoModal-module__giftResalePriceContainer","starAmountIcon":"GiftInfoModal-module__starAmountIcon","giftResalePriceStar":"GiftInfoModal-module__giftResalePriceStar","left":"GiftInfoModal-module__left","right":"GiftInfoModal-module__right","footer":"GiftInfoModal-module__footer","footerDescription":"GiftInfoModal-module__footerDescription","unknown":"GiftInfoModal-module__unknown","giftValue":"GiftInfoModal-module__giftValue","uniqueAttribute":"GiftInfoModal-module__uniqueAttribute","uniqueGift":"GiftInfoModal-module__uniqueGift","modalHeader":"GiftInfoModal-module__modalHeader","modalCloseButton":"GiftInfoModal-module__modalCloseButton","ownerAddress":"GiftInfoModal-module__ownerAddress","copyIcon":"GiftInfoModal-module__copyIcon"});

/***/ }),

/***/ "./src/components/modals/gift/info/GiftInfoModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/gift/info/GiftInfoModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/helpers/renderTextWithEntities */ "./src/components/common/helpers/renderTextWithEntities.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_gift_GiftMenuItems__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../../common/gift/GiftMenuItems */ "./src/components/common/gift/GiftMenuItems.tsx");
/* harmony import */ var _common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../common/gift/GiftTransferPreview */ "./src/components/common/gift/GiftTransferPreview.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_Link__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../../../ui/Link */ "./src/components/ui/Link.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ./GiftInfoModal.module.scss */ "./src/components/modals/gift/info/GiftInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");


































const STICKER_SIZE = 120;
const GiftInfoModal = ({
  modal,
  fromPeer,
  targetPeer,
  currentUserId,
  starGiftMaxConvertPeriod,
  hasAdminRights,
  currentUserEmojiStatus,
  collectibleEmojiStatuses,
  tonExplorerUrl,
  currentUser,
  recipientPeer
}) => {
  const {
    closeGiftInfoModal,
    changeGiftVisibility,
    convertGiftToStars,
    openChatWithInfo,
    focusMessage,
    openGiftUpgradeModal,
    showNotification,
    buyStarGift,
    closeGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isConvertConfirmOpen, openConvertConfirm, closeConvertConfirm] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_16__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_18__["default"])();
  const [isConfirmModalOpen, setIsConfirmModalOpen] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__["default"])(modal);
  const renderingFromPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__["default"])(fromPeer);
  const renderingTargetPeer = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_14__["default"])(targetPeer);
  const isTargetChat = renderingTargetPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerChat)(renderingTargetPeer);
  const {
    gift: typeGift
  } = renderingModal || {};
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const isSender = savedGift?.fromId === currentUserId;
  const canConvertDifference = savedGift && starGiftMaxConvertPeriod && savedGift.date + starGiftMaxConvertPeriod - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_10__.getServerTime)() || 0;
  const conversionLeft = Math.ceil(canConvertDifference / 60 / 60 / 24);
  const gift = isSavedGift ? typeGift.gift : typeGift;
  const giftSticker = gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__.getStickerFromGift)(gift);
  const hasConvertOption = canConvertDifference > 0 && Boolean(savedGift?.starsToConvert);
  const isGiftUnique = gift && gift.type === 'starGiftUnique';
  const uniqueGift = isGiftUnique ? gift : undefined;
  const canFocusUpgrade = Boolean(savedGift?.upgradeMsgId);
  const canManage = !canFocusUpgrade && savedGift?.inputGift && (isTargetChat ? hasAdminRights : renderingTargetPeer?.id === currentUserId);
  const resellPriceInStars = isGiftUnique ? gift.resellPriceInStars : undefined;
  const canBuyGift = !canManage && Boolean(resellPriceInStars);
  const giftOwnerTitle = (() => {
    if (!isGiftUnique) return undefined;
    const {
      ownerName,
      ownerId
    } = gift;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(); // Peer titles do not need to be reactive
    const owner = ownerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, ownerId) : undefined;
    return owner ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, owner) : ownerName;
  })();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    closeGiftInfoModal();
  });
  const handleFocusUpgraded = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const giftChat = isSender ? renderingTargetPeer : renderingFromPeer;
    if (!savedGift?.upgradeMsgId || !giftChat) return;
    const {
      upgradeMsgId
    } = savedGift;
    focusMessage({
      chatId: giftChat.id,
      messageId: upgradeMsgId
    });
    handleClose();
  });
  const handleTriggerVisibility = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const {
      inputGift,
      isUnsaved
    } = savedGift;
    changeGiftVisibility({
      gift: inputGift,
      shouldUnsave: !isUnsaved
    });
    handleClose();
  });
  const handleConvertToStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const {
      inputGift
    } = savedGift;
    convertGiftToStars({
      gift: inputGift
    });
    closeConvertConfirm();
    handleClose();
  });
  const handleOpenUpgradeModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (!savedGift) return;
    openGiftUpgradeModal({
      giftId: savedGift.gift.id,
      gift: savedGift
    });
  });
  const handleBuyGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (gift?.type !== 'starGiftUnique' || !gift.resellPriceInStars) return;
    setIsConfirmModalOpen(true);
  });
  const closeConfirmModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    setIsConfirmModalOpen(false);
  });
  const handleConfirmBuyGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    const peer = recipientPeer || currentUser;
    if (!peer || gift?.type !== 'starGiftUnique' || !gift.resellPriceInStars) return;
    closeConfirmModal();
    closeGiftModal();
    buyStarGift({
      peerId: peer.id,
      slug: gift.slug,
      stars: gift.resellPriceInStars
    });
  });
  const giftAttributes = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_12__.getGiftAttributes)(gift);
  }, [gift]);
  const SettingsMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].headerButton, _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].left),
      tabIndex: 0,
      role: "button",
      "aria-haspopup": "menu",
      "aria-label": lang('AriaMoreButton'),
      onClick: onTrigger,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__["default"], {
        name: "more",
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].icon
      })
    });
  }, [lang]);
  const renderFooterButton = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_17__["default"])(() => {
    if (canBuyGift) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_26__["default"], {
        noForcedUpperCase: true,
        size: "smaller",
        onClick: handleBuyGift,
        children: lang('ButtonBuyGift', {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, resellPriceInStars, {
            asFont: true
          })
        }, {
          withNodes: true
        })
      });
    }
    if (canFocusUpgrade) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_26__["default"], {
        size: "smaller",
        onClick: handleFocusUpgraded,
        children: lang('GiftInfoViewUpgraded')
      });
    }
    if (canManage && savedGift?.alreadyPaidUpgradeStars && !savedGift.upgradeMsgId) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_26__["default"], {
        size: "smaller",
        isShiny: true,
        onClick: handleOpenUpgradeModal,
        children: lang('GiftInfoUpgradeForFree')
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_26__["default"], {
      size: "smaller",
      onClick: handleClose,
      children: lang('OK')
    });
  });
  const saleDateInfo = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!gift) return undefined;
    let text = '';
    if (gift.type === 'starGift') {
      if (gift.firstSaleDate) {
        text += `${lang('GiftInfoFirstSale')} ${(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(gift.firstSaleDate * 1000, lang.code, true)}`;
      }
      if (gift.lastSaleDate) {
        text += '\n';
        text += `${lang('GiftInfoLastSale')} ${(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(gift.lastSaleDate * 1000, lang.code, true)}`;
      }
    }
    return text;
  }, [gift, lang]);
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!typeGift || !gift) {
      return undefined;
    }
    const {
      fromId,
      isNameHidden,
      starsToConvert,
      isUnsaved,
      isConverted,
      upgradeMsgId
    } = savedGift || {};
    const canConvert = hasConvertOption && Boolean(starsToConvert);
    const isVisibleForMe = isNameHidden && renderingTargetPeer;
    const description = (() => {
      if (!savedGift) return lang('GiftInfoSoldOutDescription');
      if (isTargetChat) return undefined;
      if (savedGift.upgradeMsgId) return lang('GiftInfoDescriptionUpgraded');
      if (savedGift.canUpgrade && savedGift.alreadyPaidUpgradeStars) {
        return canManage ? lang('GiftInfoDescriptionFreeUpgrade') : lang('GiftInfoPeerDescriptionFreeUpgradeOut', {
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingTargetPeer)
        });
      }
      if (!canManage && !isSender) return undefined;
      if (isConverted && canConvert) {
        return canManage ? lang('GiftInfoDescriptionConverted', {
          amount: starsToConvert
        }, {
          pluralValue: starsToConvert,
          withNodes: true,
          withMarkdown: true
        }) : lang('GiftInfoPeerDescriptionOutConverted', {
          amount: starsToConvert,
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingTargetPeer)
        }, {
          pluralValue: starsToConvert,
          withNodes: true,
          withMarkdown: true
        });
      }
      if (savedGift.canUpgrade && canManage) {
        if (canConvert) {
          return lang('GiftInfoDescriptionUpgrade', {
            amount: starsToConvert
          }, {
            pluralValue: starsToConvert,
            withNodes: true,
            withMarkdown: true
          });
        }
        return lang('GiftInfoDescriptionUpgradeRegular');
      }
      if (canManage) {
        if (canConvert) {
          return lang('GiftInfoDescription', {
            amount: starsToConvert
          }, {
            withNodes: true,
            withMarkdown: true,
            pluralValue: starsToConvert
          });
        }
        return lang('GiftInfoDescriptionRegular');
      }
      if (canConvert) {
        return lang('GiftInfoPeerDescriptionOut', {
          amount: starsToConvert,
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingTargetPeer)
        }, {
          withNodes: true,
          withMarkdown: true,
          pluralValue: starsToConvert
        });
      }
      return lang('GiftInfoPeerDescriptionOutRegular', {
        peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingTargetPeer)
      });
    })();
    function getTitle() {
      if (isGiftUnique) return gift.title;
      if (!savedGift) return lang('GiftInfoSoldOutTitle');
      return canManage ? lang('GiftInfoReceived') : lang('GiftInfoTitle');
    }
    const uniqueGiftContextMenu = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_28__["default"], {
      className: "with-menu-transitions",
      trigger: SettingsMenuButton,
      positionX: "right",
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_gift_GiftMenuItems__WEBPACK_IMPORTED_MODULE_22__["default"], {
        peerId: renderingModal.peerId,
        gift: typeGift,
        canManage: canManage,
        collectibleEmojiStatuses: collectibleEmojiStatuses,
        currentUserEmojiStatus: currentUserEmojiStatus
      })
    });
    const uniqueGiftModalHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].modalHeader,
      children: [Boolean(canManage && resellPriceInStars) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].giftResalePriceContainer,
        children: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, resellPriceInStars, {
          asFont: true,
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].giftResalePriceStar
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].headerSplitButton,
        children: [isOpen && uniqueGiftContextMenu, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].headerButton, _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].right),
          tabIndex: 0,
          role: "button",
          "aria-haspopup": "menu",
          "aria-label": lang('Close'),
          onClick: handleClose,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__["default"], {
            name: "close",
            className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].icon, _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].moreIcon)
          })
        })]
      })]
    });
    const uniqueGiftHeader = isGiftUnique && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].header, _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].uniqueGift),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_31__["default"], {
        backdropAttribute: giftAttributes.backdrop,
        patternAttribute: giftAttributes.pattern,
        modelAttribute: giftAttributes.model,
        title: gift.title,
        subtitle: lang('GiftInfoCollectible', {
          number: gift.number
        })
      })
    });
    const regularHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_19__["default"], {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].giftSticker,
        sticker: giftSticker,
        size: STICKER_SIZE
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("h1", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].title,
        children: getTitle()
      }), Boolean(description) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("p", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].description, !savedGift && gift?.type === 'starGift' && _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].soldOut),
        children: description
      })]
    });
    const tableData = [];
    if (gift.type === 'starGift') {
      const hasFrom = fromId || isNameHidden;
      if (hasFrom) {
        tableData.push([lang('GiftInfoFrom'), !fromId ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_20__["default"], {
            size: "small",
            peer: _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_9__.CUSTOM_PEER_HIDDEN
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("span", {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].unknown,
            children: oldLang(_util_objects_customPeer__WEBPACK_IMPORTED_MODULE_9__.CUSTOM_PEER_HIDDEN.titleKey)
          })]
        }) : {
          chatId: fromId
        }]);
      }
      if (savedGift?.date) {
        tableData.push([lang('GiftInfoDate'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("span", {
          title: saleDateInfo,
          children: (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(savedGift.date * 1000, lang.code, true)
        })]);
      }
      if (gift.firstSaleDate && !savedGift) {
        tableData.push([lang('GiftInfoFirstSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(gift.firstSaleDate * 1000, lang.code, true)]);
      }
      if (gift.lastSaleDate && !savedGift) {
        tableData.push([lang('GiftInfoLastSale'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(gift.lastSaleDate * 1000, lang.code, true)]);
      }
      const starsValue = gift.stars + (savedGift?.alreadyPaidUpgradeStars || 0);
      tableData.push([lang('GiftInfoValue'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].giftValue,
        children: [(0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, starsValue, {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].starAmountIcon
        }), canManage && hasConvertOption && Boolean(starsToConvert) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__["default"], {
          onClick: openConvertConfirm,
          children: lang('GiftInfoConvert', {
            amount: starsToConvert
          }, {
            pluralValue: starsToConvert
          })
        })]
      })]);
      if (gift.availabilityTotal) {
        tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoAvailabilityValue', {
          count: gift.availabilityRemains || 0,
          total: gift.availabilityTotal
        }, {
          pluralValue: gift.availabilityRemains || 0
        })]);
      }
      if (gift.upgradeStars && !upgradeMsgId) {
        tableData.push([lang('GiftInfoStatus'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].giftValue,
          children: [lang('GiftInfoStatusNonUnique'), canManage && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__["default"], {
            onClick: handleOpenUpgradeModal,
            children: lang('GiftInfoUpgradeBadge')
          })]
        })]);
      }
      if (savedGift?.message) {
        tableData.push([undefined, (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_13__.renderTextWithEntities)(savedGift.message)]);
      }
    }
    if (isGiftUnique) {
      const {
        ownerName,
        ownerAddress,
        ownerId
      } = gift;
      const {
        model,
        backdrop,
        pattern,
        originalDetails
      } = giftAttributes || {};
      if (ownerAddress) {
        tableData.push([lang('GiftInfoOwner'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].ownerAddress,
          onClick: () => {
            (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_6__.copyTextToClipboard)(ownerAddress);
            showNotification({
              message: {
                key: 'WalletAddressCopied'
              },
              icon: 'copy'
            });
          },
          children: [ownerAddress, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_24__["default"], {
            className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].copyIcon,
            name: "copy"
          })]
        })]);
      } else {
        tableData.push([lang('GiftInfoOwner'), ownerId ? {
          chatId: ownerId,
          withEmojiStatus: true
        } : ownerName || '']);
      }
      if (model) {
        tableData.push([lang('GiftAttributeModel'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].uniqueAttribute,
          children: [model.name, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_11__.formatPercent)(model.rarityPercent)
          })]
        })]);
      }
      if (backdrop) {
        tableData.push([lang('GiftAttributeBackdrop'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].uniqueAttribute,
          children: [backdrop.name, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_11__.formatPercent)(backdrop.rarityPercent)
          })]
        })]);
      }
      if (pattern) {
        tableData.push([lang('GiftAttributeSymbol'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("span", {
          className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].uniqueAttribute,
          children: [pattern.name, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_21__["default"], {
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_11__.formatPercent)(pattern.rarityPercent)
          })]
        })]);
      }
      tableData.push([lang('GiftInfoAvailability'), lang('GiftInfoIssued', {
        issued: gift.issuedCount,
        total: gift.totalCount
      })]);
      if (originalDetails) {
        const {
          date,
          recipientId,
          message,
          senderId
        } = originalDetails;
        const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(); // Peer titles do not need to be reactive

        const openChat = id => {
          openChatWithInfo({
            id
          });
          closeGiftInfoModal();
        };
        const recipient = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, recipientId);
        const sender = senderId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, senderId) : undefined;
        const formattedDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_7__.formatDateTimeToString)(date * 1000, lang.code, true);
        const recipientLink = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_29__["default"], {
          onClick: () => openChat(recipientId),
          isPrimary: true,
          children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, recipient)
        });
        let text;
        if (!sender || senderId === recipientId) {
          text = message ? lang('GiftInfoPeerOriginalInfoText', {
            peer: recipientLink,
            text: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_13__.renderTextWithEntities)(message),
            date: formattedDate
          }, {
            withNodes: true
          }) : lang('GiftInfoPeerOriginalInfo', {
            peer: recipientLink,
            date: formattedDate
          }, {
            withNodes: true
          });
        } else {
          const senderLink = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_29__["default"], {
            onClick: () => openChat(sender.id),
            isPrimary: true,
            children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, sender)
          });
          text = message ? lang('GiftInfoPeerOriginalInfoTextSender', {
            peer: recipientLink,
            sender: senderLink,
            text: (0,_common_helpers_renderTextWithEntities__WEBPACK_IMPORTED_MODULE_13__.renderTextWithEntities)(message),
            date: formattedDate
          }, {
            withNodes: true
          }) : lang('GiftInfoPeerOriginalInfoSender', {
            peer: recipientLink,
            date: formattedDate,
            sender: senderLink
          }, {
            withNodes: true
          });
        }
        tableData.push([undefined, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("span", {
          children: text
        })]);
      }
    }
    const tonLink = tonExplorerUrl && isGiftUnique && gift.giftAddress && `${tonExplorerUrl}${gift.giftAddress}`;
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].footer,
      children: [(canManage || tonLink || canBuyGift) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)("div", {
        className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].footerDescription,
        children: [tonLink && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
          children: lang('GiftInfoTonText', {
            link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_25__["default"], {
              url: tonLink,
              shouldSkipModal: true,
              text: lang('GiftInfoTonLinkText')
            })
          }, {
            withNodes: true
          })
        }), canManage && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
          children: lang(`GiftInfo${isTargetChat ? 'Channel' : ''}${isUnsaved ? 'Hidden' : 'Saved'}`, {
            link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_ui_Link__WEBPACK_IMPORTED_MODULE_29__["default"], {
              isPrimary: true,
              onClick: handleTriggerVisibility,
              children: lang(`GiftInfoSaved${isUnsaved ? 'Show' : 'Hide'}`)
            })
          }, {
            withNodes: true
          })
        }), !canBuyGift && isVisibleForMe && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
          children: lang('GiftInfoSenderHidden')
        }), canBuyGift && giftOwnerTitle && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
          children: lang('GiftInfoBuyGift', {
            user: giftOwnerTitle
          }, {
            withNodes: true
          })
        })]
      }), renderFooterButton()]
    });
    return {
      modalHeader: isGiftUnique ? uniqueGiftModalHeader : undefined,
      header: isGiftUnique ? uniqueGiftHeader : regularHeader,
      tableData,
      footer
    };
  }, [typeGift, savedGift, renderingTargetPeer, giftSticker, lang, canManage, hasConvertOption, isSender, oldLang, tonExplorerUrl, gift, giftAttributes, renderFooterButton, isTargetChat, SettingsMenuButton, isGiftUnique, renderingModal, collectibleEmojiStatuses, currentUserEmojiStatus, saleDateInfo, canBuyGift, giftOwnerTitle, isOpen, resellPriceInStars]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.Fragment, {
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_30__["default"], {
      isOpen: isOpen,
      modalHeader: modalData?.modalHeader,
      header: modalData?.header,
      hasBackdrop: isGiftUnique,
      tableData: modalData?.tableData,
      footer: modalData?.footer,
      className: _GiftInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_32__["default"].modal,
      onClose: handleClose,
      withBalanceBar: Boolean(canBuyGift),
      isLowStackPriority: true
    }), uniqueGift && currentUser && Boolean(resellPriceInStars) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_27__["default"], {
      isOpen: isConfirmModalOpen,
      noDefaultTitle: true,
      onClose: closeConfirmModal,
      confirmLabel: lang('ButtonBuyGift', {
        stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsIcon)(lang, resellPriceInStars, {
          asFont: true
        })
      }, {
        withNodes: true
      }),
      confirmHandler: handleConfirmBuyGift,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)(_common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_23__["default"], {
        peer: recipientPeer || currentUser,
        gift: uniqueGift
      }), !recipientPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("p", {
        children: lang('GiftBuyConfirmDescription', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsText)(lang, resellPriceInStars)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), recipientPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("p", {
        children: lang('GiftBuyForPeerConfirmDescription', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsText)(lang, resellPriceInStars),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, recipientPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      })]
    }), savedGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_27__["default"], {
      isOpen: isConvertConfirmOpen,
      onClose: closeConvertConfirm,
      confirmHandler: handleConvertToStars,
      title: lang('GiftInfoConvertTitle'),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
        children: lang('GiftInfoPeerConvertDescription', {
          amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_8__.formatStarsAsText)(lang, savedGift.starsToConvert),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingFromPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      }), hasConvertOption && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
        children: lang('GiftInfoConvertDescriptionPeriod', {
          count: conversionLeft
        }, {
          withNodes: true,
          withMarkdown: true,
          pluralValue: conversionLeft
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_33__.jsx)("div", {
        children: lang('GiftInfoConvertDescription2')
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const typeGift = modal?.gift;
  const isSavedGift = typeGift && 'gift' in typeGift;
  const currentUserId = global.currentUserId;
  const fromId = isSavedGift && typeGift.fromId;
  const fromPeer = fromId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, fromId) : undefined;
  const targetPeer = modal?.peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, modal.peerId) : undefined;
  const chat = targetPeer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerChat)(targetPeer) ? targetPeer : undefined;
  const hasAdminRights = chat && (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getHasAdminRight)(chat, 'postMessages');
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId);
  const recipientPeer = modal?.recipientId && currentUserId !== modal.recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, modal.recipientId) : undefined;
  const currentUserEmojiStatus = currentUser?.emojiStatus;
  const collectibleEmojiStatuses = global.collectibleEmojiStatuses?.statuses;
  return {
    fromPeer,
    targetPeer,
    currentUserId,
    starGiftMaxConvertPeriod: global.appConfig?.starGiftMaxConvertPeriod,
    tonExplorerUrl: global.appConfig?.tonExplorerUrl,
    hasAdminRights,
    currentUserEmojiStatus,
    collectibleEmojiStatuses,
    currentUser,
    recipientPeer
  };
})(GiftInfoModal)));

/***/ }),

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss":
/*!******************************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss ***!
  \******************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"GiftRecipientPicker-module__root","picker":"GiftRecipientPicker-module__picker"});

/***/ }),

/***/ "./src/components/modals/gift/recipient/GiftRecipientPicker.tsx":
/*!**********************************************************************!*\
  !*** ./src/components/modals/gift/recipient/GiftRecipientPicker.tsx ***!
  \**********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GiftRecipientPicker.module.scss */ "./src/components/modals/gift/recipient/GiftRecipientPicker.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GiftRecipientPicker = ({
  modal,
  currentUserId,
  userIds
}) => {
  const {
    closeGiftRecipientPicker,
    openGiftModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const isOpen = modal;
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const displayedUserIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const idsWithSelf = userIds ? userIds.concat(currentUserId) : undefined;
    const filteredPeerIds = idsWithSelf ? (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.filterPeersByQuery)({
      ids: idsWithSelf,
      query: searchQuery
    }) : [];
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_5__["default"])((0,_util_iteratees__WEBPACK_IMPORTED_MODULE_4__.unique)(filteredPeerIds).filter(peerId => {
      return (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectCanGift)(global, peerId);
    }), undefined, [currentUserId]);
  }, [currentUserId, searchQuery, userIds]);
  const handleSelectedUserIdsChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(selectedId => {
    openGiftModal({
      forUserId: selectedId
    });
    closeGiftRecipientPicker();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_9__["default"], {
    className: _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root,
    isOpen: isOpen,
    onClose: closeGiftRecipientPicker,
    title: oldLang('GiftTelegramPremiumOrStarsTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: _GiftRecipientPicker_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].picker,
      itemIds: displayedUserIds,
      filterValue: searchQuery,
      filterPlaceholder: oldLang('Search'),
      onSelectedIdChange: handleSelectedUserIdsChange,
      onFilterChange: setSearchQuery,
      isSearchable: true,
      withDefaultPadding: true,
      withStatus: true,
      forceShowSelf: true
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    currentUserId
  } = global;
  return {
    currentUserId,
    userIds: global.contactList?.userIds
  };
})(GiftRecipientPicker)));

/***/ }),

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss":
/*!************************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"descriptionContainer":"GiftResalePriceComposerModal-module__descriptionContainer","descriptionPrice":"GiftResalePriceComposerModal-module__descriptionPrice","inputPrice":"GiftResalePriceComposerModal-module__inputPrice"});

/***/ }),

/***/ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/gift/resale/GiftResalePriceComposerModal.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_InputText__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/InputText */ "./src/components/ui/InputText.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./GiftResalePriceComposerModal.module.scss */ "./src/components/modals/gift/resale/GiftResalePriceComposerModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const GiftResalePriceComposerModal = ({
  modal,
  starsStargiftResaleCommissionPermille,
  starsStargiftResaleAmountMin,
  starsStargiftResaleAmountMax,
  starsUsdWithdrawRate
}) => {
  const {
    closeGiftResalePriceComposerModal,
    closeGiftInfoModal,
    updateStarGiftPrice,
    showNotification
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const [price, setPrice] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(undefined);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_4__["default"])(modal);
  const {
    gift: typeGift
  } = renderingModal || {};
  const isSavedGift = typeGift && 'gift' in typeGift;
  const savedGift = isSavedGift ? typeGift : undefined;
  const hasPrice = Boolean(price);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_5__["default"])();
  const handleChangePrice = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(e => {
    const value = e.target.value;
    const number = parseFloat(value);
    const result = value === '' || Number.isNaN(number) ? undefined : starsStargiftResaleAmountMax ? Math.min(number, starsStargiftResaleAmountMax) : number;
    setPrice(result);
  });
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    closeGiftResalePriceComposerModal();
  });
  const handleSellGift = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_6__["default"])(() => {
    if (!savedGift || savedGift.gift.type !== 'starGiftUnique' || !savedGift.inputGift || !price) return;
    closeGiftResalePriceComposerModal();
    closeGiftInfoModal();
    updateStarGiftPrice({
      gift: savedGift.inputGift,
      price
    });
    showNotification({
      icon: 'sell-outline',
      message: {
        key: 'NotificationGiftIsSale',
        variables: {
          gift: lang('GiftUnique', {
            title: savedGift.gift.title,
            number: savedGift.gift.number
          })
        }
      }
    });
  });
  const commission = starsStargiftResaleCommissionPermille;
  const isPriceCorrect = hasPrice && price > starsStargiftResaleAmountMin;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isOpen: isOpen,
    title: lang('GiftSellTitle'),
    hasCloseButton: true,
    isSlim: true,
    onClose: handleClose,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].inputPrice,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_ui_InputText__WEBPACK_IMPORTED_MODULE_8__["default"], {
        label: lang('InputPlaceholderGiftResalePrice'),
        onChange: handleChangePrice,
        value: price?.toString(),
        inputMode: "numeric",
        tabIndex: 0,
        teactExperimentControlled: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
      className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].descriptionContainer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("span", {
        children: [!isPriceCorrect && Boolean(commission) && lang('DescriptionComposerGiftMinimumPrice', {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsText)(lang, starsStargiftResaleAmountMin)
        }, {
          withMarkdown: true,
          withNodes: true
        }), isPriceCorrect && lang('DescriptionComposerGiftResalePrice', {
          stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsText)(lang, commission ? Number((price * commission).toFixed()) : price)
        }, {
          withMarkdown: true,
          withNodes: true
        })]
      }), isPriceCorrect && Boolean(starsUsdWithdrawRate) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("span", {
        className: _GiftResalePriceComposerModal_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].descriptionPrice,
        children: `≈ ${(0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_2__.formatCurrencyAsString)(price * starsUsdWithdrawRate, 'USD', lang.code)}`
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_7__["default"], {
      noForcedUpperCase: true,
      disabled: !isPriceCorrect,
      size: "smaller",
      onClick: handleSellGift,
      children: [isPriceCorrect && lang('ButtonSellGift', {
        stars: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_3__.formatStarsAsIcon)(lang, price, {
          asFont: true
        })
      }, {
        withNodes: true
      }), !isPriceCorrect && lang('Sell')]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const configPermille = global.appConfig?.starsStargiftResaleCommissionPermille;
  const starsStargiftResaleCommissionPermille = configPermille ? configPermille / 1000 : undefined;
  const starsStargiftResaleAmountMin = global.appConfig?.starsStargiftResaleAmountMin || 0;
  const starsStargiftResaleAmountMax = global.appConfig?.starsStargiftResaleAmountMax;
  const starsUsdWithdrawRateX1000 = global.appConfig?.starsUsdWithdrawRateX1000;
  const starsUsdWithdrawRate = starsUsdWithdrawRateX1000 ? starsUsdWithdrawRateX1000 / 1000 : 1;
  return {
    starsStargiftResaleCommissionPermille,
    starsStargiftResaleAmountMin,
    starsStargiftResaleAmountMax,
    starsUsdWithdrawRate
  };
})(GiftResalePriceComposerModal)));

/***/ }),

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.module.scss":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.module.scss ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"GiftStatusInfoModal-module__header","profileBlock":"GiftStatusInfoModal-module__profileBlock","titleContainer":"GiftStatusInfoModal-module__titleContainer","radialPattern":"GiftStatusInfoModal-module__radialPattern","lockIcon":"GiftStatusInfoModal-module__lockIcon","avatar":"GiftStatusInfoModal-module__avatar","userTitle":"GiftStatusInfoModal-module__userTitle","status":"GiftStatusInfoModal-module__status","giftTitle":"GiftStatusInfoModal-module__giftTitle","infoDescription":"GiftStatusInfoModal-module__infoDescription","footer":"GiftStatusInfoModal-module__footer"});

/***/ }),

/***/ "./src/components/modals/gift/status/GiftStatusInfoModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/status/GiftStatusInfoModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_buildStyle__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/buildStyle */ "./src/util/buildStyle.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_hooks_useCustomEmoji__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/hooks/useCustomEmoji */ "./src/components/common/hooks/useCustomEmoji.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./GiftStatusInfoModal.module.scss */ "./src/components/modals/gift/status/GiftStatusInfoModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

















const GiftStatusInfoModal = ({
  modal,
  currentUser,
  isCurrentUserPremium
}) => {
  const {
    closeGiftStatusInfoModal,
    setEmojiStatus
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const {
    emojiStatus
  } = renderingModal || {};
  const subtitleColor = emojiStatus?.textColor;
  const patternIcon = (0,_common_hooks_useCustomEmoji__WEBPACK_IMPORTED_MODULE_8__["default"])(emojiStatus?.patternDocumentId);
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    closeGiftStatusInfoModal();
  });
  const onWearClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    if (emojiStatus) {
      setEmojiStatus({
        emojiStatus
      });
    }
    closeGiftStatusInfoModal();
  });
  const radialPatternBackdrop = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!emojiStatus || !isOpen) return undefined;
    const backdropColors = [emojiStatus.centerColor, emojiStatus.edgeColor];
    const patternColor = emojiStatus.patternColor;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_12__["default"], {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].radialPattern,
      backgroundColors: backdropColors,
      patternColor: patternColor,
      patternIcon: patternIcon.customEmoji
    });
  }, [emojiStatus, isOpen, patternIcon]);
  const mockPeerWithStatus = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return {
      ...currentUser,
      emojiStatus
    };
  }, [currentUser, emojiStatus]);
  const header = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].profileBlock),
        style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(subtitleColor && `color: ${subtitleColor}`),
        children: [radialPatternBackdrop, (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_9__["default"], {
          peer: mockPeerWithStatus,
          size: "jumbo",
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].avatar
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_10__["default"], {
          peer: mockPeerWithStatus,
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].userTitle,
          withEmojiStatus: true,
          noFake: true,
          noVerified: true,
          statusSparklesColor: subtitleColor
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("p", {
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].status,
          style: (0,_util_buildStyle__WEBPACK_IMPORTED_MODULE_4__["default"])(subtitleColor && `color: ${subtitleColor}`),
          children: lang('Online')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)("div", {
        className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].titleContainer,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].giftTitle,
          children: lang('UniqueStatusWearTitle', {
            gift: mockPeerWithStatus?.emojiStatus?.title
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].infoDescription,
          children: lang('UniqueStatusBenefitsDescription')
        })]
      })]
    });
  }, [subtitleColor, radialPatternBackdrop, mockPeerWithStatus, lang]);
  const listItemData = [['radial-badge', lang('UniqueStatusBadgeBenefitTitle'), lang('UniqueStatusBadgeDescription')], ['unique-profile', lang('UniqueStatusProfileDesignBenefitTitle'), lang('UniqueStatusProfileDesignDescription')], ['proof-of-ownership', lang('UniqueStatusProofOfOwnershipBenefitTitle'), lang('UniqueStatusProofOfOwnershipDescription')]];
  const footer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)("div", {
      className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].footer,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
        size: "smaller",
        onClick: onWearClick,
        children: [lang('UniqueStatusWearButton'), !isCurrentUserPremium && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
          name: "lock-badge",
          className: _GiftStatusInfoModal_module_scss__WEBPACK_IMPORTED_MODULE_15__["default"].lockIcon
        })]
      })
    });
  }, [lang, isCurrentUserPremium, isOpen]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_16__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_14__["default"], {
    isOpen: isOpen,
    header: header,
    listItemData: listItemData,
    footer: footer,
    hasBackdrop: true,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectUser)(global, global.currentUserId);
  const isCurrentUserPremium = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_2__.selectIsCurrentUserPremium)(global);
  return {
    currentUser,
    isCurrentUserPremium
  };
})(GiftStatusInfoModal)));

/***/ }),

/***/ "./src/components/modals/gift/transfer/GiftTransferModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/transfer/GiftTransferModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_iteratees__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/iteratees */ "./src/util/iteratees.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_memo__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/memo */ "./src/util/memo.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/helpers/sortChatIds */ "./src/components/common/helpers/sortChatIds.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useFolderManager */ "./src/hooks/useFolderManager.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_usePeerSearch__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/usePeerSearch */ "./src/hooks/usePeerSearch.ts");
/* harmony import */ var _common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../common/gift/GiftTransferPreview */ "./src/components/common/gift/GiftTransferPreview.tsx");
/* harmony import */ var _common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../common/pickers/PeerPicker */ "./src/components/common/pickers/PeerPicker.tsx");
/* harmony import */ var _common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/pickers/PickerModal */ "./src/components/common/pickers/PickerModal.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




















const GiftTransferModal = ({
  modal,
  contactIds,
  currentUserId
}) => {
  const {
    closeGiftTransferModal,
    openGiftWithdrawModal,
    transferGift
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const [searchQuery, setSearchQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__["default"])(modal);
  const uniqueGift = renderingModal?.gift?.gift;
  const giftAttributes = uniqueGift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getGiftAttributes)(uniqueGift);
  const [selectedId, setSelectedId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const renderingSelectedPeerId = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_10__["default"])(selectedId);
  const renderingSelectedPeer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return renderingSelectedPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, renderingSelectedPeerId) : undefined;
  }, [renderingSelectedPeerId]);
  const orderedChatIds = (0,_hooks_useFolderManager__WEBPACK_IMPORTED_MODULE_11__.useFolderManagerForOrderedIds)(_config__WEBPACK_IMPORTED_MODULE_2__.ALL_FOLDER_ID);
  const sortedLocalIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return (0,_util_iteratees__WEBPACK_IMPORTED_MODULE_5__.unique)([...(contactIds || []), ...(orderedChatIds || [])]);
  }, [contactIds, orderedChatIds]);
  const {
    result: foundIds,
    currentResultsQuery
  } = (0,_hooks_usePeerSearch__WEBPACK_IMPORTED_MODULE_14__["default"])({
    query: searchQuery,
    defaultValue: sortedLocalIds
  });
  const isLoading = currentResultsQuery !== searchQuery;
  const categories = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (currentResultsQuery) return _util_memo__WEBPACK_IMPORTED_MODULE_7__.MEMO_EMPTY_ARRAY;
    return [{
      type: 'withdraw',
      isCustomPeer: true,
      avatarIcon: 'toncoin',
      peerColorId: 5,
      title: lang('GiftTransferTON')
    }];
  }, [lang, currentResultsQuery]);
  const handleCategoryChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(category => {
    if (category !== 'withdraw') return;
    openGiftWithdrawModal({
      gift: renderingModal.gift
    });
    closeGiftTransferModal();
  });
  const displayIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isLoading) return _util_memo__WEBPACK_IMPORTED_MODULE_7__.MEMO_EMPTY_ARRAY;
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    return (0,_common_helpers_sortChatIds__WEBPACK_IMPORTED_MODULE_9__["default"])((foundIds || []).filter(peerId => peerId !== currentUserId && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectCanGift)(global, peerId)), false);
  }, [isLoading, foundIds, currentUserId]);
  const closeConfirmModal = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    setSelectedId(undefined);
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setSelectedId(undefined);
    }
  }, [isOpen]);
  const handleTransfer = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    if (!renderingModal?.gift.inputGift) return;
    transferGift({
      gift: renderingModal.gift.inputGift,
      recipientId: renderingSelectedPeerId,
      transferStars: renderingModal.gift.transferStars
    });
    closeConfirmModal();
    closeGiftTransferModal();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)(_common_pickers_PickerModal__WEBPACK_IMPORTED_MODULE_17__["default"], {
    isOpen: isOpen,
    onClose: closeGiftTransferModal,
    title: lang('GiftTransferTitle'),
    hasCloseButton: true,
    shouldAdaptToSearch: true,
    withFixedHeight: true,
    ignoreFreeze: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_common_pickers_PeerPicker__WEBPACK_IMPORTED_MODULE_16__["default"], {
      itemIds: displayIds,
      categories: categories,
      onSelectedCategoryChange: handleCategoryChange,
      withDefaultPadding: true,
      withPeerUsernames: true,
      isSearchable: true,
      noScrollRestore: true,
      isLoading: isLoading,
      filterValue: searchQuery,
      filterPlaceholder: lang('Search'),
      onFilterChange: setSearchQuery,
      onSelectedIdChange: setSelectedId
    }), giftAttributes && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_18__["default"], {
      isOpen: Boolean(selectedId),
      noDefaultTitle: true,
      onClose: closeConfirmModal,
      confirmLabel: renderingModal?.gift.transferStars ? lang('GiftTransferConfirmButton', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_6__.formatStarsAsIcon)(lang, renderingModal.gift.transferStars, {
          asFont: true
        })
      }, {
        withNodes: true
      }) : lang('GiftTransferConfirmButtonFree'),
      confirmHandler: handleTransfer,
      children: [renderingSelectedPeer && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_common_gift_GiftTransferPreview__WEBPACK_IMPORTED_MODULE_15__["default"], {
        peer: renderingSelectedPeer,
        gift: uniqueGift
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("p", {
        children: renderingModal?.gift.transferStars ? lang('GiftTransferConfirmDescription', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_6__.formatStarsAsText)(lang, renderingModal.gift.transferStars),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingSelectedPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        }) : lang('GiftTransferConfirmDescriptionFree', {
          gift: lang('GiftUnique', {
            title: uniqueGift.title,
            number: uniqueGift.number
          }),
          peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(lang, renderingSelectedPeer)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    contactList,
    currentUserId
  } = global;
  return {
    contactIds: contactList?.userIds,
    currentUserId
  };
})(GiftTransferModal)));

/***/ }),

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss":
/*!*************************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss ***!
  \*************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"footer":"GiftUpgradeModal-module__footer","footerButton":"GiftUpgradeModal-module__footerButton"});

/***/ }),

/***/ "./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx":
/*!*****************************************************************!*\
  !*** ./src/components/modals/gift/upgrade/GiftUpgradeModal.tsx ***!
  \*****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _api_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../api/types */ "./src/api/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/mediaLoader */ "./src/util/mediaLoader.ts");
/* harmony import */ var _hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/schedulers/useInterval */ "./src/hooks/schedulers/useInterval.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _common_TableAboutModal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/TableAboutModal */ "./src/components/modals/common/TableAboutModal.tsx");
/* harmony import */ var _UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./GiftUpgradeModal.module.scss */ "./src/components/modals/gift/upgrade/GiftUpgradeModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");


















const PREVIEW_UPDATE_INTERVAL = 3000;
const GiftUpgradeModal = ({
  modal,
  recipient
}) => {
  const {
    closeGiftUpgradeModal,
    upgradeGift
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__["default"])(modal);
  const renderingRecipient = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_9__["default"])(recipient);
  const [shouldKeepOriginalDetails, setShouldKeepOriginalDetails] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const [previewAttributes, setPreviewAttributes] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => closeGiftUpgradeModal());
  const handleUpgrade = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    const gift = renderingModal?.gift;
    if (!gift?.inputGift) return;
    upgradeGift({
      gift: gift.inputGift,
      shouldKeepOriginalDetails,
      upgradeStars: !gift.alreadyPaidUpgradeStars ? gift.gift.upgradeStars : undefined
    });
    handleClose();
  });
  const updatePreviewAttributes = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!renderingModal?.sampleAttributes) return;
    setPreviewAttributes(getRandomAttributes(renderingModal.sampleAttributes, previewAttributes));
  });
  (0,_hooks_schedulers_useInterval__WEBPACK_IMPORTED_MODULE_8__["default"])(updatePreviewAttributes, isOpen ? PREVIEW_UPDATE_INTERVAL : undefined, true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (isOpen && renderingModal?.sampleAttributes) {
      updatePreviewAttributes();
    }
  }, [isOpen, renderingModal?.sampleAttributes]);

  // Preload stickers and patterns
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const attributes = renderingModal?.sampleAttributes;
    if (!attributes) return;
    const patternStickers = attributes.filter(attr => attr.type === 'pattern').map(attr => attr.sticker);
    const modelStickers = attributes.filter(attr => attr.type === 'model').map(attr => attr.sticker);
    const mediaHashes = [...patternStickers, ...modelStickers].map(sticker => (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getStickerMediaHash)(sticker, 'full'));
    mediaHashes.forEach(hash => {
      (0,_util_mediaLoader__WEBPACK_IMPORTED_MODULE_7__.fetch)(hash, _api_types__WEBPACK_IMPORTED_MODULE_2__.ApiMediaFormat.BlobUrl);
    });
  }, [renderingModal?.sampleAttributes]);
  const modalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!previewAttributes || !isOpen) {
      return undefined;
    }
    const gift = renderingModal?.gift;
    const listItemData = [['diamond', lang('GiftUpgradeUniqueTitle'), lang('GiftUpgradeUniqueDescription')], ['trade', lang('GiftUpgradeTransferableTitle'), lang('GiftUpgradeTransferableDescription')], ['auction', lang('GiftUpgradeTradeableTitle'), lang('GiftUpgradeTradeableDescription')]];
    const subtitle = renderingRecipient ? lang('GiftPeerUpgradeText', {
      peer: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, renderingRecipient)
    }) : lang('GiftUpgradeTextOwn');
    const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_15__["default"], {
      modelAttribute: previewAttributes.model,
      backdropAttribute: previewAttributes.backdrop,
      patternAttribute: previewAttributes.pattern,
      title: lang('GiftUpgradeTitle'),
      subtitle: subtitle
    });
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)("div", {
      className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].footer,
      children: [!gift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
        className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].footerButton,
        size: "smaller",
        onClick: handleClose,
        children: lang('OK')
      }), gift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_13__["default"], {
          label: lang('GiftUpgradeKeepDetails'),
          onCheck: setShouldKeepOriginalDetails,
          checked: shouldKeepOriginalDetails
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_12__["default"], {
          className: _GiftUpgradeModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].footerButton,
          size: "smaller",
          isShiny: true,
          onClick: handleUpgrade,
          children: gift.alreadyPaidUpgradeStars ? lang('GeneralConfirm') : lang('GiftUpgradeButton', {
            amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_6__.formatStarsAsIcon)(lang, gift.gift.upgradeStars, {
              asFont: true
            })
          }, {
            withNodes: true
          })
        })]
      })]
    });
    return {
      listItemData,
      header,
      footer
    };
  }, [previewAttributes, isOpen, lang, renderingRecipient, renderingModal?.gift, shouldKeepOriginalDetails]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_17__.jsx)(_common_TableAboutModal__WEBPACK_IMPORTED_MODULE_14__["default"], {
    isOpen: isOpen,
    header: modalData?.header,
    footer: modalData?.footer,
    listItemData: modalData?.listItemData,
    hasBackdrop: true,
    onClose: handleClose
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const recipientId = modal?.recipientId;
  const recipient = recipientId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, recipientId) : undefined;
  return {
    recipient
  };
})(GiftUpgradeModal)));
function getRandomAttributes(list, previousSelection) {
  const models = list.filter(attr => attr.type === 'model' && attr.name !== previousSelection?.model.name);
  const patterns = list.filter(attr => attr.type === 'pattern' && attr.name !== previousSelection?.pattern.name);
  const backdrops = list.filter(attr => attr.type === 'backdrop' && attr.name !== previousSelection?.backdrop.name);
  const randomModel = models[Math.floor(Math.random() * models.length)];
  const randomPattern = patterns[Math.floor(Math.random() * patterns.length)];
  const randomBackdrop = backdrops[Math.floor(Math.random() * backdrops.length)];
  return {
    model: randomModel,
    pattern: randomPattern,
    backdrop: randomBackdrop
  };
}

/***/ }),

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss":
/*!***************************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"header":"GiftWithdrawModal-module__header","giftPreview":"GiftWithdrawModal-module__giftPreview","backdrop":"GiftWithdrawModal-module__backdrop","description":"GiftWithdrawModal-module__description","arrow":"GiftWithdrawModal-module__arrow","noPassword":"GiftWithdrawModal-module__noPassword"});

/***/ }),

/***/ "./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx":
/*!*******************************************************************!*\
  !*** ./src/components/modals/gift/withdraw/GiftWithdrawModal.tsx ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _util_dates_units__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../util/dates/units */ "./src/util/dates/units.ts");
/* harmony import */ var _util_serverTime__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/serverTime */ "./src/util/serverTime.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/mediaDimensions */ "./src/components/common/helpers/mediaDimensions.ts");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PasswordForm__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/PasswordForm */ "./src/components/common/PasswordForm.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./GiftWithdrawModal.module.scss */ "./src/components/modals/gift/withdraw/GiftWithdrawModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const FRAGMENT_PEER = {
  isCustomPeer: true,
  avatarIcon: 'fragment',
  title: '',
  customPeerAvatarColor: '#000000'
};
const GIFT_STICKER_SIZE = 4.5 * _common_helpers_mediaDimensions__WEBPACK_IMPORTED_MODULE_6__.REM;
const GiftWithdrawModal = ({
  modal,
  hasPassword,
  passwordHint
}) => {
  const {
    closeGiftWithdrawModal,
    clearGiftWithdrawError,
    closeGiftInfoModal,
    processStarGiftWithdrawal,
    openSettingsScreen
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const isOpen = Boolean(modal);
  const [shouldShowPassword, setShouldShowPassword] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const gift = renderingModal?.gift?.gift;
  const giftAttributes = gift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_5__.getGiftAttributes)(gift);
  const exportDelay = renderingModal?.gift?.canExportAt ? Math.max(renderingModal.gift.canExportAt - (0,_util_serverTime__WEBPACK_IMPORTED_MODULE_4__.getServerTime)(), 0) : undefined;
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    closeGiftWithdrawModal();
  });
  const handleSubmit = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(password => {
    processStarGiftWithdrawal({
      gift: renderingModal.gift.inputGift,
      password
    });
  });
  const handleSetUpPassword = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_9__["default"])(() => {
    openSettingsScreen({
      screen: _types__WEBPACK_IMPORTED_MODULE_2__.SettingsScreens.TwoFaDisabled
    });
    closeGiftWithdrawModal();
    closeGiftInfoModal();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    isOpen: isOpen,
    title: lang('GiftWithdrawTitle'),
    hasCloseButton: true,
    isSlim: true,
    onClose: handleClose,
    children: [giftAttributes && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].header,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].giftPreview,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_14__["default"], {
            className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].backdrop,
            backgroundColors: [giftAttributes.backdrop.centerColor, giftAttributes.backdrop.edgeColor],
            patternColor: giftAttributes.backdrop?.patternColor,
            patternIcon: giftAttributes.pattern?.sticker
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_10__["default"], {
            className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].sticker,
            size: GIFT_STICKER_SIZE,
            sticker: giftAttributes.model?.sticker
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
          name: "next",
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].arrow
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
          peer: FRAGMENT_PEER,
          size: "giant",
          className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].avatar
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].description,
        children: lang('GiftWithdrawDescription', {
          gift: `${gift.title} #${gift.number}`
        }, {
          withNodes: true,
          withMarkdown: true,
          renderTextFilters: ['br']
        })
      })]
    }), Boolean(exportDelay) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
      className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].exportHint,
      children: lang('GiftWithdrawWait', {
        days: (0,_util_dates_units__WEBPACK_IMPORTED_MODULE_3__.getDays)(exportDelay)
      }, {
        pluralValue: (0,_util_dates_units__WEBPACK_IMPORTED_MODULE_3__.getDays)(exportDelay)
      })
    }), !hasPassword && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("span", {
        className: _GiftWithdrawModal_module_scss__WEBPACK_IMPORTED_MODULE_17__["default"].noPassword,
        children: lang('ErrorPasswordMissing')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: "mt-2",
        size: "smaller",
        onClick: handleSetUpPassword,
        children: lang('SetUp2FA')
      })]
    }), hasPassword && !exportDelay && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_PasswordForm__WEBPACK_IMPORTED_MODULE_13__["default"], {
      shouldShowSubmit: true,
      placeholder: lang('CheckPasswordPlaceholder'),
      error: renderingModal?.errorKey && lang.withRegular(renderingModal?.errorKey),
      description: lang('CheckPasswordDescription'),
      clearError: clearGiftWithdrawError,
      isLoading: renderingModal?.isLoading,
      hint: passwordHint,
      isPasswordVisible: shouldShowPassword,
      shouldResetValue: isOpen,
      onChangePasswordVisibility: setShouldShowPassword,
      submitLabel: lang('GiftWithdrawSubmit'),
      onSubmit: handleSubmit
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const {
    settings: {
      byKey: {
        hasPassword
      }
    },
    twoFaSettings: {
      hint: passwordHint
    }
  } = global;
  return {
    hasPassword,
    passwordHint
  };
})(GiftWithdrawModal)));

/***/ }),

/***/ "./src/components/modals/paidReaction/PaidReactionModal.module.scss":
/*!**************************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.module.scss ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"content":"PaidReactionModal-module__content","title":"PaidReactionModal-module__title","slider":"PaidReactionModal-module__slider","description":"PaidReactionModal-module__description","itemInfo":"PaidReactionModal-module__itemInfo","itemTitle":"PaidReactionModal-module__itemTitle","itemSubtitle":"PaidReactionModal-module__itemSubtitle","itemIcon":"PaidReactionModal-module__itemIcon","sendAsPeerButtonAvatar":"PaidReactionModal-module__sendAsPeerButtonAvatar","sendAsPeerMenuButton":"PaidReactionModal-module__sendAsPeerMenuButton","buttonDownIcon":"PaidReactionModal-module__buttonDownIcon","sendAsPeerMenuBubble":"PaidReactionModal-module__sendAsPeerMenuBubble","sendAsPeerMenu":"PaidReactionModal-module__sendAsPeerMenu","sendAsPeersMenuContainer":"PaidReactionModal-module__sendAsPeersMenuContainer","headerControlPanel":"PaidReactionModal-module__headerControlPanel","separator":"PaidReactionModal-module__separator","checkBox":"PaidReactionModal-module__checkBox","topLabel":"PaidReactionModal-module__topLabel","top":"PaidReactionModal-module__top","topBadge":"PaidReactionModal-module__topBadge","buttonStar":"PaidReactionModal-module__buttonStar","topPeer":"PaidReactionModal-module__topPeer","disclaimer":"PaidReactionModal-module__disclaimer"});

/***/ }),

/***/ "./src/components/modals/paidReaction/PaidReactionModal.tsx":
/*!******************************************************************!*\
  !*** ./src/components/modals/paidReaction/PaidReactionModal.tsx ***!
  \******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useAppLayout */ "./src/hooks/useAppLayout.ts");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_FullNameTitle__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/FullNameTitle */ "./src/components/common/FullNameTitle.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_PeerBadge__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerBadge */ "./src/components/common/PeerBadge.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../ui/DropdownMenu */ "./src/components/ui/DropdownMenu.tsx");
/* harmony import */ var _ui_MenuItem__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../ui/MenuItem */ "./src/components/ui/MenuItem.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_Separator__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../ui/Separator */ "./src/components/ui/Separator.tsx");
/* harmony import */ var _stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../stars/BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _StarSlider__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./StarSlider */ "./src/components/modals/paidReaction/StarSlider.tsx");
/* harmony import */ var _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ./PaidReactionModal.module.scss */ "./src/components/modals/paidReaction/PaidReactionModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




























const MAX_TOP_REACTORS = 3;
const DEFAULT_STARS_AMOUNT = 50;
const MAX_REACTION_AMOUNT = 2500;
const ANONYMOUS_PEER = {
  avatarIcon: 'author-hidden',
  customPeerAvatarColor: '#9eaab5',
  isCustomPeer: true,
  titleKey: 'StarsReactionAnonymous'
};
const PaidReactionModal = ({
  modal,
  chat,
  message,
  maxAmount,
  starBalance,
  defaultPrivacy,
  sendPaidReactionsAsPeerIds,
  currentUserId,
  currentUser
}) => {
  const {
    closePaidReactionModal,
    addLocalPaidReaction,
    loadSendPaidReactionsAs
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [starsAmount, setStarsAmount] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(DEFAULT_STARS_AMOUNT);
  const [isTouched, markTouched, unmarkTouched] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [shouldSendAsAnonymous, setShouldSendAsAnonymous] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [sendAsPeerId, setSendAsPeerId] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(currentUserId);
  const chatId = chat?.id;
  const senderPeer = sendAsPeerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), sendAsPeerId) : currentUser;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const {
    isMobile
  } = (0,_hooks_useAppLayout__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_10__["default"])();
  const handleShowInTopSendersChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(e => {
    setShouldSendAsAnonymous(!e.target.checked);
  });
  const handleAmountChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(value => {
    setStarsAmount(value);
    markTouched();
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (chatId && !sendPaidReactionsAsPeerIds) {
      loadSendPaidReactionsAs({
        chatId
      });
    }
  }, [chatId, sendPaidReactionsAsPeerIds]);
  const filteredMyReactorIds = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const result = sendPaidReactionsAsPeerIds?.map(peer => peer.id).filter(id => id !== chatId);
    result?.unshift(currentUserId);
    return result;
  }, [sendPaidReactionsAsPeerIds, chatId, currentUserId]);
  const canChangeSendAsPeer = filteredMyReactorIds && filteredMyReactorIds.length > 1;
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!modal) {
      unmarkTouched();
    }
  }, [modal]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    const currentReactor = message?.reactions?.topReactors?.find(reactor => reactor.isMy);
    if (currentReactor) {
      setShouldSendAsAnonymous(Boolean(currentReactor.isAnonymous));
      if (currentReactor.peerId) {
        setSendAsPeerId(currentReactor.peerId);
      }
      return;
    }
    setShouldSendAsAnonymous(defaultPrivacy?.type === 'anonymous' || false);
    if (defaultPrivacy?.type === 'peer' && filteredMyReactorIds?.includes(defaultPrivacy.peerId)) {
      setSendAsPeerId(defaultPrivacy.peerId);
      return;
    }
    setSendAsPeerId(currentUserId);
  }, [defaultPrivacy, message?.reactions?.topReactors, filteredMyReactorIds, currentUserId]);
  const handleSend = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(() => {
    if (!modal) return;
    addLocalPaidReaction({
      chatId: modal.chatId,
      messageId: modal.messageId,
      count: starsAmount,
      isPrivate: shouldSendAsAnonymous,
      peerId: shouldSendAsAnonymous || sendAsPeerId === currentUserId ? undefined : sendAsPeerId,
      shouldIgnoreDefaultPrivacy: true
    });
    closePaidReactionModal();
  });
  const handleSendAsPeerChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(peerId => {
    setShouldSendAsAnonymous(false);
    setSendAsPeerId(peerId);
  });
  const renderMenuItem = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_11__["default"])(peerId => {
    const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)((0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)(), peerId);
    const isSelected = sendAsPeerId === peerId && !shouldSendAsAnonymous;
    if (!peer) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_MenuItem__WEBPACK_IMPORTED_MODULE_21__["default"], {
      onClick: () => handleSendAsPeerChange(peerId),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
        size: "small",
        peer: peer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemInfo),
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_FullNameTitle__WEBPACK_IMPORTED_MODULE_14__["default"], {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemTitle,
          peer: peer,
          noFake: true,
          noVerified: true
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("span", {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemSubtitle,
          children: (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer) ? lang('PeerPersonalAccount') : lang('PeerChannel')
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].itemIcon,
        name: isSelected ? 'check' : 'placeholder'
      })]
    });
  });
  const SendAsPeerMenuButton = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return ({
      onTrigger,
      isOpen
    }) => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      ripple: !isMobile,
      size: "smaller",
      color: "translucent",
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenuButton, isOpen ? 'active' : ''),
      onClick: onTrigger,
      ariaLabel: lang('AccDescrOpenMenu2'),
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerButtonAvatar,
        size: "mini",
        peer: shouldSendAsAnonymous ? ANONYMOUS_PEER : senderPeer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
        name: "down",
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].buttonDownIcon
      })]
    });
  }, [isMobile, lang, senderPeer, shouldSendAsAnonymous]);
  const sendAsPeersMenu = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!canChangeSendAsPeer) return undefined;
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_DropdownMenu__WEBPACK_IMPORTED_MODULE_20__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenu, 'with-menu-transitions'),
      bubbleClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeerMenuBubble,
      trigger: SendAsPeerMenuButton,
      positionX: "right",
      autoClose: true,
      children: filteredMyReactorIds.map(id => renderMenuItem(id))
    });
  }, [SendAsPeerMenuButton, filteredMyReactorIds, canChangeSendAsPeer]);
  const topReactors = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    const all = message?.reactions?.topReactors;
    if (!all) {
      return undefined;
    }
    const result = [];
    let hasCurrentSender = false;
    let myReactorAmount = 0;
    all.forEach(reactor => {
      const peer = reactor.peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, reactor.peerId) : undefined;
      if (!peer && !reactor.isAnonymous && !reactor.isMy) return;
      if (reactor.isMy) {
        myReactorAmount = reactor.count;
      }
      if (reactor.isMy && (reactor.peerId !== sendAsPeerId || reactor.isAnonymous && !shouldSendAsAnonymous)) return;
      const isCurrentReactor = sendAsPeerId === reactor.peerId || shouldSendAsAnonymous && reactor.isAnonymous;
      if (isCurrentReactor) {
        hasCurrentSender = true;
      }
      result.push({
        amount: reactor.count,
        localAmount: isCurrentReactor && isTouched ? starsAmount : 0,
        isMy: reactor.isMy,
        isAnonymous: reactor.isAnonymous,
        user: peer
      });
    });
    if (!hasCurrentSender) {
      const sender = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, sendAsPeerId);
      result.push({
        amount: myReactorAmount,
        localAmount: isTouched ? starsAmount : 0,
        isMy: true,
        user: sender
      });
    }
    result.sort((a, b) => b.amount + b.localAmount - (a.amount + a.localAmount));
    return result.slice(0, MAX_TOP_REACTORS);
  }, [isTouched, message?.reactions?.topReactors, starsAmount, sendAsPeerId, shouldSendAsAnonymous]);
  const chatTitle = chat && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(oldLang, chat);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_22__["default"], {
    isOpen: Boolean(modal),
    onClose: closePaidReactionModal,
    isSlim: true,
    hasAbsoluteCloseButton: true,
    contentClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].content,
    isLowStackPriority: true,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].sendAsPeersMenuContainer,
      children: sendAsPeersMenu
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].headerControlPanel,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_stars_BalanceBlock__WEBPACK_IMPORTED_MODULE_24__["default"], {
        balance: starBalance,
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].modalBalance,
        withAddButton: true
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_StarSlider__WEBPACK_IMPORTED_MODULE_25__["default"], {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].slider,
      defaultValue: DEFAULT_STARS_AMOUNT,
      maxValue: maxAmount,
      onChange: handleAmountChange
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h3", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].title,
      children: oldLang('StarsReactionTitle')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].description,
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(oldLang('StarsReactionText', chatTitle), ['simple_markdown', 'emoji'])
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Separator__WEBPACK_IMPORTED_MODULE_23__["default"], {
      children: topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
        className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topLabel,
        children: oldLang('StarsReactionTopSenders')
      })
    }), topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].top,
      children: topReactors.map(reactor => {
        const countText = (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatInteger)(reactor.amount + reactor.localAmount);
        const peer = reactor.isAnonymous || !reactor.user || reactor.isMy && shouldSendAsAnonymous ? ANONYMOUS_PEER : reactor.user;
        const text = 'isCustomPeer' in peer ? oldLang(peer.titleKey) : peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(oldLang, peer);
        return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_PeerBadge__WEBPACK_IMPORTED_MODULE_16__["default"], {
          className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topPeer,
          peer: peer,
          badgeText: countText,
          badgeIcon: "star",
          badgeClassName: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].topBadge,
          text: text
        }, `${reactor.user?.id || 'anonymous'}-${countText}`);
      })
    }), topReactors && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Separator__WEBPACK_IMPORTED_MODULE_23__["default"], {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].separator
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_19__["default"], {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].checkBox, 'dialog-checkbox'),
      checked: !shouldSendAsAnonymous,
      onChange: handleShowInTopSendersChange,
      label: oldLang('StarsReactionShowMeInTopSenders')
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      size: "smaller",
      onClick: handleSend,
      children: lang('SendPaidReaction', {
        amount: starsAmount
      }, {
        withNodes: true,
        specialReplacement: {
          [_config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER]: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_15__["default"], {
            className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].buttonStar,
            name: "star"
          })
        }
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
      className: _PaidReactionModal_module_scss__WEBPACK_IMPORTED_MODULE_26__["default"].disclaimer,
      children: lang('StarsReactionTerms', {
        link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
          text: lang('StarsReactionLinkText'),
          url: lang('StarsReactionLink')
        })
      }, {
        withNodes: true
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const chat = modal && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChat)(global, modal.chatId);
  const message = modal && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectChatMessage)(global, modal.chatId, modal.messageId);
  const starBalance = global.stars?.balance;
  const maxAmount = global.appConfig?.paidReactionMaxAmount || MAX_REACTION_AMOUNT;
  const defaultPrivacy = global.settings.paidReactionPrivacy;
  const sendPaidReactionsAsPeerIds = chat?.sendPaidReactionsAsPeerIds;
  const currentUserId = global.currentUserId;
  const currentUser = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectUser)(global, currentUserId);
  return {
    chat,
    message,
    starBalance,
    maxAmount,
    defaultPrivacy,
    sendPaidReactionsAsPeerIds,
    currentUserId,
    currentUser
  };
})(PaidReactionModal)));

/***/ }),

/***/ "./src/components/modals/paidReaction/StarSlider.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/paidReaction/StarSlider.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"StarSlider-module__root","slider":"StarSlider-module__slider","sparkles":"StarSlider-module__sparkles","progress":"StarSlider-module__progress","floatingBadgeWrapper":"StarSlider-module__floatingBadgeWrapper","floatingBadge":"StarSlider-module__floatingBadge","floatingBadgeText":"StarSlider-module__floatingBadgeText","floatingBadgeTriangle":"StarSlider-module__floatingBadgeTriangle"});

/***/ }),

/***/ "./src/components/modals/paidReaction/StarSlider.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/paidReaction/StarSlider.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/fasterdom/fasterdom */ "./src/lib/fasterdom/fasterdom.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useEffectOnce */ "./src/hooks/useEffectOnce.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../hooks/useResizeObserver */ "./src/hooks/useResizeObserver.ts");
/* harmony import */ var _common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/AnimatedCounter */ "./src/components/common/AnimatedCounter.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_Sparkles__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../common/Sparkles */ "./src/components/common/Sparkles.tsx");
/* harmony import */ var _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./StarSlider.module.scss */ "./src/components/modals/paidReaction/StarSlider.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");












const DEFAULT_POINTS = [50, 100, 500, 1000, 2000, 5000, 10000];
const StarSlider = ({
  maxValue,
  defaultValue,
  className,
  onChange
}) => {
  const floatingBadgeRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const points = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const result = [];
    for (let i = 0; i < DEFAULT_POINTS.length; i++) {
      if (DEFAULT_POINTS[i] < maxValue) {
        result.push(DEFAULT_POINTS[i]);
      }
      if (DEFAULT_POINTS[i] >= maxValue) {
        result.push(maxValue);
        break;
      }
    }
    return result;
  }, [maxValue]);
  const [value, setValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  (0,_hooks_useEffectOnce__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    setValue(getProgress(points, defaultValue));
  });
  const updateSafeBadgePosition = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(() => {
    const badge = floatingBadgeRef.current;
    if (!badge) return;
    const parent = badge.parentElement;
    (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMeasure)(() => {
      const safeMinX = parent.offsetLeft + badge.offsetWidth / 2;
      const safeMaxX = parent.offsetLeft + parent.offsetWidth - badge.offsetWidth / 2;
      (0,_lib_fasterdom_fasterdom__WEBPACK_IMPORTED_MODULE_1__.requestMutation)(() => {
        parent.style.setProperty('--_min-x', `${safeMinX}px`);
        parent.style.setProperty('--_max-x', `${safeMaxX}px`);
      });
    });
  });
  (0,_hooks_useResizeObserver__WEBPACK_IMPORTED_MODULE_6__["default"])(floatingBadgeRef, updateSafeBadgePosition);
  const handleChange = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_5__["default"])(event => {
    const newValue = Number(event.currentTarget.value);
    setValue(newValue);
    onChange(getValue(points, newValue));
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].root, className),
    style: `--progress: ${value / points.length}`,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].floatingBadgeWrapper,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
        className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].floatingBadge,
        ref: floatingBadgeRef,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("div", {
          className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].floatingBadgeText,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_8__["default"], {
            name: "star",
            className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].floatingBadgeIcon
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_AnimatedCounter__WEBPACK_IMPORTED_MODULE_7__["default"], {
            text: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_3__.formatInteger)(getValue(points, value))
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("svg", {
          className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].floatingBadgeTriangle,
          width: "28",
          height: "28",
          viewBox: "0 0 28 28",
          fill: "none",
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("defs", {
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsxs)("linearGradient", {
              id: "StarBadgeTriangle",
              x1: "0",
              x2: "1",
              y1: "0",
              y2: "0",
              children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("stop", {
                offset: "-50%",
                "stop-color": "#FFAA00"
              }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("stop", {
                offset: "150%",
                "stop-color": "#FFCD3A"
              })]
            })
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("path", {
            d: "m 28,4 v 9 c 0.0089,7.283278 -3.302215,5.319646 -6.750951,8.589815 l -5.8284,5.82843 c -0.781,0.78105 -2.0474,0.78104 -2.8284,0 L 6.7638083,21.589815 C 2.8288652,17.959047 0.04527024,20.332086 0,13 V 4 C 0,4 0.00150581,0.97697493 3,1 5.3786658,1.018266 22.594519,0.9142007 25,1 c 2.992326,0.1067311 3,3 3,3 z",
            fill: "url(#StarBadgeTriangle)"
          })]
        })]
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("div", {
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].progress,
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)(_common_Sparkles__WEBPACK_IMPORTED_MODULE_9__["default"], {
        preset: "progress",
        className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].sparkles
      })
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_11__.jsx)("input", {
      className: _StarSlider_module_scss__WEBPACK_IMPORTED_MODULE_10__["default"].slider,
      type: "range",
      min: 0,
      max: points.length,
      defaultValue: getProgress(points, defaultValue),
      step: "any",
      onChange: handleChange
    })]
  });
};
function getProgress(points, value) {
  const pointIndex = points.findIndex(point => value <= point);
  const prevPoint = points[pointIndex - 1] || 1;
  const nextPoint = points[pointIndex] || points[points.length - 1];
  const progress = (value - prevPoint) / (nextPoint - prevPoint);
  return pointIndex + progress;
}
function getValue(points, progress) {
  const pointIndex = Math.floor(progress);
  const prevPoint = points[pointIndex - 1] || 1;
  const nextPoint = points[pointIndex] || points[points.length - 1];
  const value = prevPoint + (nextPoint - prevPoint) * (progress - pointIndex);
  return Math.round(value);
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarSlider));

/***/ }),

/***/ "./src/components/modals/stars/BalanceBlock.tsx":
/*!******************************************************!*\
  !*** ./src/components/modals/stars/BalanceBlock.tsx ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _common_BadgeButton__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../common/BadgeButton */ "./src/components/common/BadgeButton.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");










const BalanceBlock = ({
  balance,
  className,
  withAddButton
}) => {
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_4__["default"])();
  const {
    openStarsBalanceModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_3__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].balanceBlock, className),
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].balanceInfo,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)("span", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].smallerText,
        children: lang('StarsBalance')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].balanceBottom,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_7__["default"], {
          type: "gold",
          size: "middle"
        }), balance !== undefined ? (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__.formatStarsAmount)(lang, balance) : '…', withAddButton && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_BadgeButton__WEBPACK_IMPORTED_MODULE_5__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].addStarsButton,
          onClick: () => openStarsBalanceModal({}),
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_9__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_6__["default"], {
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_8__["default"].addStarsIcon,
            name: "add"
          })
        })]
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(BalanceBlock));

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.module.scss":
/*!*******************************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.module.scss ***!
  \*******************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"StarsBalanceModal-module__root","minimal":"StarsBalanceModal-module__minimal","transition":"StarsBalanceModal-module__transition","main":"StarsBalanceModal-module__main","container":"StarsBalanceModal-module__container","section":"StarsBalanceModal-module__section","sectionTitle":"StarsBalanceModal-module__sectionTitle","tos":"StarsBalanceModal-module__tos","logo":"StarsBalanceModal-module__logo","logoBackground":"StarsBalanceModal-module__logoBackground","headerHext":"StarsBalanceModal-module__headerHext","description":"StarsBalanceModal-module__description","header":"StarsBalanceModal-module__header","starHeaderText":"StarsBalanceModal-module__starHeaderText","botItem":"StarsBalanceModal-module__botItem","hiddenHeader":"StarsBalanceModal-module__hiddenHeader","closeButton":"StarsBalanceModal-module__closeButton","addStarsButton":"StarsBalanceModal-module__addStarsButton","addStarsIcon":"StarsBalanceModal-module__addStarsIcon","balanceBlock":"StarsBalanceModal-module__balanceBlock","balanceInfo":"StarsBalanceModal-module__balanceInfo","smallerText":"StarsBalanceModal-module__smallerText","balanceBottom":"StarsBalanceModal-module__balanceBottom","modalBalance":"StarsBalanceModal-module__modalBalance","starButton":"StarsBalanceModal-module__starButton","paymentContent":"StarsBalanceModal-module__paymentContent","paymentImages":"StarsBalanceModal-module__paymentImages","paymentPhoto":"StarsBalanceModal-module__paymentPhoto","avatarStar":"StarsBalanceModal-module__avatarStar","paymentImageBackground":"StarsBalanceModal-module__paymentImageBackground","paymentButton":"StarsBalanceModal-module__paymentButton","paymentButtonStar":"StarsBalanceModal-module__paymentButtonStar","transactions":"StarsBalanceModal-module__transactions","subscriptions":"StarsBalanceModal-module__subscriptions","tabs":"StarsBalanceModal-module__tabs","disclaimer":"StarsBalanceModal-module__disclaimer","amountBadge":"StarsBalanceModal-module__amountBadge","loadMore":"StarsBalanceModal-module__loadMore","loadMoreIcon":"StarsBalanceModal-module__loadMoreIcon"});

/***/ }),

/***/ "./src/components/modals/stars/StarsBalanceModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/stars/StarsBalanceModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../ui/InfiniteScroll */ "./src/components/ui/InfiniteScroll.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _ui_TabList__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../ui/TabList */ "./src/components/ui/TabList.tsx");
/* harmony import */ var _ui_Transition__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Transition */ "./src/components/ui/Transition.tsx");
/* harmony import */ var _BalanceBlock__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _StarTopupOptionList__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./StarTopupOptionList */ "./src/components/modals/stars/StarTopupOptionList.tsx");
/* harmony import */ var _subscription_StarsSubscriptionItem__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./subscription/StarsSubscriptionItem */ "./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx");
/* harmony import */ var _transaction_StarsTransactionItem__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./transaction/StarsTransactionItem */ "./src/components/modals/stars/transaction/StarsTransactionItem.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _assets_icons_StarLogo_svg__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../../../assets/icons/StarLogo.svg */ "./src/assets/icons/StarLogo.svg");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



























const TRANSACTION_TYPES = ['all', 'inbound', 'outbound'];
const TRANSACTION_TABS_KEYS = ['StarsTransactionsAll', 'StarsTransactionsIncoming', 'StarsTransactionsOutgoing'];
const TRANSACTION_ITEM_CLASS = 'StarsTransactionItem';
const SUBSCRIPTION_PURPOSE = 'subs';
const StarsBalanceModal = ({
  modal,
  starsBalanceState,
  canBuyPremium,
  shouldForceHeight
}) => {
  const {
    closeStarsBalanceModal,
    loadStarsTransactions,
    loadStarsSubscriptions,
    openStarsGiftingPickerModal,
    openInvoice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    balance,
    history,
    subscriptions
  } = starsBalanceState || {};
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [isHeaderHidden, setHeaderHidden] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  const [selectedTabIndex, setSelectedTabIndex] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(0);
  const [areBuyOptionsShown, showBuyOptions, hideBuyOptions] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isOpen = Boolean(modal && starsBalanceState);
  const {
    originStarsPayment,
    originReaction,
    originGift,
    topup
  } = modal || {};
  const shouldOpenOnBuy = originStarsPayment || originReaction || originGift || topup;
  const ongoingTransactionAmount = originStarsPayment?.form?.invoice?.totalAmount || originStarsPayment?.subscriptionInfo?.subscriptionPricing?.amount || originReaction?.amount || originGift?.gift.stars || topup?.balanceNeeded;
  const starsNeeded = ongoingTransactionAmount ? ongoingTransactionAmount - (balance?.amount || 0) : undefined;
  const starsNeededText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const global = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getGlobal)();
    if (originReaction) {
      const channel = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectChat)(global, originReaction.chatId);
      if (!channel) return undefined;
      return oldLang('StarsNeededTextReactions', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getChatTitle)(oldLang, channel));
    }
    if (originStarsPayment) {
      const bot = originStarsPayment.form?.botId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUser)(global, originStarsPayment.form.botId) : undefined;
      if (!bot) return undefined;
      return oldLang('StarsNeededText', (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getUserFullName)(bot));
    }
    if (originGift) {
      const peer = (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectUser)(global, originGift.peerId);
      if (!peer) return undefined;
      return oldLang('StarsNeededTextGift', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_4__.getPeerTitle)(lang, peer));
    }
    if (topup?.purpose === SUBSCRIPTION_PURPOSE) {
      return oldLang('StarsNeededTextLink');
    }
    if (topup?.purpose === _config__WEBPACK_IMPORTED_MODULE_2__.PAID_MESSAGES_PURPOSE) {
      return lang('StarsNeededTextSendPaidMessages', undefined, {
        withMarkdown: true,
        withNodes: true
      });
    }
    return undefined;
  }, [originReaction, originStarsPayment, originGift, topup?.purpose, lang, oldLang]);
  const shouldShowItems = Boolean(history?.all?.transactions.length && !shouldOpenOnBuy);
  const shouldSuggestGifting = !shouldOpenOnBuy;
  const transactionTabs = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    return TRANSACTION_TABS_KEYS.map(key => ({
      title: lang(key)
    }));
  }, [lang]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setHeaderHidden(true);
      setSelectedTabIndex(0);
      hideBuyOptions();
    }
  }, [isOpen]);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (shouldOpenOnBuy) {
      showBuyOptions();
      return;
    }
    hideBuyOptions();
  }, [shouldOpenOnBuy]);
  const tosText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!isOpen) return undefined;
    const text = oldLang('lng_credits_summary_options_about');
    const parts = text.split('{link}');
    return [parts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_13__["default"], {
      url: oldLang('StarsTOSLink'),
      text: oldLang('lng_credits_summary_options_about_link')
    }), parts[1]];
  }, [isOpen, oldLang]);
  function handleScroll(e) {
    const {
      scrollTop
    } = e.currentTarget;
    setHeaderHidden(scrollTop <= 150);
  }
  const handleLoadMoreTransactions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    loadStarsTransactions({
      type: TRANSACTION_TYPES[selectedTabIndex]
    });
  });
  const handleLoadMoreSubscriptions = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    loadStarsSubscriptions();
  });
  const openStarsGiftingPickerModalHandler = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    openStarsGiftingPickerModal({});
  });
  const handleBuyStars = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(option => {
    openInvoice({
      type: 'stars',
      stars: option.stars,
      currency: option.currency,
      amount: option.amount
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_16__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].root, !shouldForceHeight && !areBuyOptionsShown && _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].minimal),
    isOpen: isOpen,
    onClose: closeStarsBalanceModal,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
        round: true,
        size: "smaller",
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].closeButton,
        color: "translucent",
        onClick: () => closeStarsBalanceModal(),
        ariaLabel: lang('Close'),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
          name: "close"
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_BalanceBlock__WEBPACK_IMPORTED_MODULE_19__["default"], {
        balance: balance,
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].modalBalance
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].header, isHeaderHidden && _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].hiddenHeader),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("h2", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].starHeaderText,
          children: oldLang('TelegramStars')
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("img", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].logo,
          src: _assets_icons_StarLogo_svg__WEBPACK_IMPORTED_MODULE_24__,
          alt: "",
          draggable: false
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("img", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].logoBackground,
          src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_25__,
          alt: "",
          draggable: false
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("h2", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].headerText,
          children: starsNeeded ? oldLang('StarsNeededTitle', ongoingTransactionAmount) : oldLang('TelegramStars')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].description,
          children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(starsNeededText || oldLang('TelegramStarsInfo'), ['simple_markdown', 'emoji'])
        }), canBuyPremium && !areBuyOptionsShown && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].starButton,
          onClick: showBuyOptions,
          children: oldLang('Star.List.BuyMoreStars')
        }), canBuyPremium && !areBuyOptionsShown && shouldSuggestGifting && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
          isText: true,
          noForcedUpperCase: true,
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].starButton,
          onClick: openStarsGiftingPickerModalHandler,
          children: oldLang('TelegramStarsGift')
        }), areBuyOptionsShown && starsBalanceState?.topupOptions && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_StarTopupOptionList__WEBPACK_IMPORTED_MODULE_20__["default"], {
          starsNeeded: starsNeeded,
          options: starsBalanceState.topupOptions,
          onClick: handleBuyStars
        })]
      }), areBuyOptionsShown && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].tos,
        children: tosText
      }), shouldShowItems && Boolean(subscriptions?.list.length) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("h3", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].sectionTitle,
          children: oldLang('StarMySubscriptions')
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].subscriptions,
          children: [subscriptions?.list.map(subscription => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_subscription_StarsSubscriptionItem__WEBPACK_IMPORTED_MODULE_21__["default"], {
            subscription: subscription
          }, subscription.id)), subscriptions?.nextOffset && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
            isText: true,
            disabled: subscriptions.isLoading,
            size: "smaller",
            noForcedUpperCase: true,
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].loadMore,
            onClick: handleLoadMoreSubscriptions,
            children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_12__["default"], {
              name: "down",
              className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].loadMoreIcon
            }), oldLang('StarMySubscriptionsExpand')]
          })]
        })]
      }), shouldShowItems && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsxs)("div", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].container,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)("div", {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].section,
          children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_Transition__WEBPACK_IMPORTED_MODULE_18__["default"], {
            name: lang.isRtl ? 'slideOptimizedRtl' : 'slideOptimized',
            activeKey: selectedTabIndex,
            renderCount: TRANSACTION_TABS_KEYS.length,
            shouldRestoreHeight: true,
            className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].transition,
            children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_InfiniteScroll__WEBPACK_IMPORTED_MODULE_15__["default"], {
              onLoadMore: handleLoadMoreTransactions,
              items: history?.[TRANSACTION_TYPES[selectedTabIndex]]?.transactions,
              scrollContainerClosest: `.${_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].main}`,
              itemSelector: `.${TRANSACTION_ITEM_CLASS}`,
              className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].transactions,
              noFastList: true,
              noScrollRestoreOnTop: true,
              children: history?.[TRANSACTION_TYPES[selectedTabIndex]]?.transactions.map(transaction => (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_transaction_StarsTransactionItem__WEBPACK_IMPORTED_MODULE_22__["default"], {
                transaction: transaction,
                className: TRANSACTION_ITEM_CLASS
              }, `${transaction.id}-${transaction.isRefund}`))
            })
          })
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_26__.jsx)(_ui_TabList__WEBPACK_IMPORTED_MODULE_17__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].tabs,
          tabClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_23__["default"].tab,
          activeTab: selectedTabIndex,
          tabs: transactionTabs,
          onSwitchTab: setSelectedTabIndex
        })]
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)(global => {
  const shouldForceHeight = Boolean(global.stars?.history?.all?.transactions.length);
  return {
    shouldForceHeight,
    starsBalanceState: global.stars,
    canBuyPremium: !(0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectIsPremiumPurchaseBlocked)(global)
  };
})(StarsBalanceModal)));

/***/ }),

/***/ "./src/components/modals/stars/StarsPaymentModal.tsx":
/*!***********************************************************!*\
  !*** ./src/components/modals/stars/StarsPaymentModal.tsx ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../hooks/useFlag */ "./src/hooks/useFlag.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_PeerBadge__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/PeerBadge */ "./src/components/common/PeerBadge.tsx");
/* harmony import */ var _common_PeerChip__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../common/PeerChip */ "./src/components/common/PeerChip.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _BalanceBlock__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./BalanceBlock */ "./src/components/modals/stars/BalanceBlock.tsx");
/* harmony import */ var _transaction_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./transaction/PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./StarsBalanceModal.module.scss */ "./src/components/modals/stars/StarsBalanceModal.module.scss");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");

























const StarPaymentModal = ({
  modal,
  bot,
  starsBalanceState,
  paidMediaMessage,
  paidMediaChat
}) => {
  const {
    closeStarsPaymentModal,
    openStarsBalanceModal,
    sendStarPaymentForm
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [isLoading, markLoading, unmarkLoading] = (0,_hooks_useFlag__WEBPACK_IMPORTED_MODULE_8__["default"])();
  const isOpen = Boolean(modal?.inputInvoice && starsBalanceState);
  const prevModal = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_12__["default"])(modal);
  const renderingModal = modal || prevModal;
  const {
    form,
    subscriptionInfo
  } = renderingModal || {};
  const amount = form?.invoice?.totalAmount || subscriptionInfo?.subscriptionPricing?.amount;
  const isBotSubscription = Boolean(form?.invoice.subscriptionPeriod);
  const canShowPeerItem = !subscriptionInfo?.subscriptionPricing;
  const photo = form?.photo;
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_11__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      unmarkLoading();
    }
  }, [isOpen]);
  const descriptionText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!renderingModal?.inputInvoice) {
      return '';
    }
    const botName = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getUserFullName)(bot);
    const starsText = oldLang('Stars.Intro.PurchasedText.Stars', amount);
    if (paidMediaMessage) {
      const extendedMedia = paidMediaMessage.content.paidMedia.extendedMedia;
      const areAllPhotos = extendedMedia.every(media => !media.duration);
      const areAllVideos = extendedMedia.every(media => Boolean(media.duration));
      const mediaText = areAllPhotos ? oldLang('Stars.Transfer.Photos', extendedMedia.length) : areAllVideos ? oldLang('Stars.Transfer.Videos', extendedMedia.length) : oldLang('Media', extendedMedia.length);
      const channelTitle = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getChatTitle)(oldLang, paidMediaChat);
      return oldLang('Stars.Transfer.UnlockInfo', [mediaText, channelTitle, starsText]);
    }
    if (subscriptionInfo) {
      return lang('StarsSubscribeText', {
        chat: subscriptionInfo.title,
        amount
      }, {
        withNodes: true,
        withMarkdown: true,
        pluralValue: amount
      });
    }
    if (isBotSubscription) {
      return lang('StarsSubscribeBotText', {
        name: form.title,
        amount,
        bot: botName
      }, {
        pluralValue: amount
      });
    }
    return oldLang('Stars.Transfer.Info', [form.title, botName, starsText]);
  }, [renderingModal?.inputInvoice, bot, oldLang, amount, paidMediaMessage, subscriptionInfo, isBotSubscription, form, paidMediaChat, lang]);
  const disclaimerText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (subscriptionInfo) {
      return lang('StarsSubscribeInfo', {
        link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_17__["default"], {
          url: lang('StarsSubscribeInfoLink'),
          text: lang('StarsSubscribeInfoLinkText')
        })
      }, {
        withNodes: true
      });
    }
    return undefined;
  }, [subscriptionInfo, lang]);
  const inviteCustomPeer = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscriptionInfo) {
      return undefined;
    }
    return (0,_global_helpers__WEBPACK_IMPORTED_MODULE_2__.getCustomPeerFromInvite)(subscriptionInfo);
  }, [subscriptionInfo]);
  const handlePayment = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_10__["default"])(() => {
    const balance = starsBalanceState?.balance;
    if (amount === undefined || balance === undefined) {
      return;
    }
    if (amount > balance.amount) {
      openStarsBalanceModal({
        originStarsPayment: modal
      });
      return;
    }
    sendStarPaymentForm({});
    markLoading();
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_ui_Modal__WEBPACK_IMPORTED_MODULE_19__["default"], {
    contentClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentContent,
    isOpen: isOpen,
    hasAbsoluteCloseButton: true,
    isSlim: true,
    onClose: closeStarsPaymentModal,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_BalanceBlock__WEBPACK_IMPORTED_MODULE_20__["default"], {
      balance: starsBalanceState?.balance,
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].modalBalance
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentImages,
      dir: oldLang.isRtl ? 'ltr' : 'rtl',
      children: [paidMediaMessage ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_transaction_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_21__["default"], {
        media: paidMediaMessage.content.paidMedia.extendedMedia
      }) : inviteCustomPeer ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_13__["default"], {
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentPhoto,
          peer: inviteCustomPeer,
          size: "giant"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_14__["default"], {
          type: "gold",
          size: "adaptive",
          className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].avatarStar
        })]
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_PeerBadge__WEBPACK_IMPORTED_MODULE_15__["default"], {
        peer: !photo ? bot : undefined,
        avatarWebPhoto: photo,
        avatarSize: "giant",
        badgeIcon: "star",
        badgeText: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_6__.formatInteger)(amount),
        badgeClassName: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].amountBadge,
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentPhoto
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("img", {
        className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentImageBackground,
        src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_23__,
        alt: "",
        draggable: false
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("h2", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].headerText,
      children: inviteCustomPeer ? oldLang('StarsSubscribeTitle') : oldLang('StarsConfirmPurchaseTitle')
    }), canShowPeerItem && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_common_PeerChip__WEBPACK_IMPORTED_MODULE_16__["default"], {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].botItem,
      peerId: form?.botId
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].description,
      children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_7__["default"])(descriptionText, ['simple_markdown', 'emoji'])
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_18__["default"], {
      className: _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].paymentButton,
      size: "smaller",
      onClick: handlePayment,
      isLoading: isLoading,
      children: lang(isBotSubscription ? 'StarsSubscribeBotButtonMonth' : 'StarsPay', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_5__.formatStarsAsIcon)(lang, amount, {
          asFont: true
        })
      }, {
        withNodes: true
      })
    }), Boolean(disclaimerText) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_24__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].disclaimer, _StarsBalanceModal_module_scss__WEBPACK_IMPORTED_MODULE_22__["default"].smallerText),
      children: disclaimerText
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const bot = modal?.form?.botId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.form.botId) : undefined;
  const messageInputInvoice = modal?.inputInvoice?.type === 'message' ? modal.inputInvoice : undefined;
  const message = messageInputInvoice ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChatMessage)(global, messageInputInvoice.chatId, messageInputInvoice.messageId) : undefined;
  const chat = messageInputInvoice ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectChat)(global, messageInputInvoice.chatId) : undefined;
  const isPaidMedia = message?.content.paidMedia;
  return {
    bot,
    starsBalanceState: global.stars,
    paidMediaMessage: isPaidMedia ? message : undefined,
    paidMediaChat: isPaidMedia ? chat : undefined
  };
})(StarPaymentModal)));

/***/ }),

/***/ "./src/components/modals/stars/chatRefund/ChatRefundModal.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/stars/chatRefund/ChatRefundModal.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../ui/Checkbox */ "./src/components/ui/Checkbox.tsx");
/* harmony import */ var _ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../ui/ConfirmDialog */ "./src/components/ui/ConfirmDialog.tsx");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");











const ChatRefundModal = ({
  modal,
  user
}) => {
  const {
    closeChatRefundModal,
    addNoPaidMessagesException
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const [shouldRefundStars, setShouldRefundStars] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(false);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(modal);
  const renderingUser = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_5__["default"])(user);
  const {
    starsToRefund,
    userId
  } = renderingModal || {};
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_6__["default"])();
  const isOpen = Boolean(modal);
  const handleConfirmRemoveFee = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_7__["default"])(() => {
    closeChatRefundModal();
    if (!userId) return;
    addNoPaidMessagesException({
      userId,
      shouldRefundCharged: shouldRefundStars
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsxs)(_ui_ConfirmDialog__WEBPACK_IMPORTED_MODULE_9__["default"], {
    isOpen: isOpen,
    onClose: closeChatRefundModal,
    title: lang('RemoveFeeTitle'),
    confirmLabel: lang('ConfirmRemoveMessageFee'),
    confirmHandler: handleConfirmRemoveFee,
    children: [lang('ConfirmDialogMessageRemoveFee', {
      peer: renderingUser && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, renderingUser)
    }, {
      withMarkdown: true,
      withNodes: true
    }), Boolean(starsToRefund) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_10__.jsx)(_ui_Checkbox__WEBPACK_IMPORTED_MODULE_8__["default"], {
      className: "dialog-checkbox",
      label: lang('ConfirmDialogRemoveFeeRefundStars', {
        amount: (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_4__.formatStarsAsText)(lang, starsToRefund)
      }, {
        withMarkdown: true,
        withNodes: true
      }),
      checked: shouldRefundStars,
      onCheck: setShouldRefundStars
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const user = modal?.userId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.userId) : undefined;
  return {
    user
  };
})(ChatRefundModal)));

/***/ }),

/***/ "./src/components/modals/stars/gift/StarsGiftModal.module.scss":
/*!*********************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.module.scss ***!
  \*********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modalDialog":"StarsGiftModal-module__modalDialog","content":"StarsGiftModal-module__content","main":"StarsGiftModal-module__main","headerInfo":"StarsGiftModal-module__headerInfo","logo":"StarsGiftModal-module__logo","logoBackground":"StarsGiftModal-module__logoBackground","description":"StarsGiftModal-module__description","section":"StarsGiftModal-module__section","header":"StarsGiftModal-module__header","starHeaderText":"StarsGiftModal-module__starHeaderText","hiddenHeader":"StarsGiftModal-module__hiddenHeader","closeButton":"StarsGiftModal-module__closeButton","avatar":"StarsGiftModal-module__avatar","center":"StarsGiftModal-module__center","secondaryInfo":"StarsGiftModal-module__secondaryInfo"});

/***/ }),

/***/ "./src/components/modals/stars/gift/StarsGiftModal.tsx":
/*!*************************************************************!*\
  !*** ./src/components/modals/stars/gift/StarsGiftModal.tsx ***!
  \*************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/formatCurrency */ "./src/util/formatCurrency.tsx");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useCurrentOrPrev */ "./src/hooks/useCurrentOrPrev.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _ui_Modal__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../ui/Modal */ "./src/components/ui/Modal.tsx");
/* harmony import */ var _StarTopupOptionList__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../StarTopupOptionList */ "./src/components/modals/stars/StarTopupOptionList.tsx");
/* harmony import */ var _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./StarsGiftModal.module.scss */ "./src/components/modals/stars/gift/StarsGiftModal.module.scss");
/* harmony import */ var _assets_icons_StarLogo_svg__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../../assets/icons/StarLogo.svg */ "./src/assets/icons/StarLogo.svg");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




















const AVATAR_SIZE = 100;
const StarsGiftModal = ({
  modal,
  user
}) => {
  const {
    closeStarsGiftModal,
    openInvoice,
    requestConfetti
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const dialogRef = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)();
  const isOpen = Boolean(modal?.isOpen);
  const renderingModal = (0,_hooks_useCurrentOrPrev__WEBPACK_IMPORTED_MODULE_7__["default"])(modal);
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const [selectedOption, setSelectedOption] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const [isHeaderHidden, setHeaderHidden] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)(true);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (!isOpen) {
      setHeaderHidden(true);
    }
  }, [isOpen]);
  const showConfetti = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    const dialog = dialogRef.current;
    if (!dialog) return;
    if (isOpen) {
      const {
        top,
        left,
        width,
        height
      } = dialog.querySelector('.modal-content').getBoundingClientRect();
      requestConfetti({
        top,
        left,
        width,
        height,
        withStars: true
      });
    }
  });
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useEffect)(() => {
    if (renderingModal?.isCompleted) {
      showConfetti();
    }
  }, [renderingModal, showConfetti]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(option => {
    if (!renderingModal) return;
    setSelectedOption(option);
    if (user) {
      openInvoice({
        type: 'starsgift',
        userId: user.id,
        stars: option.stars,
        currency: option.currency,
        amount: option.amount
      });
    } else {
      openInvoice({
        type: 'stars',
        stars: option.stars,
        currency: option.currency,
        amount: option.amount
      });
    }
  });
  function handleScroll(e) {
    const {
      scrollTop
    } = e.currentTarget;
    setHeaderHidden(scrollTop <= 150);
  }
  const handleClose = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    closeStarsGiftModal();
  });
  function renderGiftTitle() {
    if (renderingModal?.isCompleted) {
      return user ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('Notification.StarsGift.SentYou', (0,_util_formatCurrency__WEBPACK_IMPORTED_MODULE_5__.formatCurrencyAsString)(selectedOption.amount, selectedOption.currency, oldLang.code)), ['simple_markdown']) : (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('StarsAcquiredInfo', selectedOption?.stars), ['simple_markdown']);
    }
    return user ? oldLang('GiftStarsTitle') : oldLang('Star.List.GetStars');
  }
  const bottomText = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    const text = oldLang('lng_credits_summary_options_about');
    const parts = text.split('{link}');
    return [parts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_12__["default"], {
      url: oldLang('StarsTOSLink'),
      text: oldLang('lng_credits_summary_options_about_link')
    }), parts[1]];
  }, [oldLang]);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_ui_Modal__WEBPACK_IMPORTED_MODULE_14__["default"], {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].modalDialog),
    contentClassName: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].content,
    dialogRef: dialogRef,
    isSlim: true,
    onClose: handleClose,
    isOpen: isOpen,
    children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].main, 'custom-scroll'),
      onScroll: handleScroll,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_13__["default"], {
        round: true,
        size: "smaller",
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].closeButton,
        color: "translucent",
        onClick: () => closeStarsGiftModal(),
        ariaLabel: oldLang('Close'),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_11__["default"], {
          name: "close"
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("div", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].header, isHeaderHidden && _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].hiddenHeader),
        children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("h2", {
          className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].starHeaderText,
          children: user ? oldLang('GiftStarsTitle') : oldLang('Star.List.GetStars')
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("div", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].headerInfo,
        children: user ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
            size: AVATAR_SIZE,
            peer: user,
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].avatar
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].logoBackground,
            src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_18__,
            alt: "",
            draggable: false
          })]
        }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.Fragment, {
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].logo,
            src: _assets_icons_StarLogo_svg__WEBPACK_IMPORTED_MODULE_17__,
            alt: "",
            draggable: false
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("img", {
            className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].logoBackground,
            src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_18__,
            alt: "",
            draggable: false
          })]
        })
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("h2", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_4__["default"])(_StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].headerText, _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].center),
        children: renderGiftTitle()
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("p", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].description,
        children: user ? (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(oldLang('ActionGiftStarsSubtitle', (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(oldLang, user)), ['simple_markdown']) : oldLang('Stars.Purchase.GetStarsInfo')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsxs)("div", {
        className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].section,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)(_StarTopupOptionList__WEBPACK_IMPORTED_MODULE_15__["default"], {
          options: renderingModal?.starsGiftOptions,
          onClick: handleClick
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_19__.jsx)("div", {
          className: _StarsGiftModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].secondaryInfo,
          children: bottomText
        })]
      })]
    })
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const user = modal?.forUserId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectUser)(global, modal.forUserId) : undefined;
  return {
    user
  };
})(StarsGiftModal)));

/***/ }),

/***/ "./src/components/modals/stars/helpers/transaction.ts":
/*!************************************************************!*\
  !*** ./src/components/modals/stars/helpers/transaction.ts ***!
  \************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getTransactionTitle: () => (/* binding */ getTransactionTitle),
/* harmony export */   isNegativeStarsAmount: () => (/* binding */ isNegativeStarsAmount)
/* harmony export */ });
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");


function getTransactionTitle(oldLang, lang, transaction) {
  if (transaction.paidMessages) {
    return lang('PaidMessageTransaction', {
      count: transaction.paidMessages
    }, {
      withNodes: true,
      pluralValue: transaction.paidMessages
    });
  }
  if (transaction.isGiftResale) {
    return isNegativeStarsAmount(transaction.stars) ? lang('StarGiftSaleTransaction') : lang('StarGiftPurchaseTransaction');
  }
  if (transaction.starRefCommision) {
    return oldLang('StarTransactionCommission', (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_1__.formatPercent)(transaction.starRefCommision));
  }
  if (transaction.isGiftUpgrade) return oldLang('Gift2TransactionUpgraded');
  if (transaction.extendedMedia) return oldLang('StarMediaPurchase');
  if (transaction.subscriptionPeriod) return transaction.title || oldLang('StarSubscriptionPurchase');
  if (transaction.isReaction) return oldLang('StarsReactionsSent');
  if (transaction.giveawayPostId) return oldLang('StarsGiveawayPrizeReceived');
  if (transaction.isMyGift) return oldLang('StarsGiftSent');
  if (transaction.isGift) return oldLang('StarsGiftReceived');
  if (transaction.starGift) {
    return isNegativeStarsAmount(transaction.stars) ? oldLang('Gift2TransactionSent') : oldLang('Gift2ConvertedTitle');
  }
  const customPeer = transaction.peer && transaction.peer.type !== 'peer' && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_0__.buildStarsTransactionCustomPeer)(transaction.peer) || undefined;
  if (customPeer) return customPeer.title || oldLang(customPeer.titleKey);
  return transaction.title;
}
function isNegativeStarsAmount(starsAmount) {
  if (starsAmount.amount) return starsAmount.amount < 0;
  return starsAmount.nanos < 0;
}

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss":
/*!************************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss ***!
  \************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"StarsSubscriptionItem-module__root","info":"StarsSubscriptionItem-module__info","status":"StarsSubscriptionItem-module__status","statusPricing":"StarsSubscriptionItem-module__statusPricing","amount":"StarsSubscriptionItem-module__amount","title":"StarsSubscriptionItem-module__title","description":"StarsSubscriptionItem-module__description","subtitle":"StarsSubscriptionItem-module__subtitle","statusPeriod":"StarsSubscriptionItem-module__statusPeriod","statusEnded":"StarsSubscriptionItem-module__statusEnded","preview":"StarsSubscriptionItem-module__preview","subscriptionStar":"StarsSubscriptionItem-module__subscriptionStar"});

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx":
/*!****************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionItem.tsx ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./StarsSubscriptionItem.module.scss */ "./src/components/modals/stars/subscription/StarsSubscriptionItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");














function selectProvidedPeer(peerId) {
  return global => (0,_global_selectors__WEBPACK_IMPORTED_MODULE_3__.selectPeer)(global, peerId);
}
const StarsSubscriptionItem = ({
  subscription
}) => {
  const {
    openStarsSubscriptionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    peerId,
    pricing,
    until,
    isCancelled,
    title,
    photo
  } = subscription;
  const lang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const peer = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_7__["default"])(selectProvidedPeer(peerId));
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    openStarsSubscriptionModal({
      subscription
    });
  });
  if (!peer) {
    return undefined;
  }
  const hasExpired = until < Date.now() / 1000;
  const formattedDate = (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_4__.formatDateToString)(until * 1000, lang.code, true, 'long');
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
    className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].root,
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].preview,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
        size: "medium",
        peer: peer
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__["default"], {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].subscriptionStar,
        type: "gold",
        size: "small"
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].info,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("h3", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].title,
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])((0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_2__.getPeerTitle)(lang, peer) || '')
      }), title && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("p", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].subtitle,
        children: [photo && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_10__["default"], {
          webPhoto: photo,
          size: "micro"
        }), (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_6__["default"])(title)]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("p", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].description,
        children: lang(hasExpired ? 'StarsSubscriptionExpired' : isCancelled ? 'StarsSubscriptionExpires' : 'StarsSubscriptionRenews', formattedDate)
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
      className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].status,
      children: isCancelled || hasExpired ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
        className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusEnded,
        children: lang(hasExpired ? 'StarsSubscriptionStatusExpired' : 'StarsSubscriptionStatusCancelled')
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div", {
          className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusPricing,
          children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_11__["default"], {
            className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].star,
            type: "gold",
            size: "adaptive"
          }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span", {
            className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].amount,
            children: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_5__.formatInteger)(pricing.amount)
          })]
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div", {
          className: _StarsSubscriptionItem_module_scss__WEBPACK_IMPORTED_MODULE_12__["default"].statusPeriod,
          children: lang('StarsParticipantSubscriptionPerMonth')
        })]
      })
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarsSubscriptionItem));

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss":
/*!*************************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss ***!
  \*************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"StarsSubscriptionModal-module__modal","header":"StarsSubscriptionModal-module__header","title":"StarsSubscriptionModal-module__title","amount":"StarsSubscriptionModal-module__amount","footer":"StarsSubscriptionModal-module__footer","starsBackground":"StarsSubscriptionModal-module__starsBackground","avatarWrapper":"StarsSubscriptionModal-module__avatarWrapper","subscriptionStar":"StarsSubscriptionModal-module__subscriptionStar","amountStar":"StarsSubscriptionModal-module__amountStar","secondary":"StarsSubscriptionModal-module__secondary","danger":"StarsSubscriptionModal-module__danger"});

/***/ }),

/***/ "./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx":
/*!*****************************************************************************!*\
  !*** ./src/components/modals/stars/subscription/StarsSubscriptionModal.tsx ***!
  \*****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../config */ "./src/config.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _ui_Button__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../ui/Button */ "./src/components/ui/Button.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./StarsSubscriptionModal.module.scss */ "./src/components/modals/stars/subscription/StarsSubscriptionModal.module.scss");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");



















const StarsSubscriptionModal = ({
  modal,
  peer
}) => {
  const {
    closeStarsSubscriptionModal,
    fulfillStarsSubscription,
    changeStarsSubscription,
    checkChatInvite,
    loadStarStatus,
    openInvoice
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_9__["default"])();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_7__["default"])();
  const {
    subscription
  } = modal || {};
  const buttonState = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscription) {
      return 'hidden';
    }
    if (subscription.canRefulfill) {
      return 'refulfill';
    }
    const isActive = subscription.until > Date.now() / 1000;
    if (isActive && !subscription.isCancelled) {
      return 'cancel';
    }
    if (isActive && subscription.isCancelled) {
      return 'renew';
    }
    const canRestart = subscription.chatInviteHash || subscription.invoiceSlug;
    if (!isActive && canRestart) {
      return 'restart';
    }
    return 'ok';
  }, [subscription]);
  const handleButtonClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_8__["default"])(() => {
    if (!subscription) {
      return;
    }
    switch (buttonState) {
      case 'refulfill':
        {
          fulfillStarsSubscription({
            id: subscription.id
          });
          break;
        }
      case 'restart':
        {
          if (subscription.chatInviteHash) {
            checkChatInvite({
              hash: subscription.chatInviteHash
            });
          } else if (subscription.invoiceSlug) {
            openInvoice({
              type: 'slug',
              slug: subscription.invoiceSlug
            });
          }
          loadStarStatus();
          break;
        }
      case 'renew':
        {
          changeStarsSubscription({
            id: subscription.id,
            isCancelled: false
          });
          break;
        }
      case 'cancel':
        {
          changeStarsSubscription({
            id: subscription.id,
            isCancelled: true
          });
          break;
        }
    }
    closeStarsSubscriptionModal();
  });
  const starModalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!subscription || !peer) {
      return undefined;
    }
    const {
      pricing,
      until,
      isCancelled,
      canRefulfill,
      photo,
      title,
      hasBotCancelled
    } = subscription;
    const isBotSubscription = (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.isApiPeerUser)(peer);
    const header = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
      className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].header,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("div", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].avatarWrapper,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_11__["default"], {
          peer: !photo ? peer : undefined,
          webPhoto: photo,
          size: "giant"
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__["default"], {
          className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].subscriptionStar,
          type: "gold",
          size: "adaptive"
        })]
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("img", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].starsBackground),
        src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_17__,
        alt: "",
        draggable: false
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("h1", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].title,
        children: title || oldLang('StarsSubscriptionTitle')
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].amount,
        children: lang('StarsPerMonth', {
          amount: pricing.amount
        }, {
          withNodes: true,
          specialReplacement: {
            [_config__WEBPACK_IMPORTED_MODULE_2__.STARS_ICON_PLACEHOLDER]: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_12__["default"], {
              className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].amountStar,
              size: "adaptive",
              type: "gold"
            })
          }
        })
      })]
    });
    const tableData = [];
    tableData.push([oldLang(isBotSubscription ? 'StarsSubscriptionBot' : 'StarsSubscriptionChannel'), {
      chatId: peer.id
    }]);
    if (title) {
      tableData.push([oldLang('StarsSubscriptionBotProduct'), title]);
    }
    const hasExpired = until < Date.now() / 1000;
    tableData.push([oldLang(hasExpired ? 'StarsSubscriptionUntilExpired' : isCancelled ? 'StarsSubscriptionUntilExpires' : 'StarsSubscriptionUntilRenews'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true)]);
    const footerTos = lang('StarsTransactionTOS', {
      link: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_13__["default"], {
        url: lang('StarsTransactionTOSLink'),
        text: lang('StarsTransactionTOSLinkText')
      })
    }, {
      withNodes: true
    });
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsxs)("span", {
      className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].footer,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].secondary,
        children: footerTos
      }), isCancelled && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].danger,
        children: oldLang(hasBotCancelled ? 'StarsSubscriptionBotCancelledText' : 'StarsSubscriptionCancelledText')
      }), canRefulfill && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].secondary,
        children: oldLang('StarsSubscriptionRefulfillInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), !isCancelled && !canRefulfill && hasExpired && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].secondary,
        children: oldLang('StarsSubscriptionExpiredInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), !isCancelled && !canRefulfill && !hasExpired && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)("p", {
        className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].secondary,
        children: oldLang('StarsSubscriptionCancelInfo', (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(until * 1000, oldLang.code, true))
      }), buttonState !== 'hidden' && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_ui_Button__WEBPACK_IMPORTED_MODULE_14__["default"], {
        size: "smaller",
        color: buttonState === 'cancel' ? 'danger' : 'primary',
        isText: buttonState === 'cancel',
        onClick: handleButtonClick,
        children: oldLang(buttonState === 'cancel' ? 'StarsSubscriptionCancel' : buttonState === 'refulfill' ? 'StarsSubscriptionRefulfill' : buttonState === 'restart' ? 'StarsSubscriptionAgain' : buttonState === 'renew' ? 'StarsSubscriptionRenew' : 'OK')
      })]
    });
    return {
      header,
      tableData,
      footer
    };
  }, [buttonState, lang, oldLang, peer, subscription]);
  const prevModalData = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_10__["default"])(starModalData);
  const renderingModalData = prevModalData || starModalData;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_18__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_15__["default"], {
    isOpen: Boolean(subscription),
    className: _StarsSubscriptionModal_module_scss__WEBPACK_IMPORTED_MODULE_16__["default"].modal,
    header: renderingModalData?.header,
    tableData: renderingModalData?.tableData,
    footer: renderingModalData?.footer,
    onClose: closeStarsSubscriptionModal
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const peerId = modal?.subscription.peerId;
  const peer = peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId) : undefined;
  return {
    peer
  };
})(StarsSubscriptionModal)));

/***/ }),

/***/ "./src/components/modals/stars/transaction/PaidMediaThumb.module.scss":
/*!****************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/PaidMediaThumb.module.scss ***!
  \****************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"PaidMediaThumb-module__root","preview":"PaidMediaThumb-module__preview","count":"PaidMediaThumb-module__count","thumb":"PaidMediaThumb-module__thumb","noOutline":"PaidMediaThumb-module__noOutline","itemCount1":"PaidMediaThumb-module__itemCount1","itemCount2":"PaidMediaThumb-module__itemCount2","itemCount3":"PaidMediaThumb-module__itemCount3","blurry":"PaidMediaThumb-module__blurry","full":"PaidMediaThumb-module__full","fadeIn":"PaidMediaThumb-module__fadeIn"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx":
/*!********************************************************************!*\
  !*** ./src/components/modals/stars/transaction/PaidMediaThumb.tsx ***!
  \********************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../hooks/useMedia */ "./src/hooks/useMedia.ts");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../common/MediaSpoiler */ "./src/components/common/MediaSpoiler.tsx");
/* harmony import */ var _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./PaidMediaThumb.module.scss */ "./src/components/modals/stars/transaction/PaidMediaThumb.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");








const THUMB_LIMIT = 3;
const PREVIEW_THUMB_LIMIT = 2;
const PaidMediaThumb = ({
  media,
  className,
  isTransactionPreview,
  onClick
}) => {
  const count = Math.min(media.length, isTransactionPreview ? PREVIEW_THUMB_LIMIT : THUMB_LIMIT);
  const isLocked = 'mediaType' in media[0];
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].root, _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"][`itemCount${count}`], isTransactionPreview && _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].preview, className),
    dir: "rtl",
    onClick: onClick,
    children: [media.slice(0, count).reverse().map((item, i, arr) => {
      const realIndex = arr.length - i - 1;
      return 'mediaType' in item ? (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_common_MediaSpoiler__WEBPACK_IMPORTED_MODULE_5__["default"], {
        className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].thumb,
        isVisible: true,
        width: item.width,
        height: item.height,
        thumbDataUri: item.thumbnail?.dataUri
      }) : (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(SingleMediaThumb, {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(isTransactionPreview && realIndex > 0 && _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].noOutline),
        boughtMedia: item,
        index: realIndex
      });
    }), isLocked && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].count,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_4__["default"], {
        name: "stars-lock"
      }), media.length > 1 ? media.length : '']
    })]
  });
};
function SingleMediaThumb({
  boughtMedia,
  index,
  className
}) {
  const media = boughtMedia.video || boughtMedia.photo;
  const mediaHash = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaHash)(media, 'pictogram');
  const thumb = (0,_global_helpers__WEBPACK_IMPORTED_MODULE_1__.getMediaThumbUri)(media);
  const mediaBlob = (0,_hooks_useMedia__WEBPACK_IMPORTED_MODULE_3__["default"])(mediaHash);
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_2__["default"])(_PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].thumb, index !== undefined && `stars-transaction-media-${index}`, className),
    children: [thumb && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("img", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].blurry,
      src: thumb,
      alt: ""
    }), mediaBlob && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_7__.jsx)("img", {
      className: _PaidMediaThumb_module_scss__WEBPACK_IMPORTED_MODULE_6__["default"].full,
      src: mediaBlob,
      alt: ""
    })]
  });
}
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(PaidMediaThumb));

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionItem.module.scss":
/*!**********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionItem.module.scss ***!
  \**********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"root":"StarsTransactionItem-module__root","info":"StarsTransactionItem-module__info","stars":"StarsTransactionItem-module__stars","amount":"StarsTransactionItem-module__amount","title":"StarsTransactionItem-module__title","description":"StarsTransactionItem-module__description","date":"StarsTransactionItem-module__date","positive":"StarsTransactionItem-module__positive","negative":"StarsTransactionItem-module__negative","preview":"StarsTransactionItem-module__preview","subscriptionStar":"StarsTransactionItem-module__subscriptionStar","uniqueGiftBackground":"StarsTransactionItem-module__uniqueGiftBackground","giftSticker":"StarsTransactionItem-module__giftSticker"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionItem.tsx":
/*!**************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionItem.tsx ***!
  \**************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers/peers */ "./src/global/helpers/peers.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/objects/customPeer */ "./src/util/objects/customPeer.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _common_helpers_renderText__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../common/helpers/renderText */ "./src/components/common/helpers/renderText.tsx");
/* harmony import */ var _helpers_transaction__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../helpers/transaction */ "./src/components/modals/stars/helpers/transaction.ts");
/* harmony import */ var _hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../../hooks/data/useSelector */ "./src/hooks/data/useSelector.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../common/profile/RadialPatternBackground */ "./src/components/common/profile/RadialPatternBackground.tsx");
/* harmony import */ var _PaidMediaThumb__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./StarsTransactionItem.module.scss */ "./src/components/modals/stars/transaction/StarsTransactionItem.module.scss");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");






















const GIFT_STICKER_SIZE = 36;
function selectOptionalPeer(peerId) {
  return global => peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_4__.selectPeer)(global, peerId) : undefined;
}
const StarsTransactionItem = ({
  transaction,
  className
}) => {
  const {
    openStarsTransactionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const {
    date,
    stars,
    photo,
    peer: transactionPeer,
    extendedMedia,
    subscriptionPeriod
  } = transaction;
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_12__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_14__["default"])();
  const peerId = transactionPeer.type === 'peer' ? transactionPeer.id : undefined;
  const peer = (0,_hooks_data_useSelector__WEBPACK_IMPORTED_MODULE_11__["default"])(selectOptionalPeer(peerId));
  const starGift = transaction.starGift;
  const isUniqueGift = starGift?.type === 'starGiftUnique';
  const giftSticker = starGift && (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getStickerFromGift)(starGift);
  const data = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    let title = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_10__.getTransactionTitle)(oldLang, lang, transaction);
    let description;
    let status;
    let avatarPeer;
    if (transaction.peer.type === 'peer') {
      description = peer && (0,_global_helpers_peers__WEBPACK_IMPORTED_MODULE_3__.getPeerTitle)(oldLang, peer);
      avatarPeer = peer || _util_objects_customPeer__WEBPACK_IMPORTED_MODULE_7__.CUSTOM_PEER_PREMIUM;
    } else {
      const customPeer = (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__.buildStarsTransactionCustomPeer)(transaction.peer);
      title = customPeer.title || oldLang(customPeer.titleKey);
      description = oldLang(customPeer.subtitleKey);
      avatarPeer = customPeer;
    }
    if (transaction.isGiftUpgrade && transaction.starGift?.type === 'starGiftUnique') {
      description = lang('GiftUnique', {
        title: transaction.starGift.title,
        number: transaction.starGift.number
      });
    }
    if (transaction.isGiftResale && transaction.starGift?.type === 'starGiftUnique') {
      description = lang('GiftUnique', {
        title: transaction.starGift.title,
        number: transaction.starGift.number
      });
    }
    if (transaction.photo) {
      avatarPeer = undefined;
    }
    if (transaction.isRefund) {
      status = oldLang('StarsRefunded');
    }
    if (transaction.hasFailed) {
      status = oldLang('StarsFailed');
    }
    if (transaction.isPending) {
      status = oldLang('StarsPending');
    }
    return {
      title,
      description,
      avatarPeer,
      status
    };
  }, [oldLang, lang, peer, transaction]);
  const previewContent = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (isUniqueGift) {
      const {
        backdrop
      } = (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_8__.getGiftAttributes)(starGift);
      const backgroundColors = [backdrop.centerColor, backdrop.edgeColor];
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_profile_RadialPatternBackground__WEBPACK_IMPORTED_MODULE_18__["default"], {
          className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].uniqueGiftBackground,
          backgroundColors: backgroundColors
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_15__["default"], {
          className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].giftSticker,
          sticker: giftSticker,
          size: GIFT_STICKER_SIZE,
          play: false
        })]
      });
    }
    if (giftSticker) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_15__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].giftSticker,
        sticker: giftSticker,
        size: GIFT_STICKER_SIZE,
        play: false
      });
    }
    if (extendedMedia) {
      return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_19__["default"], {
        media: extendedMedia,
        isTransactionPreview: true
      });
    }
    return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.Fragment, {
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_16__["default"], {
        size: "medium",
        webPhoto: photo,
        peer: data.avatarPeer
      }), Boolean(subscriptionPeriod) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_17__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].subscriptionStar,
        type: "gold",
        size: "small"
      })]
    });
  }, [isUniqueGift, extendedMedia, photo, data.avatarPeer, subscriptionPeriod, starGift, giftSticker]);
  const handleClick = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_13__["default"])(() => {
    openStarsTransactionModal({
      transaction
    });
  });
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
    className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].root, className),
    onClick: handleClick,
    children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].preview,
      children: previewContent
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].info,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("h3", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].title,
        children: data.title
      }), data.description && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("p", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].description,
        children: (0,_common_helpers_renderText__WEBPACK_IMPORTED_MODULE_9__["default"])(data.description)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("p", {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].date,
        children: [(0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_6__.formatDateTimeToString)(date * 1000, oldLang.code, true), data.status && ` — (${data.status})`]
      })]
    }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsxs)("div", {
      className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].stars,
      children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)("span", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_5__["default"])(_StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].amount, (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_10__.isNegativeStarsAmount)(stars) ? _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].negative : _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].positive),
        children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_2__.formatStarsTransactionAmount)(lang, stars)
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_21__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_17__["default"], {
        className: _StarsTransactionItem_module_scss__WEBPACK_IMPORTED_MODULE_20__["default"].star,
        type: "gold",
        size: "adaptive"
      })]
    })]
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)(StarsTransactionItem));

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.module.scss":
/*!***********************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.module.scss ***!
  \***********************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
// extracted by mini-css-extract-plugin
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({"modal":"StarsTransactionModal-module__modal","positive":"StarsTransactionModal-module__positive","negative":"StarsTransactionModal-module__negative","header":"StarsTransactionModal-module__header","uniqueGift":"StarsTransactionModal-module__uniqueGift","amount":"StarsTransactionModal-module__amount","title":"StarsTransactionModal-module__title","description":"StarsTransactionModal-module__description","tid":"StarsTransactionModal-module__tid","refunded":"StarsTransactionModal-module__refunded","totalStars":"StarsTransactionModal-module__totalStars","starIcon":"StarsTransactionModal-module__starIcon","footer":"StarsTransactionModal-module__footer","starsBackground":"StarsTransactionModal-module__starsBackground","copyIcon":"StarsTransactionModal-module__copyIcon","mediaPreview":"StarsTransactionModal-module__mediaPreview","subtitle":"StarsTransactionModal-module__subtitle","starGiftSticker":"StarsTransactionModal-module__starGiftSticker"});

/***/ }),

/***/ "./src/components/modals/stars/transaction/StarsTransactionModal.tsx":
/*!***************************************************************************!*\
  !*** ./src/components/modals/stars/transaction/StarsTransactionModal.tsx ***!
  \***************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _global__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../../global */ "./src/global/index.ts");
/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../../types */ "./src/types/index.ts");
/* harmony import */ var _global_helpers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../../../global/helpers */ "./src/global/helpers/index.ts");
/* harmony import */ var _global_helpers_payments__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../../../global/helpers/payments */ "./src/global/helpers/payments.ts");
/* harmony import */ var _global_selectors__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../../../global/selectors */ "./src/global/selectors/index.ts");
/* harmony import */ var _util_buildClassName__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../../../util/buildClassName */ "./src/util/buildClassName.ts");
/* harmony import */ var _util_clipboard__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../../../util/clipboard */ "./src/util/clipboard.ts");
/* harmony import */ var _util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../../../util/dates/dateFormat */ "./src/util/dates/dateFormat.ts");
/* harmony import */ var _util_localization_format__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../../../util/localization/format */ "./src/util/localization/format.tsx");
/* harmony import */ var _util_textFormat__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../../../util/textFormat */ "./src/util/textFormat.ts");
/* harmony import */ var _common_helpers_gifts__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../../common/helpers/gifts */ "./src/components/common/helpers/gifts.ts");
/* harmony import */ var _helpers_transaction__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../helpers/transaction */ "./src/components/modals/stars/helpers/transaction.ts");
/* harmony import */ var _hooks_useLang__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../../../../hooks/useLang */ "./src/hooks/useLang.ts");
/* harmony import */ var _hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../../../../hooks/useLastCallback */ "./src/hooks/useLastCallback.ts");
/* harmony import */ var _hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../../../../hooks/useOldLang */ "./src/hooks/useOldLang.ts");
/* harmony import */ var _hooks_usePrevious__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../../../../hooks/usePrevious */ "./src/hooks/usePrevious.ts");
/* harmony import */ var _common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../../../common/AnimatedIconFromSticker */ "./src/components/common/AnimatedIconFromSticker.tsx");
/* harmony import */ var _common_Avatar__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../../../common/Avatar */ "./src/components/common/Avatar.tsx");
/* harmony import */ var _common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../../../common/icons/Icon */ "./src/components/common/icons/Icon.tsx");
/* harmony import */ var _common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../../../common/icons/StarIcon */ "./src/components/common/icons/StarIcon.tsx");
/* harmony import */ var _common_SafeLink__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../../../common/SafeLink */ "./src/components/common/SafeLink.tsx");
/* harmony import */ var _common_TableInfoModal__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../../common/TableInfoModal */ "./src/components/modals/common/TableInfoModal.tsx");
/* harmony import */ var _gift_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../../gift/UniqueGiftHeader */ "./src/components/modals/gift/UniqueGiftHeader.tsx");
/* harmony import */ var _PaidMediaThumb__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./PaidMediaThumb */ "./src/components/modals/stars/transaction/PaidMediaThumb.tsx");
/* harmony import */ var _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ./StarsTransactionModal.module.scss */ "./src/components/modals/stars/transaction/StarsTransactionModal.module.scss");
/* harmony import */ var _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../../../../assets/stars-bg.png */ "./src/assets/stars-bg.png");
/* harmony import */ var _teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! @teact/jsx-runtime */ "./src/lib/teact/jsx-runtime.ts");




























const StarsTransactionModal = ({
  modal,
  peer,
  canPlayAnimatedEmojis,
  topSticker,
  paidMessageCommission
}) => {
  const {
    showNotification,
    openMediaViewer,
    closeStarsTransactionModal
  } = (0,_global__WEBPACK_IMPORTED_MODULE_1__.getActions)();
  const lang = (0,_hooks_useLang__WEBPACK_IMPORTED_MODULE_13__["default"])();
  const oldLang = (0,_hooks_useOldLang__WEBPACK_IMPORTED_MODULE_15__["default"])();
  const {
    transaction
  } = modal || {};
  const handleOpenMedia = (0,_hooks_useLastCallback__WEBPACK_IMPORTED_MODULE_14__["default"])(() => {
    const media = transaction?.extendedMedia;
    if (!media) return;
    openMediaViewer({
      origin: _types__WEBPACK_IMPORTED_MODULE_2__.MediaViewerOrigin.StarsTransaction,
      standaloneMedia: media.flatMap(item => Object.values(item))
    });
  });
  const starModalData = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!transaction) {
      return undefined;
    }
    const {
      giveawayPostId,
      photo,
      stars,
      isGiftUpgrade,
      starGift,
      isGiftResale
    } = transaction;
    const gift = transaction?.starGift;
    const isUniqueGift = gift?.type === 'starGiftUnique';
    const sticker = transaction?.starGift ? (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_11__.getStickerFromGift)(transaction.starGift) : topSticker;
    const giftAttributes = isUniqueGift ? (0,_common_helpers_gifts__WEBPACK_IMPORTED_MODULE_11__.getGiftAttributes)(gift) : undefined;
    const customPeer = transaction.peer && transaction.peer.type !== 'peer' && (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.buildStarsTransactionCustomPeer)(transaction.peer) || undefined;
    const peerId = transaction.peer?.type === 'peer' ? transaction.peer.id : undefined;
    const toName = transaction.peer && oldLang(getStarsPeerTitleKey(transaction.peer));
    const title = (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_12__.getTransactionTitle)(oldLang, lang, transaction);
    const messageLink = peer && transaction.messageId && !isGiftUpgrade ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageLink)(peer, undefined, transaction.messageId) : undefined;
    const giveawayMessageLink = peer && giveawayPostId ? (0,_global_helpers__WEBPACK_IMPORTED_MODULE_3__.getMessageLink)(peer, undefined, giveawayPostId) : undefined;
    const media = transaction.extendedMedia;
    const mediaAmount = media?.length || 0;
    const areAllPhotos = media?.every(m => !m.video);
    const areAllVideos = media?.every(m => !m.photo);
    const mediaText = areAllPhotos ? oldLang('Stars.Transfer.Photos', mediaAmount) : areAllVideos ? oldLang('Stars.Transfer.Videos', mediaAmount) : oldLang('Media', mediaAmount);
    const description = transaction.description || (isGiftUpgrade && starGift?.type === 'starGiftUnique' ? starGift.title : undefined) || (media ? mediaText : undefined);
    const shouldDisplayAvatar = !media && !sticker;
    const avatarPeer = !photo ? peer || customPeer : undefined;
    const uniqueGiftHeader = isUniqueGift && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
      className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].header, _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].uniqueGift),
      children: (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_gift_UniqueGiftHeader__WEBPACK_IMPORTED_MODULE_23__["default"], {
        backdropAttribute: giftAttributes.backdrop,
        patternAttribute: giftAttributes.pattern,
        modelAttribute: giftAttributes.model,
        title: gift.title,
        subtitle: lang('GiftInfoCollectible', {
          number: gift.number
        }),
        resellPrice: transaction.stars
      })
    });
    const regularHeader = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("div", {
      className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].header,
      children: [media && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_PaidMediaThumb__WEBPACK_IMPORTED_MODULE_24__["default"], {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].mediaPreview, 'transaction-media-preview'),
        media: media,
        onClick: handleOpenMedia
      }), !media && sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_AnimatedIconFromSticker__WEBPACK_IMPORTED_MODULE_17__["default"], {
        sticker: sticker,
        play: canPlayAnimatedEmojis,
        noLoop: true
      }, transaction.id), shouldDisplayAvatar && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_Avatar__WEBPACK_IMPORTED_MODULE_18__["default"], {
        peer: avatarPeer,
        webPhoto: photo,
        size: "giant"
      }), !sticker && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("img", {
        className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].starsBackground),
        src: _assets_stars_bg_png__WEBPACK_IMPORTED_MODULE_26__,
        alt: "",
        draggable: false
      }), Boolean(title) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("h1", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].title,
        children: title
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].description,
        children: description
      }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].amount,
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("span", {
          className: (0,_util_buildClassName__WEBPACK_IMPORTED_MODULE_6__["default"])(_StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].amount, (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_12__.isNegativeStarsAmount)(stars) ? _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].negative : _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].positive),
          children: (0,_global_helpers_payments__WEBPACK_IMPORTED_MODULE_4__.formatStarsTransactionAmount)(lang, stars)
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_StarIcon__WEBPACK_IMPORTED_MODULE_20__["default"], {
          type: "gold",
          size: "middle"
        }), transaction.isRefund && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].refunded,
          children: lang('Refunded')
        })]
      }), Boolean(transaction.paidMessages && transaction.starRefCommision && paidMessageCommission) && (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("p", {
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].description,
        children: lang('PaidMessageTransactionDescription', {
          percent: (0,_util_textFormat__WEBPACK_IMPORTED_MODULE_10__.formatPercent)(paidMessageCommission / 10)
        }, {
          withNodes: true,
          withMarkdown: true
        })
      })]
    });
    const tableData = [];
    if (transaction && !transaction.paidMessages && !isGiftResale) {
      tableData.push([oldLang('StarsTransaction.StarRefReason.Title'), oldLang('StarsTransaction.StarRefReason.Program')]);
    }
    if (isGiftUpgrade) {
      tableData.push([oldLang('StarGiftReason'), oldLang('StarGiftReasonUpgrade')]);
    }
    if (isGiftResale) {
      tableData.push([oldLang('StarGiftReason'), (0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_12__.isNegativeStarsAmount)(transaction.stars) ? lang('StarGiftSaleTransaction') : lang('StarGiftPurchaseTransaction')]);
    }
    let peerLabel;
    if (isGiftUpgrade) {
      peerLabel = oldLang('Stars.Transaction.GiftFrom');
    } else if ((0,_helpers_transaction__WEBPACK_IMPORTED_MODULE_12__.isNegativeStarsAmount)(stars) || transaction.isMyGift) {
      peerLabel = oldLang('Stars.Transaction.To');
    } else if (transaction.starRefCommision && !transaction.paidMessages && !isGiftResale) {
      peerLabel = oldLang('StarsTransaction.StarRefReason.Miniapp');
    } else if (peerId) {
      peerLabel = oldLang('Star.Transaction.From');
    } else {
      peerLabel = oldLang('Stars.Transaction.Via');
    }
    tableData.push([peerLabel, peerId ? {
      chatId: peerId
    } : toName || '']);
    if (transaction.starRefCommision && transaction.paidMessages) {
      tableData.push([lang('PaidMessageTransactionTotal'), (0,_util_localization_format__WEBPACK_IMPORTED_MODULE_9__.formatStarsAsIcon)(lang, transaction.stars.amount / ((100 - transaction.starRefCommision) / 100), {
        asFont: false,
        className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].starIcon,
        containerClassName: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].totalStars
      })]);
    }
    if (messageLink) {
      tableData.push([oldLang('Stars.Transaction.Reaction.Post'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_21__["default"], {
        url: messageLink,
        text: messageLink
      })]);
    }
    if (giveawayMessageLink) {
      tableData.push([oldLang('BoostReason'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_21__["default"], {
        url: giveawayMessageLink,
        text: oldLang('Giveaway')
      })]);
      tableData.push([oldLang('Gift'), oldLang('Stars', transaction.stars, 'i')]);
    }
    if (transaction.id) {
      tableData.push([oldLang('Stars.Transaction.Id'), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)(_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.Fragment, {
        children: [(0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)("div", {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].tid,
          onClick: () => {
            (0,_util_clipboard__WEBPACK_IMPORTED_MODULE_7__.copyTextToClipboard)(transaction.id);
            showNotification({
              message: oldLang('StarsTransactionIDCopied')
            });
          },
          children: transaction.id
        }), (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_icons_Icon__WEBPACK_IMPORTED_MODULE_19__["default"], {
          className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].copyIcon,
          name: "copy"
        })]
      })]);
    }
    tableData.push([oldLang('Stars.Transaction.Date'), (0,_util_dates_dateFormat__WEBPACK_IMPORTED_MODULE_8__.formatDateTimeToString)(transaction.date * 1000, oldLang.code, true)]);
    const footerText = oldLang('lng_credits_box_out_about');
    const footerTextParts = footerText.split('{link}');
    const footer = (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsxs)("span", {
      className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].footer,
      children: [footerTextParts[0], (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_SafeLink__WEBPACK_IMPORTED_MODULE_21__["default"], {
        url: oldLang('StarsTOSLink'),
        text: oldLang('lng_credits_summary_options_about_link')
      }), footerTextParts[1]]
    });
    return {
      header: isUniqueGift ? uniqueGiftHeader : regularHeader,
      tableData,
      footer
    };
  }, [transaction, oldLang, lang, peer, canPlayAnimatedEmojis, topSticker, paidMessageCommission]);
  const prevModalData = (0,_hooks_usePrevious__WEBPACK_IMPORTED_MODULE_16__["default"])(starModalData);
  const renderingModalData = prevModalData || starModalData;
  return (0,_teact_jsx_runtime__WEBPACK_IMPORTED_MODULE_27__.jsx)(_common_TableInfoModal__WEBPACK_IMPORTED_MODULE_22__["default"], {
    isOpen: Boolean(transaction),
    className: _StarsTransactionModal_module_scss__WEBPACK_IMPORTED_MODULE_25__["default"].modal,
    hasBackdrop: transaction?.starGift?.type === 'starGiftUnique',
    header: renderingModalData?.header,
    tableData: renderingModalData?.tableData,
    footer: renderingModalData?.footer,
    buttonText: oldLang('OK'),
    onClose: closeStarsTransactionModal
  });
};
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.memo)((0,_global__WEBPACK_IMPORTED_MODULE_1__.withGlobal)((global, {
  modal
}) => {
  const peerId = modal?.transaction?.peer?.type === 'peer' && modal.transaction.peer.id;
  const peer = peerId ? (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectPeer)(global, peerId) : undefined;
  const paidMessageCommission = global.appConfig?.starsPaidMessageCommissionPermille;
  const starCount = modal?.transaction.stars;
  const starsGiftSticker = modal?.transaction.isGift && (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectGiftStickerForStars)(global, starCount?.amount);
  return {
    peer,
    canPlayAnimatedEmojis: (0,_global_selectors__WEBPACK_IMPORTED_MODULE_5__.selectCanPlayAnimatedEmojis)(global),
    topSticker: starsGiftSticker,
    paidMessageCommission
  };
})(StarsTransactionModal)));
function getStarsPeerTitleKey(peer) {
  switch (peer.type) {
    case 'appStore':
      return 'AppStore';
    case 'playMarket':
      return 'PlayMarket';
    case 'fragment':
      return 'Fragment';
    case 'premiumBot':
      return 'StarsTransactionBot';
    case 'ads':
      return 'StarsTransactionAds';
    case 'api':
      return 'Stars.Intro.Transaction.TelegramBotApi.Subtitle';
    default:
      return 'Stars.Transaction.Unsupported.Title';
  }
}

/***/ }),

/***/ "./src/hooks/animations/useTransitionActiveKey.ts":
/*!********************************************************!*\
  !*** ./src/hooks/animations/useTransitionActiveKey.ts ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   useTransitionActiveKey: () => (/* binding */ useTransitionActiveKey)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/teact/teact */ "./src/lib/teact/teact.ts");


/**
 * Use this hook to bind `<Transition />` animation to changes in the dependency array.
 * Use optional parameter `noAnimation` if you want to prevent the animation even if the dependency array changes.
*/
function useTransitionActiveKey(deps, noAnimation) {
  const activeKey = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(0);
  (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useMemo)(() => {
    if (!noAnimation) activeKey.current += 1;
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [...deps]);
  return activeKey.current;
}

/***/ }),

/***/ "./src/hooks/useDebouncedMemo.ts":
/*!***************************************!*\
  !*** ./src/hooks/useDebouncedMemo.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ useDebouncedMemo)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _useForceUpdate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./useForceUpdate */ "./src/hooks/useForceUpdate.ts");
/* harmony import */ var _useHeavyAnimation__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useHeavyAnimation */ "./src/hooks/useHeavyAnimation.ts");
/* harmony import */ var _useRunDebounced__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useRunDebounced */ "./src/hooks/useRunDebounced.ts");
/* harmony import */ var _useSyncEffect__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./useSyncEffect */ "./src/hooks/useSyncEffect.ts");





function useDebouncedMemo(resolverFn, ms, dependencies) {
  const [value, setValue] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)();
  const {
    isFrozen,
    updateWhenUnfrozen
  } = useHeavyAnimationFreeze();
  const runDebounced = (0,_useRunDebounced__WEBPACK_IMPORTED_MODULE_3__["default"])(ms, true);
  (0,_useSyncEffect__WEBPACK_IMPORTED_MODULE_4__["default"])(() => {
    if (isFrozen) {
      updateWhenUnfrozen();
      return;
    }
    runDebounced(() => {
      setValue(resolverFn());
    });
    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps
  }, [...dependencies, isFrozen]);
  return value;
}
function useHeavyAnimationFreeze() {
  const isPending = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useRef)(false);
  const updateWhenUnfrozen = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    isPending.current = true;
  }, []);
  const forceUpdate = (0,_useForceUpdate__WEBPACK_IMPORTED_MODULE_1__["default"])();
  const handleUnfreeze = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useCallback)(() => {
    if (!isPending.current) {
      return;
    }
    isPending.current = false;
    forceUpdate();
  }, [forceUpdate]);
  (0,_useHeavyAnimation__WEBPACK_IMPORTED_MODULE_2__["default"])(noop, handleUnfreeze);
  return {
    isFrozen: (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.getIsHeavyAnimating)(),
    updateWhenUnfrozen
  };
}
function noop() {}

/***/ }),

/***/ "./src/hooks/usePeerSearch.ts":
/*!************************************!*\
  !*** ./src/hooks/usePeerSearch.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ usePeerSearch),
/* harmony export */   peerGlobalSearch: () => (/* binding */ peerGlobalSearch),
/* harmony export */   prepareChatMemberSearch: () => (/* binding */ prepareChatMemberSearch)
/* harmony export */ });
/* harmony import */ var _lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../lib/teact/teact */ "./src/lib/teact/teact.ts");
/* harmony import */ var _api_gramjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../api/gramjs */ "./src/api/gramjs/index.ts");
/* harmony import */ var _useAsync__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./useAsync */ "./src/hooks/useAsync.ts");
/* harmony import */ var _useDebouncedMemo__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./useDebouncedMemo */ "./src/hooks/useDebouncedMemo.ts");
/* harmony import */ var _useLastCallback__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./useLastCallback */ "./src/hooks/useLastCallback.ts");





const DEBOUNCE_TIMEOUT = 300;
async function peerGlobalSearch(query) {
  const searchResult = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('searchChats', {
    query
  });
  if (!searchResult) return undefined;
  const ids = [...searchResult.accountResultIds, ...searchResult.globalResultIds];
  return ids;
}
function prepareChatMemberSearch(chat) {
  return async query => {
    const searchResult = await (0,_api_gramjs__WEBPACK_IMPORTED_MODULE_1__.callApi)('fetchMembers', {
      chat,
      memberFilter: 'search',
      query
    });
    return searchResult?.members?.map(member => member.userId) || [];
  };
}
function usePeerSearch({
  query,
  queryFn = peerGlobalSearch,
  defaultValue,
  debounceTimeout = DEBOUNCE_TIMEOUT,
  isDisabled
}) {
  const debouncedQuery = (0,_useDebouncedMemo__WEBPACK_IMPORTED_MODULE_3__["default"])(() => query, debounceTimeout, [query]);
  const [currentResultsQuery, setCurrentResultsQuery] = (0,_lib_teact_teact__WEBPACK_IMPORTED_MODULE_0__.useState)('');
  const searchQuery = !query ? query : debouncedQuery; // Ignore debounce if query is empty
  const queryCallback = (0,_useLastCallback__WEBPACK_IMPORTED_MODULE_4__["default"])(queryFn);
  const result = (0,_useAsync__WEBPACK_IMPORTED_MODULE_2__["default"])(async () => {
    if (!searchQuery || isDisabled) {
      setCurrentResultsQuery('');
      return Promise.resolve(defaultValue);
    }
    const answer = await queryCallback(searchQuery);
    setCurrentResultsQuery(searchQuery);
    return answer;
  }, [searchQuery, defaultValue, queryCallback, isDisabled], defaultValue);
  return {
    ...result,
    currentResultsQuery
  };
}

/***/ })

}]);
//# sourceMappingURL=BundleStars.be179a144f612fe06f07.js.map