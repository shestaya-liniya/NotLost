"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["vendors-node_modules_music-metadata_lib_matroska_MatroskaParser_js"],{

/***/ "./node_modules/music-metadata/lib/ebml/EbmlIterator.js":
/*!**************************************************************!*\
  !*** ./node_modules/music-metadata/lib/ebml/EbmlIterator.js ***!
  \**************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   EbmlContentError: () => (/* binding */ EbmlContentError),
/* harmony export */   EbmlIterator: () => (/* binding */ EbmlIterator),
/* harmony export */   ParseAction: () => (/* binding */ ParseAction),
/* harmony export */   getElementPath: () => (/* binding */ getElementPath)
/* harmony export */ });
/* harmony import */ var token_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! token-types */ "./node_modules/token-types/lib/index.js");
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var strtok3__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! strtok3 */ "./node_modules/strtok3/lib/core.js");
/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./types.js */ "./node_modules/music-metadata/lib/ebml/types.js");
/* harmony import */ var _ParseError_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../ParseError.js */ "./node_modules/music-metadata/lib/ParseError.js");






const debug = debug__WEBPACK_IMPORTED_MODULE_1__('music-metadata:parser:ebml');
class EbmlContentError extends (0,_ParseError_js__WEBPACK_IMPORTED_MODULE_3__.makeUnexpectedFileContentError)('EBML') {
}
const ParseAction = {
    ReadNext: 0, // Continue reading the next elements
    IgnoreElement: 2, // Ignore (do not read) this element
    SkipSiblings: 3, // Skip all remaining elements at the same level
    TerminateParsing: 4, // Terminate the parsing process
    SkipElement: 5 // Consider the element has read, assume position is at the next element
};
/**
 * Extensible Binary Meta Language (EBML) iterator
 * https://en.wikipedia.org/wiki/Extensible_Binary_Meta_Language
 * http://matroska.sourceforge.net/technical/specs/rfc/index.html
 *
 * WEBM VP8 AUDIO FILE
 */
class EbmlIterator {
    /**
     * @param {ITokenizer} tokenizer Input
     * @param tokenizer
     */
    constructor(tokenizer) {
        this.padding = 0;
        this.parserMap = new Map();
        this.ebmlMaxIDLength = 4;
        this.ebmlMaxSizeLength = 8;
        this.tokenizer = tokenizer;
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.uint, e => this.readUint(e));
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.string, e => this.readString(e));
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.binary, e => this.readBuffer(e));
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.uid, async (e) => this.readBuffer(e));
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.bool, e => this.readFlag(e));
        this.parserMap.set(_types_js__WEBPACK_IMPORTED_MODULE_4__.DataType.float, e => this.readFloat(e));
    }
    async iterate(dtdElement, posDone, listener) {
        return this.parseContainer(linkParents(dtdElement), posDone, listener);
    }
    async parseContainer(dtdElement, posDone, listener) {
        const tree = {};
        while (this.tokenizer.position < posDone) {
            let element;
            const elementPosition = this.tokenizer.position;
            try {
                element = await this.readElement();
            }
            catch (error) {
                if (error instanceof strtok3__WEBPACK_IMPORTED_MODULE_2__.EndOfStreamError) {
                    break;
                }
                throw error;
            }
            const child = dtdElement.container[element.id];
            if (child) {
                const action = listener.startNext(child);
                switch (action) {
                    case ParseAction.ReadNext:
                        {
                            if (element.id === 0x1F43B675) {
                                // Hack to ignore remaining segment, when cluster element received
                                // await this.tokenizer.ignore(posDone - this.tokenizer.position);
                                // break;
                            }
                            debug(`Read element: name=${getElementPath(child)}{id=0x${element.id.toString(16)}, container=${!!child.container}} at position=${elementPosition}`);
                            if (child.container) {
                                const res = await this.parseContainer(child, element.len >= 0 ? this.tokenizer.position + element.len : -1, listener);
                                if (child.multiple) {
                                    if (!tree[child.name]) {
                                        tree[child.name] = [];
                                    }
                                    tree[child.name].push(res);
                                }
                                else {
                                    tree[child.name] = res;
                                }
                                await listener.elementValue(child, res, elementPosition);
                            }
                            else {
                                const parser = this.parserMap.get(child.value);
                                if (typeof parser === 'function') {
                                    const value = await parser(element);
                                    tree[child.name] = value;
                                    await listener.elementValue(child, value, elementPosition);
                                }
                            }
                        }
                        break;
                    case ParseAction.SkipElement:
                        debug(`Go to next element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);
                        break;
                    case ParseAction.IgnoreElement:
                        debug(`Ignore element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);
                        await this.tokenizer.ignore(element.len);
                        break;
                    case ParseAction.SkipSiblings:
                        debug(`Ignore remaining container, at: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);
                        await this.tokenizer.ignore(posDone - this.tokenizer.position);
                        break;
                    case ParseAction.TerminateParsing:
                        debug(`Terminate parsing at element: name=${getElementPath(child)}, element.id=0x${element.id}, container=${!!child.container} at position=${elementPosition}`);
                        return tree;
                }
            }
            else {
                switch (element.id) {
                    case 0xec: // void
                        this.padding += element.len;
                        await this.tokenizer.ignore(element.len);
                        break;
                    default:
                        debug(`parseEbml: parent=${getElementPath(dtdElement)}, unknown child: id=${element.id.toString(16)} at position=${elementPosition}`);
                        this.padding += element.len;
                        await this.tokenizer.ignore(element.len);
                }
            }
        }
        return tree;
    }
    async readVintData(maxLength) {
        const msb = await this.tokenizer.peekNumber(token_types__WEBPACK_IMPORTED_MODULE_0__.UINT8);
        let mask = 0x80;
        let oc = 1;
        // Calculate VINT_WIDTH
        while ((msb & mask) === 0) {
            if (oc > maxLength) {
                throw new EbmlContentError('VINT value exceeding maximum size');
            }
            ++oc;
            mask >>= 1;
        }
        const id = new Uint8Array(oc);
        await this.tokenizer.readBuffer(id);
        return id;
    }
    async readElement() {
        const id = await this.readVintData(this.ebmlMaxIDLength);
        const lenField = await this.readVintData(this.ebmlMaxSizeLength);
        lenField[0] ^= 0x80 >> (lenField.length - 1);
        return {
            id: readUIntBE(id, id.length),
            len: readUIntBE(lenField, lenField.length)
        };
    }
    async readFloat(e) {
        switch (e.len) {
            case 0:
                return 0.0;
            case 4:
                return this.tokenizer.readNumber(token_types__WEBPACK_IMPORTED_MODULE_0__.Float32_BE);
            case 8:
                return this.tokenizer.readNumber(token_types__WEBPACK_IMPORTED_MODULE_0__.Float64_BE);
            case 10:
                return this.tokenizer.readNumber(token_types__WEBPACK_IMPORTED_MODULE_0__.Float64_BE);
            default:
                throw new EbmlContentError(`Invalid IEEE-754 float length: ${e.len}`);
        }
    }
    async readFlag(e) {
        return (await this.readUint(e)) === 1;
    }
    async readUint(e) {
        const buf = await this.readBuffer(e);
        return readUIntBE(buf, e.len);
    }
    async readString(e) {
        const rawString = await this.tokenizer.readToken(new token_types__WEBPACK_IMPORTED_MODULE_0__.StringType(e.len, 'utf-8'));
        return rawString.replace(/\x00.*$/g, '');
    }
    async readBuffer(e) {
        const buf = new Uint8Array(e.len);
        await this.tokenizer.readBuffer(buf);
        return buf;
    }
}
function readUIntBE(buf, len) {
    return Number(readUIntBeAsBigInt(buf, len));
}
/**
 * Reeds an unsigned integer from a big endian buffer of length `len`
 * @param buf Buffer to decode from
 * @param len Number of bytes
 * @private
 */
function readUIntBeAsBigInt(buf, len) {
    const normalizedNumber = new Uint8Array(8);
    const cleanNumber = buf.subarray(0, len);
    try {
        normalizedNumber.set(cleanNumber, 8 - len);
        return token_types__WEBPACK_IMPORTED_MODULE_0__.UINT64_BE.get(normalizedNumber, 0);
    }
    catch (error) {
        return BigInt(-1);
    }
}
function linkParents(element) {
    if (element.container) {
        Object.keys(element.container)
            .map(id => {
            const child = element.container[id];
            child.id = Number.parseInt(id);
            return child;
        }).forEach(child => {
            child.parent = element;
            linkParents(child);
        });
    }
    return element;
}
function getElementPath(element) {
    let path = '';
    if (element.parent && element.parent.name !== 'dtd') {
        path += `${getElementPath(element.parent)}/`;
    }
    return path + element.name;
}
//# sourceMappingURL=EbmlIterator.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/ebml/types.js":
/*!*******************************************************!*\
  !*** ./node_modules/music-metadata/lib/ebml/types.js ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   DataType: () => (/* binding */ DataType)
/* harmony export */ });
const DataType = {
    string: 0,
    uint: 1,
    uid: 2,
    bool: 3,
    binary: 4,
    float: 5,
};
//# sourceMappingURL=types.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/matroska/MatroskaDtd.js":
/*!*****************************************************************!*\
  !*** ./node_modules/music-metadata/lib/matroska/MatroskaDtd.js ***!
  \*****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   matroskaDtd: () => (/* binding */ matroskaDtd)
/* harmony export */ });
/* harmony import */ var _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ebml/types.js */ "./node_modules/music-metadata/lib/ebml/types.js");

/**
 * Elements of document type description
 * Derived from https://github.com/tungol/EBML/blob/master/doctypes/matroska.dtd
 * Extended with:
 * - https://www.matroska.org/technical/specs/index.html
 */
const matroskaDtd = {
    name: 'dtd',
    container: {
        0x1a45dfa3: {
            name: 'ebml',
            container: {
                0x4286: { name: 'ebmlVersion', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // 5.1.1
                0x42f7: { name: 'ebmlReadVersion', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // 5.1.2
                0x42f2: { name: 'ebmlMaxIDWidth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // 5.1.3
                0x42f3: { name: 'ebmlMaxSizeWidth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // 5.1.4
                0x4282: { name: 'docType', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }, // 5.1.5
                0x4287: { name: 'docTypeVersion', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // 5.1.6
                0x4285: { name: 'docTypeReadVersion', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint } // 5.1.7
            }
        },
        // Matroska segments
        0x18538067: {
            name: 'segment',
            container: {
                // Meta Seek Information (also known as MetaSeek)
                0x114d9b74: {
                    name: 'seekHead',
                    container: {
                        0x4dbb: {
                            name: 'seek',
                            multiple: true,
                            container: {
                                0x53ab: { name: 'id', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                0x53ac: { name: 'position', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }
                            }
                        }
                    }
                },
                // Segment Information
                0x1549a966: {
                    name: 'info',
                    container: {
                        0x73a4: { name: 'uid', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0x7384: { name: 'filename', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                        0x3cb923: { name: 'prevUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0x3c83ab: { name: 'prevFilename', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                        0x3eb923: { name: 'nextUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0x3e83bb: { name: 'nextFilename', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                        0x2ad7b1: { name: 'timecodeScale', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                        0x4489: { name: 'duration', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.float },
                        0x4461: { name: 'dateUTC', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                        0x7ba9: { name: 'title', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                        0x4d80: { name: 'muxingApp', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                        0x5741: { name: 'writingApp', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }
                    }
                },
                // Cluster
                0x1f43b675: {
                    name: 'cluster',
                    multiple: true,
                    container: {
                        0xe7: { name: 'timecode', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0x58d7: { name: 'silentTracks ', multiple: true },
                        0xa7: { name: 'position', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0xab: { name: 'prevSize', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                        0xa0: { name: 'blockGroup' },
                        0xa3: { name: 'simpleBlock' }
                    }
                },
                // Track
                0x1654ae6b: {
                    name: 'tracks',
                    container: {
                        0xae: {
                            name: 'entries',
                            multiple: true,
                            container: {
                                0xd7: { name: 'trackNumber', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                0x73c5: { name: 'uid', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                0x83: { name: 'trackType', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                0xb9: { name: 'flagEnabled', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                0x88: { name: 'flagDefault', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                0x55aa: { name: 'flagForced', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool }, // extended
                                0x9c: { name: 'flagLacing', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                0x6de7: { name: 'minCache', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                0x6de8: { name: 'maxCache', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                0x23e383: { name: 'defaultDuration', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                0x23314f: { name: 'timecodeScale', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.float },
                                0x536e: { name: 'name', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x22b59c: { name: 'language', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x86: { name: 'codecID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x63a2: { name: 'codecPrivate', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                0x258688: { name: 'codecName', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x3a9697: { name: 'codecSettings', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x3b4040: { name: 'codecInfoUrl', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x26b240: { name: 'codecDownloadUrl', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0xaa: { name: 'codecDecodeAll', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                0x6fab: { name: 'trackOverlay', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                // Video
                                0xe0: {
                                    name: 'video',
                                    container: {
                                        0x9a: { name: 'flagInterlaced', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                        0x53b8: { name: 'stereoMode', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0xb0: { name: 'pixelWidth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0xba: { name: 'pixelHeight', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x54b0: { name: 'displayWidth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x54ba: { name: 'displayHeight', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x54b3: { name: 'aspectRatioType', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x2eb524: { name: 'colourSpace', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x2fb523: { name: 'gammaValue', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.float }
                                    }
                                },
                                // Audio
                                0xe1: {
                                    name: 'audio',
                                    container: {
                                        0xb5: { name: 'samplingFrequency', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.float },
                                        0x78b5: { name: 'outputSamplingFrequency', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.float },
                                        0x9f: { name: 'channels', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // https://www.matroska.org/technical/specs/index.html
                                        0x94: { name: 'channels', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x7d7b: { name: 'channelPositions', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                        0x6264: { name: 'bitDepth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }
                                    }
                                },
                                // Content Encoding
                                0x6d80: {
                                    name: 'contentEncodings',
                                    container: {
                                        0x6240: {
                                            name: 'contentEncoding',
                                            container: {
                                                0x5031: { name: 'order', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                0x5032: { name: 'scope', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                                0x5033: { name: 'type', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                0x5034: {
                                                    name: 'contentEncoding',
                                                    container: {
                                                        0x4254: { name: 'contentCompAlgo', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                        0x4255: { name: 'contentCompSettings', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary }
                                                    }
                                                },
                                                0x5035: {
                                                    name: 'contentEncoding',
                                                    container: {
                                                        0x47e1: { name: 'contentEncAlgo', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                        0x47e2: { name: 'contentEncKeyID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                                        0x47e3: { name: 'contentSignature ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                                        0x47e4: { name: 'ContentSigKeyID  ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                                        0x47e5: { name: 'contentSigAlgo ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                        0x47e6: { name: 'contentSigHashAlgo ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }
                                                    }
                                                },
                                                0x6264: { name: 'bitDepth', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                // Cueing Data
                0x1c53bb6b: {
                    name: 'cues',
                    container: {
                        0xbb: {
                            name: 'cuePoint',
                            container: {
                                0xb3: { name: 'cueTime', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                0xb7: {
                                    name: 'positions',
                                    container: {
                                        0xf7: { name: 'track', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0xf1: { name: 'clusterPosition', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x5378: { name: 'blockNumber', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0xea: { name: 'codecState', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0xdb: {
                                            name: 'reference', container: {
                                                0x96: { name: 'time', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                0x97: { name: 'cluster', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                0x535f: { name: 'number', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                                0xeb: { name: 'codecState', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }
                                            }
                                        },
                                        0xf0: { name: 'relativePosition', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint } // extended
                                    }
                                }
                            }
                        }
                    }
                },
                // Attachment
                0x1941a469: {
                    name: 'attachments',
                    container: {
                        0x61a7: {
                            name: 'attachedFiles',
                            multiple: true,
                            container: {
                                0x467e: { name: 'description', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x466e: { name: 'name', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x4660: { name: 'mimeType', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                0x465c: { name: 'data', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                0x46ae: { name: 'uid', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid }
                            }
                        }
                    }
                },
                // Chapters
                0x1043a770: {
                    name: 'chapters',
                    container: {
                        0x45b9: {
                            name: 'editionEntry',
                            container: {
                                0xb6: {
                                    name: 'chapterAtom',
                                    container: {
                                        0x73c4: { name: 'uid', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                        0x91: { name: 'timeStart', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x92: { name: 'timeEnd', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                        0x98: { name: 'hidden', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool },
                                        0x4598: { name: 'enabled', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                        0x8f: {
                                            name: 'track', container: {
                                                0x89: { name: 'trackNumber', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                                0x80: {
                                                    name: 'display', container: {
                                                        0x85: { name: 'string', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                                        0x437c: { name: 'language ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                                        0x437e: { name: 'country ', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                // Tagging
                0x1254c367: {
                    name: 'tags',
                    container: {
                        0x7373: {
                            name: 'tag',
                            multiple: true,
                            container: {
                                0x63c0: {
                                    name: 'target',
                                    container: {
                                        0x63c5: { name: 'tagTrackUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                        0x63c4: { name: 'tagChapterUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint },
                                        0x63c6: { name: 'tagAttachmentUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid },
                                        0x63ca: { name: 'targetType', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }, // extended
                                        0x68ca: { name: 'targetTypeValue', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uint }, // extended
                                        0x63c9: { name: 'tagEditionUID', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.uid } // extended
                                    }
                                },
                                0x67c8: {
                                    name: 'simpleTags',
                                    multiple: true,
                                    container: {
                                        0x45a3: { name: 'name', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                        0x4487: { name: 'string', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string },
                                        0x4485: { name: 'binary', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.binary },
                                        0x447a: { name: 'language', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }, // extended
                                        0x447b: { name: 'languageIETF', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.string }, // extended
                                        0x4484: { name: 'default', value: _ebml_types_js__WEBPACK_IMPORTED_MODULE_0__.DataType.bool } // extended
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
};
//# sourceMappingURL=MatroskaDtd.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/matroska/MatroskaParser.js":
/*!********************************************************************!*\
  !*** ./node_modules/music-metadata/lib/matroska/MatroskaParser.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MatroskaParser: () => (/* binding */ MatroskaParser)
/* harmony export */ });
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../common/BasicParser.js */ "./node_modules/music-metadata/lib/common/BasicParser.js");
/* harmony import */ var _MatroskaDtd_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./MatroskaDtd.js */ "./node_modules/music-metadata/lib/matroska/MatroskaDtd.js");
/* harmony import */ var _types_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./types.js */ "./node_modules/music-metadata/lib/matroska/types.js");
/* harmony import */ var _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../ebml/EbmlIterator.js */ "./node_modules/music-metadata/lib/ebml/EbmlIterator.js");





const debug = debug__WEBPACK_IMPORTED_MODULE_0__('music-metadata:parser:matroska');
/**
 * Extensible Binary Meta Language (EBML) parser
 * https://en.wikipedia.org/wiki/Extensible_Binary_Meta_Language
 * http://matroska.sourceforge.net/technical/specs/rfc/index.html
 *
 * WEBM VP8 AUDIO FILE
 */
class MatroskaParser extends _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__.BasicParser {
    constructor() {
        super(...arguments);
        this.seekHeadOffset = 0;
        /**
         * Use index to skip multiple segment/cluster elements at once.
         * Significant performance impact
         */
        this.flagUseIndexToSkipClusters = this.options.mkvUseIndex ?? false;
    }
    async parse() {
        const containerSize = this.tokenizer.fileInfo.size ?? Number.MAX_SAFE_INTEGER;
        const matroskaIterator = new _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__.EbmlIterator(this.tokenizer);
        debug('Initializing DTD end MatroskaIterator');
        await matroskaIterator.iterate(_MatroskaDtd_js__WEBPACK_IMPORTED_MODULE_3__.matroskaDtd, containerSize, {
            startNext: (element) => {
                switch (element.id) {
                    // case 0x1f43b675: // cluster
                    case 0x1c53bb6b: // Cueing Data
                        debug(`Skip element: name=${element.name}, id=0x${element.id.toString(16)}`);
                        return _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__.ParseAction.IgnoreElement;
                    case 0x1f43b675: // cluster
                        if (this.flagUseIndexToSkipClusters && this.seekHead) {
                            const index = this.seekHead.seek.find(index => index.position + this.seekHeadOffset > this.tokenizer.position);
                            if (index) {
                                // Go to next index position
                                const ignoreSize = index.position + this.seekHeadOffset - this.tokenizer.position;
                                debug(`Use index to go to next position, ignoring ${ignoreSize} bytes`);
                                this.tokenizer.ignore(ignoreSize);
                                return _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__.ParseAction.SkipElement;
                            }
                        }
                        return _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__.ParseAction.IgnoreElement;
                    default:
                        return _ebml_EbmlIterator_js__WEBPACK_IMPORTED_MODULE_2__.ParseAction.ReadNext;
                }
            },
            elementValue: async (element, value, offset) => {
                debug(`Received: name=${element.name}, value=${value}`);
                switch (element.id) {
                    case 0x4282: // docType
                        this.metadata.setFormat('container', `EBML/${value}`);
                        break;
                    case 0x114d9b74:
                        this.seekHead = value;
                        this.seekHeadOffset = offset;
                        break;
                    case 0x1549a966:
                        { // Info (Segment Information)
                            const info = value;
                            const timecodeScale = info.timecodeScale ? info.timecodeScale : 1000000;
                            if (typeof info.duration === 'number') {
                                const duration = info.duration * timecodeScale / 1000000000;
                                await this.addTag('segment:title', info.title);
                                this.metadata.setFormat('duration', Number(duration));
                            }
                        }
                        break;
                    case 0x1654ae6b:
                        { // tracks
                            const audioTracks = value;
                            if (audioTracks?.entries) {
                                audioTracks.entries.forEach(entry => {
                                    const stream = {
                                        codecName: entry.codecID.replace('A_', '').replace('V_', ''),
                                        codecSettings: entry.codecSettings,
                                        flagDefault: entry.flagDefault,
                                        flagLacing: entry.flagLacing,
                                        flagEnabled: entry.flagEnabled,
                                        language: entry.language,
                                        name: entry.name,
                                        type: entry.trackType,
                                        audio: entry.audio,
                                        video: entry.video
                                    };
                                    this.metadata.addStreamInfo(stream);
                                });
                                const audioTrack = audioTracks.entries
                                    .filter(entry => entry.trackType === _types_js__WEBPACK_IMPORTED_MODULE_4__.TrackType.audio)
                                    .reduce((acc, cur) => {
                                    if (!acc)
                                        return cur;
                                    if (cur.flagDefault && !acc.flagDefault)
                                        return cur;
                                    if (cur.trackNumber < acc.trackNumber)
                                        return cur;
                                    return acc;
                                }, null);
                                if (audioTrack) {
                                    this.metadata.setFormat('codec', audioTrack.codecID.replace('A_', ''));
                                    this.metadata.setFormat('sampleRate', audioTrack.audio.samplingFrequency);
                                    this.metadata.setFormat('numberOfChannels', audioTrack.audio.channels);
                                }
                            }
                        }
                        break;
                    case 0x1254c367:
                        { // tags
                            const tags = value;
                            await Promise.all(tags.tag.map(async (tag) => {
                                const target = tag.target;
                                const targetType = target?.targetTypeValue ? _types_js__WEBPACK_IMPORTED_MODULE_4__.TargetType[target.targetTypeValue] : (target?.targetType ? target.targetType : 'track');
                                await Promise.all(tag.simpleTags.map(async (simpleTag) => {
                                    const value = simpleTag.string ? simpleTag.string : simpleTag.binary;
                                    await this.addTag(`${targetType}:${simpleTag.name}`, value);
                                }));
                            }));
                        }
                        break;
                    case 0x1941a469:
                        { // attachments
                            const attachments = value;
                            await Promise.all(attachments.attachedFiles
                                .filter(file => file.mimeType.startsWith('image/'))
                                .map(file => this.addTag('picture', {
                                data: file.data,
                                format: file.mimeType,
                                description: file.description,
                                name: file.name
                            })));
                        }
                        break;
                }
            }
        });
    }
    async addTag(tagId, value) {
        await this.metadata.addTag('matroska', tagId, value);
    }
}
//# sourceMappingURL=MatroskaParser.js.map

/***/ })

}]);
//# sourceMappingURL=vendors-node_modules_music-metadata_lib_matroska_MatroskaParser_js.3f4339a76b0b676676b1.js.map