"use strict";
(self["webpackChunktelegram_t"] = self["webpackChunktelegram_t"] || []).push([["vendors-node_modules_music-metadata_lib_musepack_MusepackParser_js"],{

/***/ "./node_modules/music-metadata/lib/id3v2/AbstractID3Parser.js":
/*!********************************************************************!*\
  !*** ./node_modules/music-metadata/lib/id3v2/AbstractID3Parser.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   AbstractID3Parser: () => (/* binding */ AbstractID3Parser)
/* harmony export */ });
/* harmony import */ var strtok3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! strtok3 */ "./node_modules/strtok3/lib/core.js");
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var _ID3v2Token_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ID3v2Token.js */ "./node_modules/music-metadata/lib/id3v2/ID3v2Token.js");
/* harmony import */ var _ID3v2Parser_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ID3v2Parser.js */ "./node_modules/music-metadata/lib/id3v2/ID3v2Parser.js");
/* harmony import */ var _id3v1_ID3v1Parser_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../id3v1/ID3v1Parser.js */ "./node_modules/music-metadata/lib/id3v1/ID3v1Parser.js");
/* harmony import */ var _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../common/BasicParser.js */ "./node_modules/music-metadata/lib/common/BasicParser.js");






const debug = debug__WEBPACK_IMPORTED_MODULE_1__('music-metadata:parser:ID3');
/**
 * Abstract parser which tries take ID3v2 and ID3v1 headers.
 */
class AbstractID3Parser extends _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_2__.BasicParser {
    constructor() {
        super(...arguments);
        this.id3parser = new _ID3v2Parser_js__WEBPACK_IMPORTED_MODULE_3__.ID3v2Parser();
    }
    static async startsWithID3v2Header(tokenizer) {
        return (await tokenizer.peekToken(_ID3v2Token_js__WEBPACK_IMPORTED_MODULE_4__.ID3v2Header)).fileIdentifier === 'ID3';
    }
    async parse() {
        try {
            await this.parseID3v2();
        }
        catch (err) {
            if (err instanceof strtok3__WEBPACK_IMPORTED_MODULE_0__.EndOfStreamError) {
                debug("End-of-stream");
            }
            else {
                throw err;
            }
        }
    }
    finalize() {
        return;
    }
    async parseID3v2() {
        await this.tryReadId3v2Headers();
        debug('End of ID3v2 header, go to MPEG-parser: pos=%s', this.tokenizer.position);
        await this.postId3v2Parse();
        if (this.options.skipPostHeaders && this.metadata.hasAny()) {
            this.finalize();
        }
        else {
            const id3v1parser = new _id3v1_ID3v1Parser_js__WEBPACK_IMPORTED_MODULE_5__.ID3v1Parser(this.metadata, this.tokenizer, this.options);
            await id3v1parser.parse();
            this.finalize();
        }
    }
    async tryReadId3v2Headers() {
        const id3Header = await this.tokenizer.peekToken(_ID3v2Token_js__WEBPACK_IMPORTED_MODULE_4__.ID3v2Header);
        if (id3Header.fileIdentifier === 'ID3') {
            debug('Found ID3v2 header, pos=%s', this.tokenizer.position);
            await this.id3parser.parse(this.metadata, this.tokenizer, this.options);
            return this.tryReadId3v2Headers();
        }
    }
}
//# sourceMappingURL=AbstractID3Parser.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/MusepackConentError.js":
/*!*************************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/MusepackConentError.js ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MusepackContentError: () => (/* binding */ MusepackContentError)
/* harmony export */ });
/* harmony import */ var _ParseError_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../ParseError.js */ "./node_modules/music-metadata/lib/ParseError.js");

class MusepackContentError extends (0,_ParseError_js__WEBPACK_IMPORTED_MODULE_0__.makeUnexpectedFileContentError)('Musepack') {
}
//# sourceMappingURL=MusepackConentError.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/MusepackParser.js":
/*!********************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/MusepackParser.js ***!
  \********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MusepackParser: () => (/* binding */ MusepackParser)
/* harmony export */ });
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var token_types__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! token-types */ "./node_modules/token-types/lib/index.js");
/* harmony import */ var _id3v2_AbstractID3Parser_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../id3v2/AbstractID3Parser.js */ "./node_modules/music-metadata/lib/id3v2/AbstractID3Parser.js");
/* harmony import */ var _sv8_MpcSv8Parser_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./sv8/MpcSv8Parser.js */ "./node_modules/music-metadata/lib/musepack/sv8/MpcSv8Parser.js");
/* harmony import */ var _sv7_MpcSv7Parser_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sv7/MpcSv7Parser.js */ "./node_modules/music-metadata/lib/musepack/sv7/MpcSv7Parser.js");
/* harmony import */ var _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./MusepackConentError.js */ "./node_modules/music-metadata/lib/musepack/MusepackConentError.js");






const debug = debug__WEBPACK_IMPORTED_MODULE_0__('music-metadata:parser:musepack');
class MusepackParser extends _id3v2_AbstractID3Parser_js__WEBPACK_IMPORTED_MODULE_2__.AbstractID3Parser {
    async postId3v2Parse() {
        const signature = await this.tokenizer.peekToken(new token_types__WEBPACK_IMPORTED_MODULE_1__.StringType(3, 'latin1'));
        let mpcParser;
        switch (signature) {
            case 'MP+': {
                debug('Stream-version 7');
                mpcParser = new _sv7_MpcSv7Parser_js__WEBPACK_IMPORTED_MODULE_3__.MpcSv7Parser(this.metadata, this.tokenizer, this.options);
                break;
            }
            case 'MPC': {
                debug('Stream-version 8');
                mpcParser = new _sv8_MpcSv8Parser_js__WEBPACK_IMPORTED_MODULE_4__.MpcSv8Parser(this.metadata, this.tokenizer, this.options);
                break;
            }
            default: {
                throw new _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_5__.MusepackContentError('Invalid signature prefix');
            }
        }
        return mpcParser.parse();
    }
}
//# sourceMappingURL=MusepackParser.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/sv7/BitReader.js":
/*!*******************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/sv7/BitReader.js ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   BitReader: () => (/* binding */ BitReader)
/* harmony export */ });
/* harmony import */ var token_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! token-types */ "./node_modules/token-types/lib/index.js");

class BitReader {
    constructor(tokenizer) {
        this.pos = 0;
        this.dword = null;
        this.tokenizer = tokenizer;
    }
    /**
     *
     * @param bits 1..30 bits
     */
    async read(bits) {
        while (this.dword === null) {
            this.dword = await this.tokenizer.readToken(token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE);
        }
        let out = this.dword;
        this.pos += bits;
        if (this.pos < 32) {
            out >>>= (32 - this.pos);
            return out & ((1 << bits) - 1);
        }
        this.pos -= 32;
        if (this.pos === 0) {
            this.dword = null;
            return out & ((1 << bits) - 1);
        }
        this.dword = await this.tokenizer.readToken(token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE);
        if (this.pos) {
            out <<= this.pos;
            out |= this.dword >>> (32 - this.pos);
        }
        return out & ((1 << bits) - 1);
    }
    async ignore(bits) {
        if (this.pos > 0) {
            const remaining = 32 - this.pos;
            this.dword = null;
            bits -= remaining;
            this.pos = 0;
        }
        const remainder = bits % 32;
        const numOfWords = (bits - remainder) / 32;
        await this.tokenizer.ignore(numOfWords * 4);
        return this.read(remainder);
    }
}
//# sourceMappingURL=BitReader.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/sv7/MpcSv7Parser.js":
/*!**********************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/sv7/MpcSv7Parser.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MpcSv7Parser: () => (/* binding */ MpcSv7Parser)
/* harmony export */ });
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/BasicParser.js */ "./node_modules/music-metadata/lib/common/BasicParser.js");
/* harmony import */ var _apev2_APEv2Parser_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../apev2/APEv2Parser.js */ "./node_modules/music-metadata/lib/apev2/APEv2Parser.js");
/* harmony import */ var _BitReader_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./BitReader.js */ "./node_modules/music-metadata/lib/musepack/sv7/BitReader.js");
/* harmony import */ var _StreamVersion7_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./StreamVersion7.js */ "./node_modules/music-metadata/lib/musepack/sv7/StreamVersion7.js");
/* harmony import */ var _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../MusepackConentError.js */ "./node_modules/music-metadata/lib/musepack/MusepackConentError.js");






const debug = debug__WEBPACK_IMPORTED_MODULE_0__('music-metadata:parser:musepack');
class MpcSv7Parser extends _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__.BasicParser {
    constructor() {
        super(...arguments);
        this.bitreader = null;
        this.audioLength = 0;
        this.duration = null;
    }
    async parse() {
        const header = await this.tokenizer.readToken(_StreamVersion7_js__WEBPACK_IMPORTED_MODULE_2__.Header);
        if (header.signature !== 'MP+')
            throw new _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_3__.MusepackContentError('Unexpected magic number');
        debug(`stream-version=${header.streamMajorVersion}.${header.streamMinorVersion}`);
        this.metadata.setFormat('container', 'Musepack, SV7');
        this.metadata.setFormat('sampleRate', header.sampleFrequency);
        const numberOfSamples = 1152 * (header.frameCount - 1) + header.lastFrameLength;
        this.metadata.setFormat('numberOfSamples', numberOfSamples);
        this.duration = numberOfSamples / header.sampleFrequency;
        this.metadata.setFormat('duration', this.duration);
        this.bitreader = new _BitReader_js__WEBPACK_IMPORTED_MODULE_4__.BitReader(this.tokenizer);
        this.metadata.setFormat('numberOfChannels', header.midSideStereo || header.intensityStereo ? 2 : 1);
        const version = await this.bitreader.read(8);
        this.metadata.setFormat('codec', (version / 100).toFixed(2));
        await this.skipAudioData(header.frameCount);
        debug(`End of audio stream, switching to APEv2, offset=${this.tokenizer.position}`);
        return _apev2_APEv2Parser_js__WEBPACK_IMPORTED_MODULE_5__.APEv2Parser.tryParseApeHeader(this.metadata, this.tokenizer, this.options);
    }
    async skipAudioData(frameCount) {
        while (frameCount-- > 0) {
            const frameLength = await this.bitreader.read(20);
            this.audioLength += 20 + frameLength;
            await this.bitreader.ignore(frameLength);
        }
        // last frame
        const lastFrameLength = await this.bitreader.read(11);
        this.audioLength += lastFrameLength;
        if (this.duration !== null) {
            this.metadata.setFormat('bitrate', this.audioLength / this.duration);
        }
    }
}
//# sourceMappingURL=MpcSv7Parser.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/sv7/StreamVersion7.js":
/*!************************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/sv7/StreamVersion7.js ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Header: () => (/* binding */ Header)
/* harmony export */ });
/* harmony import */ var token_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! token-types */ "./node_modules/token-types/lib/index.js");
/* harmony import */ var _common_Util_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/Util.js */ "./node_modules/music-metadata/lib/common/Util.js");


/**
 * BASIC STRUCTURE
 */
const Header = {
    len: 6 * 4,
    get: (buf, off) => {
        const header = {
            // word 0
            signature: new TextDecoder('latin1').decode(buf.subarray(off, off + 3)),
            // versionIndex number * 1000 (3.81 = 3810) (remember that 4-byte alignment causes this to take 4-bytes)
            streamMinorVersion: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 3, 0, 4),
            streamMajorVersion: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 3, 4, 4),
            // word 1
            frameCount: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE.get(buf, off + 4),
            // word 2
            maxLevel: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT16_LE.get(buf, off + 8),
            sampleFrequency: [44100, 48000, 37800, 32000][_common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 10, 0, 2)],
            link: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 10, 2, 2),
            profile: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 10, 4, 4),
            maxBand: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.getBitAllignedNumber(buf, off + 11, 0, 6),
            intensityStereo: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.isBitSet(buf, off + 11, 6),
            midSideStereo: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.isBitSet(buf, off + 11, 7),
            // word 3
            titlePeak: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT16_LE.get(buf, off + 12),
            titleGain: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT16_LE.get(buf, off + 14),
            // word 4
            albumPeak: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT16_LE.get(buf, off + 16),
            albumGain: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT16_LE.get(buf, off + 18),
            // word
            lastFrameLength: (token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE.get(buf, off + 20) >>> 20) & 0x7FF,
            trueGapless: _common_Util_js__WEBPACK_IMPORTED_MODULE_1__.isBitSet(buf, off + 23, 0)
        };
        header.lastFrameLength = header.trueGapless ? (token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE.get(buf, 20) >>> 20) & 0x7FF : 0;
        return header;
    }
};
//# sourceMappingURL=StreamVersion7.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/sv8/MpcSv8Parser.js":
/*!**********************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/sv8/MpcSv8Parser.js ***!
  \**********************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   MpcSv8Parser: () => (/* binding */ MpcSv8Parser)
/* harmony export */ });
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../common/BasicParser.js */ "./node_modules/music-metadata/lib/common/BasicParser.js");
/* harmony import */ var _apev2_APEv2Parser_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../apev2/APEv2Parser.js */ "./node_modules/music-metadata/lib/apev2/APEv2Parser.js");
/* harmony import */ var _common_FourCC_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/FourCC.js */ "./node_modules/music-metadata/lib/common/FourCC.js");
/* harmony import */ var _StreamVersion8_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./StreamVersion8.js */ "./node_modules/music-metadata/lib/musepack/sv8/StreamVersion8.js");
/* harmony import */ var _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../MusepackConentError.js */ "./node_modules/music-metadata/lib/musepack/MusepackConentError.js");






const debug = debug__WEBPACK_IMPORTED_MODULE_0__('music-metadata:parser:musepack');
class MpcSv8Parser extends _common_BasicParser_js__WEBPACK_IMPORTED_MODULE_1__.BasicParser {
    constructor() {
        super(...arguments);
        this.audioLength = 0;
    }
    async parse() {
        const signature = await this.tokenizer.readToken(_common_FourCC_js__WEBPACK_IMPORTED_MODULE_2__.FourCcToken);
        if (signature !== 'MPCK')
            throw new _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_3__.MusepackContentError('Invalid Magic number');
        this.metadata.setFormat('container', 'Musepack, SV8');
        return this.parsePacket();
    }
    async parsePacket() {
        const sv8reader = new _StreamVersion8_js__WEBPACK_IMPORTED_MODULE_4__.StreamReader(this.tokenizer);
        do {
            const header = await sv8reader.readPacketHeader();
            debug(`packet-header key=${header.key}, payloadLength=${header.payloadLength}`);
            switch (header.key) {
                case 'SH': { // Stream Header
                    const sh = await sv8reader.readStreamHeader(header.payloadLength);
                    this.metadata.setFormat('numberOfSamples', sh.sampleCount);
                    this.metadata.setFormat('sampleRate', sh.sampleFrequency);
                    this.metadata.setFormat('duration', sh.sampleCount / sh.sampleFrequency);
                    this.metadata.setFormat('numberOfChannels', sh.channelCount);
                    break;
                }
                case 'AP': // Audio Packet
                    this.audioLength += header.payloadLength;
                    await this.tokenizer.ignore(header.payloadLength);
                    break;
                case 'RG': // Replaygain
                case 'EI': // Encoder Info
                case 'SO': // Seek Table Offset
                case 'ST': // Seek Table
                case 'CT': // Chapter-Tag
                    await this.tokenizer.ignore(header.payloadLength);
                    break;
                case 'SE': // Stream End
                    if (this.metadata.format.duration) {
                        this.metadata.setFormat('bitrate', this.audioLength * 8 / this.metadata.format.duration);
                    }
                    return _apev2_APEv2Parser_js__WEBPACK_IMPORTED_MODULE_5__.APEv2Parser.tryParseApeHeader(this.metadata, this.tokenizer, this.options);
                default:
                    throw new _MusepackConentError_js__WEBPACK_IMPORTED_MODULE_3__.MusepackContentError(`Unexpected header: ${header.key}`);
            }
            // biome-ignore lint/correctness/noConstantCondition: break is handled in the switch statement
        } while (true);
    }
}
//# sourceMappingURL=MpcSv8Parser.js.map

/***/ }),

/***/ "./node_modules/music-metadata/lib/musepack/sv8/StreamVersion8.js":
/*!************************************************************************!*\
  !*** ./node_modules/music-metadata/lib/musepack/sv8/StreamVersion8.js ***!
  \************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   StreamReader: () => (/* binding */ StreamReader)
/* harmony export */ });
/* harmony import */ var token_types__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! token-types */ "./node_modules/token-types/lib/index.js");
/* harmony import */ var debug__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! debug */ "./node_modules/debug/src/browser.js");
/* harmony import */ var _common_Util_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../common/Util.js */ "./node_modules/music-metadata/lib/common/Util.js");



const debug = debug__WEBPACK_IMPORTED_MODULE_1__('music-metadata:parser:musepack:sv8');
const PacketKey = new token_types__WEBPACK_IMPORTED_MODULE_0__.StringType(2, 'latin1');
/**
 * Stream Header Packet part 1
 * Ref: http://trac.musepack.net/musepack/wiki/SV8Specification#StreamHeaderPacket
 */
const SH_part1 = {
    len: 5,
    get: (buf, off) => {
        return {
            crc: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT32_LE.get(buf, off),
            streamVersion: token_types__WEBPACK_IMPORTED_MODULE_0__.UINT8.get(buf, off + 4)
        };
    }
};
/**
 * Stream Header Packet part 3
 * Ref: http://trac.musepack.net/musepack/wiki/SV8Specification#StreamHeaderPacket
 */
const SH_part3 = {
    len: 2,
    get: (buf, off) => {
        return {
            sampleFrequency: [44100, 48000, 37800, 32000][_common_Util_js__WEBPACK_IMPORTED_MODULE_2__.getBitAllignedNumber(buf, off, 0, 3)],
            maxUsedBands: _common_Util_js__WEBPACK_IMPORTED_MODULE_2__.getBitAllignedNumber(buf, off, 3, 5),
            channelCount: _common_Util_js__WEBPACK_IMPORTED_MODULE_2__.getBitAllignedNumber(buf, off + 1, 0, 4) + 1,
            msUsed: _common_Util_js__WEBPACK_IMPORTED_MODULE_2__.isBitSet(buf, off + 1, 4),
            audioBlockFrames: _common_Util_js__WEBPACK_IMPORTED_MODULE_2__.getBitAllignedNumber(buf, off + 1, 5, 3)
        };
    }
};
class StreamReader {
    get tokenizer() {
        return this._tokenizer;
    }
    set tokenizer(value) {
        this._tokenizer = value;
    }
    constructor(_tokenizer) {
        this._tokenizer = _tokenizer;
    }
    async readPacketHeader() {
        const key = await this.tokenizer.readToken(PacketKey);
        const size = await this.readVariableSizeField();
        return {
            key,
            payloadLength: size.value - 2 - size.len
        };
    }
    async readStreamHeader(size) {
        const streamHeader = {};
        debug(`Reading SH at offset=${this.tokenizer.position}`);
        const part1 = await this.tokenizer.readToken(SH_part1);
        size -= SH_part1.len;
        Object.assign(streamHeader, part1);
        debug(`SH.streamVersion = ${part1.streamVersion}`);
        const sampleCount = await this.readVariableSizeField();
        size -= sampleCount.len;
        streamHeader.sampleCount = sampleCount.value;
        const bs = await this.readVariableSizeField();
        size -= bs.len;
        streamHeader.beginningOfSilence = bs.value;
        const part3 = await this.tokenizer.readToken(SH_part3);
        size -= SH_part3.len;
        Object.assign(streamHeader, part3);
        // assert.equal(size, 0);
        await this.tokenizer.ignore(size);
        return streamHeader;
    }
    async readVariableSizeField(len = 1, hb = 0) {
        let n = await this.tokenizer.readNumber(token_types__WEBPACK_IMPORTED_MODULE_0__.UINT8);
        if ((n & 0x80) === 0) {
            return { len, value: hb + n };
        }
        n &= 0x7F;
        n += hb;
        return this.readVariableSizeField(len + 1, n << 7);
    }
}
//# sourceMappingURL=StreamVersion8.js.map

/***/ })

}]);
//# sourceMappingURL=vendors-node_modules_music-metadata_lib_musepack_MusepackParser_js.4e21885159ca47333a2c.js.map